define("idcta-v2/analytics",["idcta-v2/config"],function(e){function t(e){o=e}function n(e,t,n){return function(){var r=s[e]&&s[e][t];a&&o&&!r&&document.dispatchEvent(new CustomEvent("bbc-user-event",{detail:{container:"id_cta_client_side",label:t,source:e}})),a=!1;var i=[].slice.apply(arguments),c=n.apply(this,i);return a=!0,c}}function r(t,r){e&&e.features.clientAnalytics&&Object.keys&&Object.keys(t).forEach(function(e){"function"==typeof t[e]&&(t[e]=n(r,e,t[e]))})}var i={},o=!0,a=!0,s={"idcta-1":{addUserOrigin:!0,getCookieInstance:!0,getIdFromCookie:!0,getUserDetailsFromCookie:!0,hasCookie:!0,initiateTokenRefresh:!0,Cta:!0,modifyPtrt:!0},"id-config":{getConfigAsync:!0},idCookie:{getInstance:!0},statusbar:{Statusbar:!0}};return i.setLoggingEnabled=t,i.withAnalytics=n,i.wrapModuleWithAnalytics=r,i}),define("idcta-v2/logger",["idcta-v2/analytics"],function(e){var t={};return t.logCaughtError=function(e){window.console&&e.message&&console.log(e)},t.logMessage=function(e){document.cookie.match(new RegExp("ckns_debugtoken=([^;]+)"))&&(window.tokenRefeshLog=window.tokenRefeshLog||[],window.tokenRefeshLog.push(e))},e.wrapModuleWithAnalytics(t,"logger"),t}),define("idcta-v2/apiUtils",["idcta-v2/es6-promise","idcta-v2/logger"],function(e,t){function n(e,t){var n=e.split("#"),r=n[0],i=n[1],o=r.split("?"),a=o[1],s=a?a.split("&").reduce(function(e,t){var n=t.split("="),r=n[0],i=n[1];return e[r]=i,e},{}):{},c=Object.assign({},s,t),u=Object.keys(c).map(function(e){return e+"="+c[e]}).join("&"),g=u?o[0]+"?"+u:o[0];return i?g+"#"+i:g}function r(e,t){var n=t.substring(0,t.indexOf("=")+1);if(e.indexOf(n)>-1)return e;var r=e.split("#"),i=e.indexOf("?")>-1?"&":"?";return r.length>1?r[0]+i+t+"#"+r[1]:e+i+t}function i(){var e={context:"",userOrigin:""};return window.bbcpage&&window.bbcpage.getDestination?window.bbcpage.getDestination().then(function(t){if(t){return{context:t.replace(/_TEST$/i,"").replace(/_PS$/i,"").replace(/_GNL$/i,"").toLowerCase(),userOrigin:t}}return e}):o.Promise.resolve(e)}var o={};return o.verifyEndpointUrl=function(e,n){try{!1!==n&&(n=!0);if(/https?:\/\/(((www|ssl)(\.int|\.test|\.stage)?)|(pal\.sandbox\.dev))\.bbc\.(co\.uk|com)/.test(e))return/(\.com|\.co\.uk)\/.+/.test(e)&&(e=e.split(/(\.com|\.co\.uk)\/.+/)[0]+e.split(/(\.com|\.co\.uk)\/.+/)[1]),e;var r="";"https"==e.slice(0,5)?(r+=(n?"https://":"")+"ssl.",e.indexOf(".sandbox.")>-1&&(r+="sandbox.dev.")):(r+=n?"http://":"",e.indexOf(".sandbox.")>-1?r+="pal.sandbox.dev.":r+="www.");for(var i=["int","test","stage"],o=0;o<i.length;o++)e.indexOf("."+i[o]+".")>-1&&(r+=i[o]+".");return/\.co\.uk/.test(e)?r+="bbc.co.uk":r+="bbc.com",r}catch(e){t.logCaughtError(e)}},o.alignTldWithHostname=function(e,n){try{var r=n||window.location.hostname,i=r.split(/(\.com|\.co\.uk)$/)[1],o=e.split(/(\.com|\.co\.uk)\/.+/)[1];return o!==i&&void 0!==i&&(e=e.replace(o,i)),e}catch(e){t.logCaughtError(e)}},o.appendProductToCtaElement=function(e){var t="",n="",i=e.getAttribute("href");if(i&&(-1===i.indexOf("userOrigin=")||-1===i.indexOf("context=")))return o.getProductNameAsync().then(function(i){if(void 0!==i&&""!==i){t="userOrigin="+i.userOrigin,n="context="+i.context;var a=e.getAttribute("href"),s=o.parseUrl(a);if(s){var c=(o.parseQueryString(s.search),s.pathname);-1===s.pathname.indexOf("/")&&(c="/"+s.pathname),e.setAttribute("href",s.protocol+"//"+s.host+c+r(r(s.search,t),n)+s.hash)}}})},o.appendQueryParameters=n,o.addQueryParameter=r,o.getProductNameAsync=i,o.Promise=function(){try{return"undefined"!=typeof Promise?Promise:e.Promise}catch(e){t.logCaughtError(e)}}(),o.loadUrlInHiddenIframe=function(e,n,r){try{return new o.Promise(function(i,a){t.logMessage('Creating iframe {src: "'+e+'", timeout: '+n+(r?', expectedPostMessages: ["'+r.join('", "')+'"]}':"}"));var s=document.createElement("iframe");s.scrolling="no",s.frameborder="0",s.width="0px",s.height="0px",s.border="0px",s.style.display="none",s.style.frameBorder="0px",s.style.borderStyle="none";var c=null,u=function(e){var n=e.message?"message":"data";return e.origin.match(/\.bbc\.(co\.uk|com)(:[0-9]+)*$/)&&-1!=r.indexOf(e[n])?(t.logMessage('Iframe received message "'+e[n]+'", resolving'),g(),i(e[n])):void t.logMessage('Iframe received unexpected message "'+e[n]+'", ignoring')},g=function(){c&&clearTimeout(c),r&&o.removeEventListener("message",u),document.body.removeChild(s)};r?o.addEventListener("message",u):s.onload=function(){return t.logMessage('Iframe with src "'+e+'" loading complete'),g(),i()},n&&(c=setTimeout(function(){return t.logMessage("Iframe with src "+e+" timed out after "+n+" milli seconds"),g(),a()},n)),s.src=e,document.body.appendChild(s)})}catch(e){t.logCaughtError(e)}},o.addEventListener=function(e,t,n){o.addEventListenerTo(window,e,t,n)},o.addEventListenerTo=function(e,n,r,i){try{return e.addEventListener?e.addEventListener(n,r,i):(n="message"==n?"onmessage":n,e.attachEvent(n,r))}catch(e){t.logCaughtError(e)}},o.removeEventListener=function(e,t){o.removeEventListenerFrom(window,e,t)},o.removeEventListenerFrom=function(e,n,r){try{return e.removeEventListener?e.removeEventListener(n,r):(n="message"==n?"onmessage":n,e.detachEvent(n,r))}catch(e){t.logCaughtError(e)}},o.getEnvFromUrl=function(){try{var e=window.location.href;return e.indexOf(".sandbox.")>-1?".sandbox.dev":e.indexOf(".int.")>-1?".int":e.indexOf(".test.")>-1?".test":e.indexOf(".stage.")>-1?".stage":""}catch(e){t.logCaughtError(e)}},o.parseUrl=function(e){try{var n=document.createElement("a");return n.href=e,n.query=n.search?o.parseQueryString(n.search):{},n}catch(e){t.logCaughtError(e)}},o.parseQueryString=function(e){try{"?"===e.charAt(0)&&(e=e.substring(1));for(var n={},r=e.split("&"),i=0;i<r.length;i++){var o=r[i].split("=");n[decodeURIComponent(o[0])]=decodeURIComponent(o[1]||"")}return n}catch(e){t.logCaughtError(e)}},o.timestampInFuture=function(e){try{return e>(new Date).getTime()}catch(e){t.logCaughtError(e)}},o.timestampExpired=function(e){try{return e<(new Date).getTime()}catch(e){t.logCaughtError(e)}},o.generateFutureTimestamp=function(e){try{e=e||36e5;var n=new Date;return n.setTime(n.getTime()+e),n.getTime()}catch(e){t.logCaughtError(e)}},t.logCaughtError=function(e){window.console&&e.message&&console.log(e)},t.logMessage=function(e){document.cookie.match(new RegExp("ckns_debugtoken=([^;]+)"))&&(window.tokenRefeshLog=window.tokenRefeshLog||[],window.tokenRefeshLog.push(e))},o}),define("idcta-v2/id-config",["idcta-v2/config","idcta-v2/apiUtils","idcta-v2/analytics"],function(e,t,n){function r(n){var r={context:n.context,userOrigin:n.userOrigin};return{get announce_url(){return t.alignTldWithHostname(e.announce_url)},get"bbcid-v5"(){return e["bbcid-v5"]},get child_parent_linking_url(){return e.child_parent_linking_url},get"id-availability"(){return e["id-availability"]},get identity(){return{cookieAgeDays:e.identity.cookieAgeDays,accessTokenCookieName:e.identity.accessTokenCookieName,idSignedInCookieName:e.identity.idSignedInCookieName}},get identityTokenExchangeUrl(){return t.alignTldWithHostname(e.identityTokenExchangeUrl)},get privacy_settings_url(){return e.privacy_settings_url},get ptrt(){return window.location.href},get register_url(){return t.appendQueryParameters(t.alignTldWithHostname(e.register_url),r)},get settings_url(){return t.appendQueryParameters(e.settings_url,r)},get signin_url(){return t.appendQueryParameters(t.alignTldWithHostname(e.signin_url),r)},get signout_url(){return t.appendQueryParameters(e.signout_url,r)},get status_url(){return t.appendQueryParameters(e.status_url,r)},get tld(){return i},get tokenRefresh(){return e.tokenRefresh||!1},get tokenRefresh_signout_url(){return t.alignTldWithHostname(e.tokenRefresh_signout_url)},get tokenRefresh_url(){return t.alignTldWithHostname(e.tokenRefresh_url)},get translation_signedin(){return e.translations.statusbarSignedIn},get translation_signedout(){return e.translations.statusbarSignedOut}}}var i=function(){var e=window.location.host.split(".");return"co"===e[e.length-2]&&"uk"===e[e.length-1]?e[e.length-3]+".co.uk":e[e.length-2]+"."+e[e.length-1]}(),o={},a=t.getProductNameAsync().then(r);return o.getConfigAsync=function(){return a},o.getDomain=function(){return i},o.getIdentity=function(){return e.identity},o.getFeatureDecisions=function(){return e.features},o.getUsiDestinationWhitelist=function(){return e.usiDestinationWhitelist},o.getExperiments=function(){return e.experiments},n.wrapModuleWithAnalytics(o,"id-config"),o}),define("idcta-v2/idCookie",["idcta-v2/id-config","idcta-v2/logger","idcta-v2/analytics"],function(e,t,n){function r(){try{return p?(p.refreshCookie(),p):(p=new s,n.wrapModuleWithAnalytics(p,"idCookieInstance"),p)}catch(e){t.logCaughtError(e)}}function i(e){try{p=e}catch(e){t.logCaughtError(e)}}function o(e){try{var t=window.atob(e),n=t.lastIndexOf("}"),r=t.substring(0,n+1);return JSON.parse(r)}catch(e){return null}}function a(e,n,r,i){try{n=n||"";var o="";if(r){var a=new Date;a.setTime(a.getTime()+r),o="Expires="+a.toUTCString()+"; "}n=i?window.btoa(n):n,document.cookie=e+"="+n+"; "+o+"Domain="+g+"; Path=/"}catch(e){t.logCaughtError(e)}}function s(){function e(){var e=new RegExp(d+"=([\\w]+)"),t=document.cookie.match(e);if(!t)return void s();var n=o(t[1]);if(!n||!r(n)||i(n))return void s();c.valid=!0,c.displayname=n.dn,c.timestamp=n["jwt-exp"]}function n(){var e=c.cookieAgeDays*u;return(new Date).getTime()-c.timestamp>=e}function r(e){return e.hasOwnProperty("ps")&&e.hasOwnProperty("jwt-exp")&&e.hasOwnProperty("tkn-exp")&&(e.hy||e.hasOwnProperty("ses-exp"))}function i(e){var t=(new Date).getTime();return(e["jwt-exp"]||0)<=t}function s(){c.valid=!1,c.id="",c.username="~",c.displayname="",c.timestamp=""}var c=this;this.valid=!1,this.id="",this.username="~",this.displayname="",this.timestamp="",this.cookieAgeDays=l,this.isIdv5On=!0,this.refreshCookie=function(){try{e()}catch(e){t.logCaughtError(e)}},this.hasCookie=function(){try{return n()&&s(),c.valid}catch(e){t.logCaughtError(e)}},this.hasAccessTokenExpired=function(){try{var e=this.getUserDetailsFromCookie();if(!e)return!0;var n=(new Date).getTime();return(e["tkn-exp"]||0)<=n}catch(e){t.logCaughtError(e)}},this.hasJwtTokenExpired=function(){try{var e=this.getUserDetailsFromCookie();if(!e)return!0;var n=(new Date).getTime();return(e["jwt-exp"]||0)<=n}catch(e){t.logCaughtError(e)}},this.isHybridApp=function(){try{var e=this.getUserDetailsFromCookie();return!!e&&(e.hy||!1)}catch(e){t.logCaughtError(e)}},this.getError=function(){try{var e=this.getUserDetailsFromCookie();return e?e.ec||null:null}catch(e){t.logCaughtError(e)}},this.getIdFromCookie=function(){try{var e=this.getUserDetailsFromCookie();return e?e.ps:null}catch(e){t.logCaughtError(e)}},this.getHidFromCookie=function(){return this.getCookie(f)||this.getCookie(m)},this.isPersonalisationEnabled=function(){try{var e=this.getUserDetailsFromCookie();return e&&e.ep}catch(e){return t.logCaughtError(e),!1}},this.getUserDetailsFromCookie=function(){try{if(!this.hasCookie())return null;var e=new RegExp(d+"=([\\w]+)"),n=document.cookie.match(e);if(!n)return null;var i=decodeURIComponent(n[1]).split("|"),a=o(i.toString());return a&&r(a)?a:null}catch(e){t.logCaughtError(e)}},this.getNameFromCookie=function(){try{return this.hasCookie()&&(c.displayname&&""!==c.displayname)?c.displayname.replace(/\+/g," "):null}catch(e){t.logCaughtError(e)}},this.getAccessToken=function(){try{if(!this.hasCookie())return null;var e=new RegExp(h+"=([^;]*)"),n=document.cookie.match(e);return null!==n?n[1]:null}catch(e){t.logCaughtError(e)}},this.getCookie=function(e,n){try{var r=new RegExp(e+"=([^\\s;]*)"),i=document.cookie.match(r);if(!i)return null;if(!0!==n)return i[1];return o(decodeURIComponent(i[1]))}catch(e){t.logCaughtError(e)}},this.setCknsIdCookieProperty=function(e,n){try{var r=this.getUserDetailsFromCookie();if(!r)return;n?r[e]=n:delete r[e];var i=r["jwt-exp"]?r["jwt-exp"]:u*l;a(d,JSON.stringify(r),i,!0)}catch(e){t.logCaughtError(e)}},this.unsetCookie=function(e){try{document.cookie=e+"=; Expires=Thu, 01 Jan 1970 00:00:00 GMT; Domain="+g+"; Path=/"}catch(e){t.logCaughtError(e)}},function(){e()}()}var c={},u=864e5;n.setLoggingEnabled(!1);var g=e.getDomain(),d=e.getIdentity()&&e.getIdentity().idSignedInCookieName?e.getIdentity().idSignedInCookieName:"ckns_id",l=e.getIdentity()&&e.getIdentity().cookieAgeDays?e.getIdentity().cookieAgeDays:730,h=e.getIdentity()&&e.getIdentity().accessTokenCookieName?e.getIdentity().accessTokenCookieName:"ckns_atkn",f="ckns_sylphid",m="ckpf_sylphid";n.setLoggingEnabled(!0);var p;return c.getInstance=r,c.setInstance=i,n.wrapModuleWithAnalytics(c,"idCookie"),c}),define("idcta-v2/tokenRefresh",["idcta-v2/id-config","idcta-v2/idCookie","idcta-v2/apiUtils","idcta-v2/logger","idcta-v2/analytics"],function(e,t,n,r,i){function o(i,o){var u=t.getInstance();try{if(!u.hasCookie()){var g="ckns_id cookie is missing, invalid or expired";return n.Promise.reject(new a(g))}if(u.isHybridApp()){var g="hybrid app detected";return n.Promise.reject(new a(g))}var d=u.getError();if(d&&n.timestampInFuture(d.retryAfter)){var g="retry period has not passed";return n.Promise.reject(new a(g,d.retryAfter))}if(!0!==i&&!u.hasAccessTokenExpired())return n.Promise.resolve();var l=function(e){var t={credentials:"include",headers:{"Content-Type":"application/json"}};return fetch(e,t)};return void 0===s[o]&&(s[o]=e.getConfigAsync().then(function(e){var t=e.tokenRefresh_url;return t=o?n.alignTldWithHostname(t,o):t,l(t)})),s[o].then(function(){s[o]=void 0}).catch(function(e){return s[o]=void 0,c(e)})}catch(e){r.logCaughtError(e)}}function a(e,t){this.name="TokenRefreshError",this.message=e,this.retryAfter=t}var s={},c=function(n){return e.getConfigAsync().then(function(e){var r=(new Date).getTime()+(e.tokenRefresh?15e3:36e5);throw n.retryAfter=r,t.getInstance().setCknsIdCookieProperty("ec",n),n})};a.prototype=Error.prototype;var u={};return u.refreshAccessToken=o,i.wrapModuleWithAnalytics(u,"tokenRefresh"),u}),define("idcta-v2/idcta-1",["idcta-v2/idCookie","idcta-v2/apiUtils","idcta-v2/tokenRefresh","idcta-v2/logger","idcta-v2/id-config","idcta-v2/es6-promise","idcta-v2/analytics"],function(e,t,n,r,i,o,a){function s(t,n){var r=["idcta-v2/signInPrompt","idcta-v2/mvt"];requirejs(r,function(r,o){var a=e.getInstance().hasCookie(),s=r.hasInitialised(),c=i.getExperiments();if(a&&!s||(o.bucketUser(c.usiApiName),o.sendEvent("page_view")),a&&s)o.sendEvent("page_view_signed_in");else if(!a){var u=o.getVariantName(c.usi);o.sendEvent("page_view_signed_out"),r.initialise(t,n,u)}})}function c(t){try{this.id=t.id,this.element=document.getElementById(t.id),this.states=t.states;var n=this;m.ctas[n.id]=n,!0===t.publiclyCacheable&&(e.getInstance().hasCookie()?g(n):n.element.getElementsByTagName("span")[0].innerText=n.states.unauthorised.signedout)}catch(e){r.logCaughtError(e)}}function u(e){var n=document.querySelectorAll("#"+e),r=function(){t.appendProductToCtaElement(this)};if(n.length)for(var i=0;i<n.length;i++)for(var o=n[i].getElementsByTagName("a"),a=0;a<o.length;a++)t.addEventListenerTo(o[a],"click",r,!1)}function g(t){if(t.states.authorised){var n=e.getInstance().getNameFromCookie(),r=t.states.authorised.anonymous;n&&(r=t.states.authorised.name.replace("{name}",n)),t.element.getElementsByTagName("span")[0].innerText=r}else t.element.parentNode&&t.element.parentNode.removeChild(t.element)}function d(e,t){try{return e=!0===e,n.refreshAccessToken(e,t)}catch(e){r.logCaughtError(e)}}function l(){try{return m.initiateTokenRefresh().then(function(){return!0},function(){throw!1})}catch(e){r.logCaughtError(e)}}function h(e,n,i){try{var o=document.querySelector("#"+e+" span"),a=["small","medium","large"],s=["blue","white"];a.indexOf(n)>-1&&(o.className=o.className.replace(/small|medium|large/g,n)),s.indexOf(i)>-1&&(o.className=o.className.replace(/blue|white/g,i));var c=document.querySelectorAll("#"+e+" span a");for(var u in c)c.hasOwnProperty(u)&&t.appendProductToCtaElement(c[u])}catch(e){r.logCaughtError(e)}}function f(e,n){try{var i=document.querySelectorAll("#"+e+" a");if(!i.length)throw"No cta elements found with provided Id";for(var o in i)if(i.hasOwnProperty(o)){var a=i[o].getAttribute("href"),s=decodeURIComponent(a).match(/ptrt\=([a-zA-Z:\/\/\_\\0-9.-]*)&?/).pop();s=encodeURIComponent(s);var c=a.substring(0,a.indexOf(s)),u=a.substring(a.indexOf(s)+s.length);i[o].setAttribute("href",c+n+u),t.appendProductToCtaElement(i[o])}}catch(e){r.logCaughtError(e)}}var m={signals:{},ctas:{}};a.setLoggingEnabled(!1);var p=i.getFeatureDecisions();if(a.setLoggingEnabled(!0),window.bbcpage&&window.bbcpage.getDestination&&window.bbcpage.getContentType&&window.bbcpage.getAdditionalProperties&&p.showUsiModal){var v=["index-correspondent","index-home","index-section"],y=["article","article-correspondent","article-media-asset","article-photo-gallery","oppm","sports-data"];o.all([window.bbcpage.getDestination(),window.bbcpage.getContentType(),window.bbcpage.getAdditionalProperties()]).then(function(e){var t=e[0]&&e[0].toLowerCase(),n=e[1],r=e[2]&&e[2].app_type;if(-1!==i.getUsiDestinationWhitelist().indexOf(t)&&"mobile-app"!==r){if(v.indexOf(n)>=0)return s(t,"index");if(y.indexOf(n)>=0)return s(t,"article")}}).catch(function(e){console.error("Caught USI initialisation error in IDCTA idcta-1 module",e)})}return m.Cta=c,m.modifyCta=h,m.modifyPtrt=f,m.addUserOrigin=u,m.initiateTokenRefresh=d,m.initiateUserUplift=l,m.hasCookie=function(){return e.getInstance().hasCookie()},m.getCookieInstance=function(){return e.getInstance()},m.getIdFromCookie=function(){return e.getInstance().getIdFromCookie()},m.getUserDetailsFromCookie=function(){return e.getInstance().getUserDetailsFromCookie()},m.getNameFromCookie=function(){return e.getInstance().getNameFromCookie()},m.getAccessToken=function(t){return e.getInstance().getAccessToken(t)},a.wrapModuleWithAnalytics(m,"idcta-1"),m});

//# sourceMappingURL=idcta-1.js.map
