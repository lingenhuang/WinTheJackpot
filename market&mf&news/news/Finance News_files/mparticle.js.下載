//
//  Copyright 2019 mParticle, Inc.
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//
//  Uses portions of code from jQuery
//  jQuery v1.10.2 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license

window.mParticle = window.mParticle || {};;
window.mParticle.config = window.mParticle.config || {};;
window.mParticle.config.serviceUrl = 'jssdk.mparticle.com/v2/JS/';;
window.mParticle.config.secureServiceUrl = 'jssdks.mparticle.com/v2/JS/';;
window.mParticle.config.appName = window.mParticle.config.appName || "CNBC PROD";;
window.mParticle.config.minWebviewBridgeVersion = 2;
window.mParticle.config.workspaceToken = "13B9270B";;
window.mParticle.config.aliasMaxWindow = 90;
window.mParticle.config.kitConfigs = window.mParticle.config.kitConfigs || [];;
window.mParticle.config.pixelConfigs = window.mParticle.config.pixelConfigs || [];;
window.mParticle.config.flags = {"eventsV3":"0","eventBatchingIntervalMillis":"5000"};
var mParticle=function(){function wr(n,t,i){return t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function dr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n["default"]:n}function ft(n,t){return t={exports:{}},n(t,t.exports),t.exports}function gr(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}});t&&ci(n,t)}function nu(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function tu(n,t){return t&&(h(t)==="object"||typeof t=="function")?t:li(n)}function uu(n,t){(t==null||t>n.length)&&(t=n.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=n[i];return r}function fu(n){if(Array.isArray(n))return wt(n)}function eu(n){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(n))return Array.from(n)}function ou(n,t){if(n){if(typeof n=="string")return wt(n,t);var i=Object.prototype.toString.call(n).slice(8,-1);return(i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set")?Array.from(n):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?wt(n,t):void 0}}function su(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function hu(n){return vi(n)||yi(n)||pi(n)||wi()}function bi(n,t,i,r,u,f,e){try{var o=n[f](e),s=o.value}catch(h){i(h);return}o.done?t(s):Promise.resolve(s).then(r,u)}function cu(n){return function(){var t=this,i=arguments;return new Promise(function(r,u){function f(n){bi(e,r,u,f,o,"next",n)}function o(n){bi(e,r,u,f,o,"throw",n)}var e=n.apply(t,i);f(undefined)})}}function lu(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function ki(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}function au(n,t,i){return t&&ki(n.prototype,t),i&&ki(n,i),n}function gi(n,t){var r=Object.keys(n),i;return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(n),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),r.push.apply(r,i)),r}function nr(n){for(var i,t=1;t<arguments.length;t++)i=arguments[t]!=null?arguments[t]:{},t%2?gi(Object(i),!0).forEach(function(t){l(n,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):gi(Object(i)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(i,t))});return n}function at(n){var i,r,t,u,f,e;if(typeof Symbol=="undefined"||n[Symbol.iterator]==null){if(Array.isArray(n)||(n=pu(n)))return i=0,r=function(){},{s:r,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(n){throw n;},f:r};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}return u=!0,f=!1,{s:function(){t=n[Symbol.iterator]()},n:function(){var n=t.next();return u=n.done,n},e:function(n){f=!0;e=n},f:function(){try{u||t["return"]==null||t["return"]()}finally{if(f)throw e;}}}}function pu(n,t){if(n){if(typeof n=="string")return tr(n,t);var i=Object.prototype.toString.call(n).slice(8,-1);return(i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set")?Array.from(n):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?tr(n,t):void 0}}function tr(n,t){(t==null||t>n.length)&&(t=n.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=n[i];return r}function ir(n,t,i){var f,e,o;if(!n||!t||t.length<1)return null;var s=[],r=null,u=at(t),h;try{for(u.s();!(h=u.n()).done;)f=h.value,f&&(r=f,e=gu(f),e&&s.push(e))}catch(c){u.e(c)}finally{u.f()}return r?(o={source_request_id:i._Helpers.generateUniqueId(),mpid:n,timestamp_unixtime_ms:(new Date).getTime(),environment:r.Debug?di.development:di.production,events:s,mp_deviceid:r.DeviceId,sdk_version:r.SDKVersion,application_info:{application_version:r.AppVersion,application_name:r.AppName},device_info:{platform:yu.web,screen_width:window.screen.width,screen_height:window.screen.height},user_attributes:r.UserAttributes,user_identities:du(r.UserIdentities),consent_state:wu(r.ConsentState),integration_attributes:r.IntegrationAttributes},r.DataPlan&&r.DataPlan.PlanId&&(o.context={data_plan:{plan_id:r.DataPlan.PlanId,plan_version:r.DataPlan.PlanVersion||undefined}}),o):null}function wu(n){if(!n)return null;return{gdpr:bu(n.getGDPRConsentState()),ccpa:ku(n.getCCPAConsentState())}}function bu(n){var i,t;if(!n)return null;i={};for(t in n)n.hasOwnProperty(t)&&(i[t]={consented:n[t].Consented,hardware_id:n[t].HardwareId,document:n[t].ConsentDocument,timestamp_unixtime_ms:n[t].Timestamp,location:n[t].Location});return i}function ku(n){if(!n)return null;return{data_sale_opt_out:{consented:n.Consented,hardware_id:n.HardwareId,document:n.ConsentDocument,timestamp_unixtime_ms:n.Timestamp,location:n.Location}}}function du(t){var i,u,f,r;if(!t||!t.length)return null;i={};u=at(t);try{for(u.s();!(f=u.n()).done;){r=f.value;switch(r.Type){case n.IdentityType.CustomerId:i.customer_id=r.Identity;break;case n.IdentityType.Email:i.email=r.Identity;break;case n.IdentityType.Facebook:i.facebook=r.Identity;break;case n.IdentityType.FacebookCustomAudienceId:i.facebook_custom_audience_id=r.Identity;break;case n.IdentityType.Google:i.google=r.Identity;break;case n.IdentityType.Microsoft:i.microsoft=r.Identity;break;case n.IdentityType.Other:i.other=r.Identity;break;case n.IdentityType.Other2:i.other_id_2=r.Identity;break;case n.IdentityType.Other3:i.other_id_3=r.Identity;break;case n.IdentityType.Other4:i.other_id_4=r.Identity;break;case n.IdentityType.Other5:i.other_id_5=r.Identity;break;case n.IdentityType.Other6:i.other_id_6=r.Identity;break;case n.IdentityType.Other7:i.other_id_7=r.Identity;break;case n.IdentityType.Other8:i.other_id_8=r.Identity;break;case n.IdentityType.Other9:i.other_id_9=r.Identity;break;case n.IdentityType.Other10:i.other_id_10=r.Identity;break;case n.IdentityType.MobileNumber:i.mobile_number=r.Identity;break;case n.IdentityType.PhoneNumber2:i.phone_number_2=r.Identity;break;case n.IdentityType.PhoneNumber3:i.phone_number_3=r.Identity}}}catch(e){u.e(e)}finally{u.f()}return i}function gu(t){if(!t)return null;switch(t.EventDataType){case n.MessageType.AppStateTransition:return hf(t);case n.MessageType.Commerce:return of(t);case n.MessageType.CrashReport:return sf(t);case n.MessageType.OptOut:return vf(t);case n.MessageType.PageEvent:return yf(t);case n.MessageType.PageView:return af(t);case n.MessageType.Profile:return null;case n.MessageType.SessionEnd:return cf(t);case n.MessageType.SessionStart:return lf(t);case n.MessageType.UserAttributeChange:return bf(t);case n.MessageType.UserIdentityChange:return kf(t)}return null}function nf(n){if(!n)return v.unknown;switch(n){case a.AddToCart:return v.addToCart;case a.AddToWishlist:return v.addToWishlist;case a.Checkout:return v.checkout;case a.CheckoutOption:return v.checkoutOption;case a.Click:return v.click;case a.Purchase:return v.purchase;case a.Refund:return v.refund;case a.RemoveFromCart:return v.removeFromCart;case a.RemoveFromWishlist:return v.removeFromWishlist;case a.ViewDetail:return v.viewDetail;default:return v.unknown}}function tf(n){if(!n.ProductAction)return null;return{action:nf(n.ProductAction.ProductActionType),checkout_step:n.ProductAction.CheckoutStep,checkout_options:n.ProductAction.CheckoutOptions,transaction_id:n.ProductAction.TransactionId,affiliation:n.ProductAction.Affiliation,total_amount:n.ProductAction.TotalAmount,tax_amount:n.ProductAction.TaxAmount,shipping_amount:n.ProductAction.ShippingAmount,coupon_code:n.ProductAction.CouponCode,products:ii(n.ProductAction.ProductList)}}function ii(n){var r,i,u,t,f;if(!n||!n.length)return null;r=[];i=at(n);try{for(i.s();!(u=i.n()).done;)t=u.value,f={id:t.Sku,name:t.Name,brand:t.Brand,category:t.Category,variant:t.Variant,total_product_amount:t.TotalAmount,position:t.Position,price:t.Price,quantity:t.Quantity,coupon_code:t.CouponCode,custom_attributes:t.Attributes},r.push(f)}catch(e){i.e(e)}finally{i.f()}return r}function rf(n){if(!n.PromotionAction)return null;return{action:n.PromotionAction.PromotionActionType,promotions:uf(n.PromotionAction.PromotionList)}}function uf(n){var r,t,u,i,f;if(!n||!n.length)return null;r=[];t=at(n);try{for(t.s();!(u=t.n()).done;)i=u.value,f={id:i.Id,name:i.Name,creative:i.Creative,position:i.Position},r.push(f)}catch(e){t.e(e)}finally{t.f()}return r}function ff(n){var i,t,u,r,f;if(!n.ProductImpressions)return null;i=[];t=at(n.ProductImpressions);try{for(t.s();!(u=t.n()).done;)r=u.value,f={product_impression_list:r.ProductImpressionList,products:ii(r.ProductList)},i.push(f)}catch(e){t.e(e)}finally{t.f()}return i}function ef(n){if(!n.ShoppingCart||!n.ShoppingCart.ProductList||!n.ShoppingCart.ProductList.length)return null;return{products:ii(n.ShoppingCart.ProductList)}}function of(n){var i=b(n),t={custom_flags:n.CustomFlags,product_action:tf(n),promotion_action:rf(n),product_impressions:ff(n),shopping_cart:ef(n),currency_code:n.CurrencyCode};return t=Object.assign(t,i),{event_type:w.commerceEvent,data:t}}function sf(n){var i=b(n),t={message:n.EventName};return t=Object.assign(t,i),{event_type:w.crashReport,data:t}}function hf(n){var i=b(n),t={application_transition_type:vu.applicationInitialized,is_first_run:n.IsFirstRun,is_upgrade:!1};return t=Object.assign(t,i),{event_type:w.applicationStateTransition,data:t}}function cf(n){var i=b(n),t={session_duration_ms:n.SessionLength};return t=Object.assign(t,i),{event_type:w.sessionEnd,data:t}}function lf(n){var i=b(n),t={};return t=Object.assign(t,i),{event_type:w.sessionStart,data:t}}function af(n){var i=b(n),t={custom_flags:n.CustomFlags,screen_name:n.EventName};return t=Object.assign(t,i),{event_type:w.screenView,data:t}}function vf(n){var i=b(n),t={is_opted_out:n.OptOut};return t=Object.assign(t,i),{event_type:w.optOut,data:t}}function yf(n){var i=b(n),t={custom_event_type:pf(n.EventCategory),custom_flags:n.CustomFlags,event_name:n.EventName};return t=Object.assign(t,i),{event_type:w.customEvent,data:t}}function pf(t){switch(t){case n.EventType.Other:return g.other;case n.EventType.Location:return g.location;case n.EventType.Navigation:return g.navigation;case n.EventType.Search:return g.search;case n.EventType.Social:return g.social;case n.EventType.Transaction:return g.transaction;case n.EventType.UserContent:return g.userContent;case n.EventType.UserPreference:return g.userPreference;case n.CommerceEventType.ProductAddToCart:return c.addToCart;case n.CommerceEventType.ProductAddToWishlist:return c.addToWishlist;case n.CommerceEventType.ProductCheckout:return c.checkout;case n.CommerceEventType.ProductCheckoutOption:return c.checkoutOption;case n.CommerceEventType.ProductClick:return c.click;case n.CommerceEventType.ProductImpression:return c.impression;case n.CommerceEventType.ProductPurchase:return c.purchase;case n.CommerceEventType.ProductRefund:return c.refund;case n.CommerceEventType.ProductRemoveFromCart:return c.removeFromCart;case n.CommerceEventType.ProductRemoveFromWishlist:return c.removeFromWishlist;case n.CommerceEventType.ProductViewDetail:return c.viewDetail;case n.CommerceEventType.PromotionClick:return c.promotionClick;case n.CommerceEventType.PromotionView:return c.promotionView;default:return g.unknown}}function b(n){return{timestamp_unixtime_ms:n.Timestamp,session_uuid:n.SessionId,session_start_unixtime_ms:n.SessionStartDate,custom_attributes:n.EventAttributes,location:wf(n.Location)}}function wf(n){return n&&Object.keys(n).length?{latitude:n.lat,longitude:n.lng}:null}function bf(n){var i=b(n),t={user_attribute_name:n.UserAttributeChanges.UserAttributeName,"new":n.UserAttributeChanges.New,old:n.UserAttributeChanges.Old,deleted:n.UserAttributeChanges.Deleted,is_new_attribute:n.UserAttributeChanges.IsNewAttribute};return t=nr(nr({},t),i),{event_type:w.userAttributeChange,data:t}}function kf(n){var i=b(n),t={"new":{identity_type:n.UserIdentityChanges.New.IdentityType,identity:n.UserIdentityChanges.New.Identity||null,timestamp_unixtime_ms:n.Timestamp,created_this_batch:n.UserIdentityChanges.New.CreatedThisBatch},old:{identity_type:n.UserIdentityChanges.Old.IdentityType,identity:n.UserIdentityChanges.Old.Identity||null,timestamp_unixtime_ms:n.Timestamp,created_this_batch:n.UserIdentityChanges.Old.CreatedThisBatch}};return t=Object.assign(t,i),{event_type:w.userIdentityChange,data:t}}function rr(n){var t=df();return function(){var r=ai(n),i,u;return t?(u=ai(this).constructor,i=Reflect.construct(r,arguments,u)):i=r.apply(this,arguments),iu(this,i)}}function df(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(n){return!1}}function ur(n){var i,r,t,u,f,e;if(typeof Symbol=="undefined"||n[Symbol.iterator]==null){if(Array.isArray(n)||(n=gf(n)))return i=0,r=function(){},{s:r,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(n){throw n;},f:r};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}return u=!0,f=!1,{s:function(){t=n[Symbol.iterator]()},n:function(){var n=t.next();return u=n.done,n},e:function(n){f=!0;e=n},f:function(){try{u||t["return"]==null||t["return"]()}finally{if(f)throw e;}}}}function gf(n,t){if(n){if(typeof n=="string")return fr(n,t);var i=Object.prototype.toString.call(n).slice(8,-1);return(i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set")?Array.from(n):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?fr(n,t):void 0}}function fr(n,t){(t==null||t>n.length)&&(t=n.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=n[i];return r}function ie(i){this.uploader=null;var r=this;this.queueEventForBatchUpload=function(n){if(!this.uploader){var r=i._Helpers.getFeatureFlag(t.FeatureFlags.EventBatchingIntervalMillis);this.uploader=new bt(i,r)}this.uploader.queueEvent(n)};this.shouldEnableBatching=function(){var n=parseInt(i._Helpers.getFeatureFlag(t.FeatureFlags.EventsV3),10),r;return n?(r=i._Helpers.getRampNumber(i._Store.deviceId),n>=r):!1};this.processQueuedEvents=function(){var u,n=i.Identity.getCurrentUser(),t;n&&(u=n.getMPID());i._Store.eventQueue.length&&u&&(t=i._Store.eventQueue,i._Store.eventQueue=[],this.appendUserInfoToEvents(n,t),t.forEach(function(n){r.sendEventToServer(n)}))};this.appendUserInfoToEvents=function(n,t){t.forEach(function(t){t.MPID||i._ServerModel.appendUserInfo(n,t)})};this.sendEventToServer=function(r){if(i._Store.webviewBridgeEnabled){i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.LogEvent,JSON.stringify(r));return}var u,f=i.Identity.getCurrentUser();if(f&&(u=f.getMPID()),i._Store.requireDelay=i._Helpers.isDelayedByIntegration(i._preInit.integrationDelays,i._Store.integrationDelayTimeoutStart,Date.now()),!u||i._Store.requireDelay||!i._Store.configurationLoaded){i.Logger.verbose("Event was added to eventQueue. eventQueue will be processed once a valid MPID is returned or there is no more integration imposed delay.");i._Store.eventQueue.push(r);return}this.processQueuedEvents();this.shouldEnableBatching()?this.queueEventForBatchUpload(r):this.sendSingleEventToServer(r);r&&r.EventName!==n.MessageType.AppStateTransition&&i._Forwarders.sendEventToForwarders(r)};this.sendSingleEventToServer=function(t){if(t.EventDataType!==n.MessageType.Media){var r,u=function(){r.readyState===4&&(i.Logger.verbose("Received "+r.statusText+" from server"),i._Persistence.update())};if(!t){i.Logger.error(st.ErrorMessages.EventEmpty);return}if(i.Logger.verbose(st.InformationMessages.SendHttp),r=i._Helpers.createXHR(u),r)try{r.open("post",i._Helpers.createServiceUrl(i._Store.SDKConfig.v2SecureServiceUrl,i._Store.devToken)+"/Events");r.send(JSON.stringify(i._ServerModel.convertEventToDTO(t,i._Store.isFirstRun)))}catch(f){i.Logger.error("Error sending event to mParticle servers. "+f)}}};this.sendAliasRequest=function(n,t){var r,f=function(){var n,u;if(r.readyState===4){if(i.Logger.verbose("Received "+r.statusText+" from server"),r.status!==200&&r.status!==202&&r.responseText&&(n=JSON.parse(r.responseText),n.hasOwnProperty("message"))){u=n.message;i._Helpers.invokeAliasCallback(t,r.status,u);return}i._Helpers.invokeAliasCallback(t,r.status)}};if(i.Logger.verbose(st.InformationMessages.SendAliasHttp),r=i._Helpers.createXHR(f),r)try{r.open("post",i._Helpers.createServiceUrl(i._Store.SDKConfig.aliasUrl,i._Store.devToken)+"/Alias");r.send(JSON.stringify(n))}catch(u){i._Helpers.invokeAliasCallback(t,ui.noHttpCoverage,u);i.Logger.error("Error sending alias request to mParticle servers. "+u)}};this.sendIdentityRequest=function(n,t,r,u,f,e){var o,s,c=function(){o.readyState===4&&(i.Logger.verbose("Received "+o.statusText+" from server"),f(o,s,r,u,t))};if(i.Logger.verbose(st.InformationMessages.SendIdentityBegin),!n){i.Logger.error(st.ErrorMessages.APIRequestEmpty);return}if(i.Logger.verbose(st.InformationMessages.SendIdentityHttp),o=i._Helpers.createXHR(c),o)try{i._Store.identityCallInFlight?i._Helpers.invokeCallback(r,ui.activeIdentityRequest,"There is currently an Identity request processing. Please wait for this to return before requesting again"):(s=e||null,t==="modify"?o.open("post",i._Helpers.createServiceUrl(i._Store.SDKConfig.identityUrl)+e+"/"+t):o.open("post",i._Helpers.createServiceUrl(i._Store.SDKConfig.identityUrl)+t),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("x-mp-key",i._Store.devToken),i._Store.identityCallInFlight=!0,o.send(JSON.stringify(n)))}catch(h){i._Store.identityCallInFlight=!1;i._Helpers.invokeCallback(r,ui.noHttpCoverage,h);i.Logger.error("Error sending identity request to servers with status code "+o.status+" - "+h)}};this.sendBatchForwardingStatsToServer=function(n,t){var r,u;try{r=i._Helpers.createServiceUrl(i._Store.SDKConfig.v2SecureServiceUrl,i._Store.devToken);u={uuid:i._Helpers.generateUniqueId(),data:n};t&&(t.open("post",r+"/Forwarding"),t.send(JSON.stringify(u)))}catch(f){i.Logger.error("Error sending forwarding stats to mParticle servers.")}};this.sendSingleForwardingStatsToServer=function(n){var r,u,f,t;try{f=function(){t.readyState===4&&t.status===202&&i.Logger.verbose("Successfully sent  "+t.statusText+" from server")};t=i._Helpers.createXHR(f);r=i._Helpers.createServiceUrl(i._Store.SDKConfig.v1SecureServiceUrl,i._Store.devToken);u=n;t&&(t.open("post",r+"/Forwarding"),t.send(JSON.stringify(u)))}catch(e){i.Logger.error("Error sending forwarding stats to mParticle servers.")}};this.getSDKConfiguration=function(n,t,i,r){var f,e,u;try{e=function(){u.readyState===4&&(u.status===200?(t=r._Helpers.extend({},t,JSON.parse(u.responseText)),i(n,t,r),r.Logger.verbose("Successfully received configuration from server")):(i(n,t,r),r.Logger.verbose("Issue with receiving configuration from server, received HTTP Code of "+u.status)))};u=r._Helpers.createXHR(e);f="https://"+r._Store.SDKConfig.configUrl+n+"/config?env=";f=t.isDevelopmentMode?f+"1":f+"0";u&&(u.open("get",f),u.send(null))}catch(o){i(n,t,r);r.Logger.error("Error getting forwarder configuration from mParticle servers.")}};this.prepareForwardingStats=function(n,u){var f,e=i._Forwarders.getForwarderStatsQueue();n&&n.isVisible&&(f={mid:n.id,esid:n.eventSubscriptionId,n:u.EventName,attrs:u.EventAttributes,sdk:u.SDKVersion,dt:u.EventDataType,et:u.EventCategory,dbg:u.Debug,ct:u.Timestamp,eec:u.ExpandedEventCount,dp:u.DataPlan},i._Helpers.getFeatureFlag(t.FeatureFlags.ReportBatching)?(e.push(f),i._Forwarders.setForwarderStatsQueue(e)):r.sendSingleForwardingStatsToServer(f))}}function fe(i){function u(n){var t;return(window.crypto&&window.crypto.getRandomValues&&(t=window.crypto.getRandomValues(new Uint8Array(1))),t)?(n^t[0]%16>>n/4).toString(16):(n^Math.random()*16>>n/4).toString(16)}var r=this;this.canLog=function(){return i._Store.isEnabled&&(i._Store.devToken||i._Store.webviewBridgeEnabled)?!0:!1};this.returnConvertedBoolean=function(n){return n==="false"||n==="0"?!1:Boolean(n)};this.getFeatureFlag=function(n){return i._Store.SDKConfig.flags.hasOwnProperty(n)?i._Store.SDKConfig.flags[n]:null};this.getRampNumber=function(n){if(!n)return 100;var t=r.generateHash(n);return Math.abs(t%100)+1};this.invokeCallback=function(n,t,u,f,e){n||i.Logger.warning("There is no callback provided");try{r.Validators.isFunction(n)&&n({httpCode:t,body:u,getUser:function(){return f?f:i.Identity.getCurrentUser()},getPreviousUser:function(){if(e)return i.Identity.getUser(e);var t=i.Identity.getUsers(),n=t.shift(),r=f||i.Identity.getCurrentUser();return n&&r&&n.getMPID()===r.getMPID()&&(n=t.shift()),n||null}})}catch(o){i.Logger.error("There was an error with your callback: "+o)}};this.invokeAliasCallback=function(n,t,u){n||i.Logger.warning("There is no callback provided");try{if(r.Validators.isFunction(n)){var f={httpCode:t};u&&(f.message=u);n(f)}}catch(e){i.Logger.error("There was an error with your callback: "+e)}};this.extend=function(){var o,e,u,i,s,c,t=arguments[0]||{},f=1,a=arguments.length,l=!1,n={hasOwn:Object.prototype.hasOwnProperty,class2type:{},type:function(t){return t==null?String(t):n.class2type[Object.prototype.toString.call(t)]||"object"},isPlainObject:function(t){if(!t||n.type(t)!=="object"||t.nodeType||n.isWindow(t))return!1;try{if(t.constructor&&!n.hasOwn.call(t,"constructor")&&!n.hasOwn.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}for(var i in t);return i===undefined||n.hasOwn.call(t,i)},isArray:Array.isArray||function(t){return n.type(t)==="array"},isFunction:function(t){return n.type(t)==="function"},isWindow:function(n){return n!=null&&n==n.window}};for(typeof t=="boolean"&&(l=t,t=arguments[1]||{},f=2),h(t)==="object"||n.isFunction(t)||(t={}),a===f&&(t=this,--f);f<a;f++)if((o=arguments[f])!=null)for(e in o)(u=t[e],i=o[e],t!==i)&&(l&&i&&(n.isPlainObject(i)||(s=n.isArray(i)))?(s?(s=!1,c=u&&n.isArray(u)?u:[]):c=u&&n.isPlainObject(u)?u:{},t[e]=r.extend(l,c,i)):i!==undefined&&(t[e]=i));return t};this.isObject=function(n){var t=Object.prototype.toString.call(n);return t==="[object Object]"||t==="[object Error]"};this.inArray=function(n,t){var i=0,r;if(Array.prototype.indexOf)return n.indexOf(t,0)>=0;for(r=n.length;i<r;i++)if(i in n&&n[i]===t)return!0};this.createServiceUrl=function(n,t){var u=window.mParticle&&i._Store.SDKConfig.forceHttps?"https://":window.location.protocol+"//",r;return r=i._Store.SDKConfig.forceHttps?"https://"+n:u+n,t&&(r=r+t),r};this.createXHR=function(n){var t;try{t=new window.XMLHttpRequest}catch(r){i.Logger.error("Error creating XMLHttpRequest object.")}if(t&&n&&"withCredentials"in t)t.onreadystatechange=n;else if(typeof XDomainRequest!="undefined"){i.Logger.verbose("Creating XDomainRequest object");try{t=new window.XDomainRequest;t.onload=n}catch(r){i.Logger.error("Error creating XDomainRequest object")}}return t};this.generateUniqueId=function(n){return n?u(n):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,r.generateUniqueId)};this.filterUserIdentities=function(t,i){var e=[],u,f,o;if(t&&Object.keys(t).length)for(u in t)t.hasOwnProperty(u)&&(f=n.IdentityType.getIdentityType(u),r.inArray(i,f)||(o={Type:f,Identity:t[u]},f===n.IdentityType.CustomerId?e.unshift(o):e.push(o)));return e};this.filterUserIdentitiesForForwarders=function(t,i){var f={},u,e;if(t&&Object.keys(t).length)for(u in t)t.hasOwnProperty(u)&&(e=n.IdentityType.getIdentityType(u),r.inArray(i,e)||(f[u]=t[u]));return f};this.filterUserAttributes=function(n,t){var u={},i,f;if(n&&Object.keys(n).length)for(i in n)n.hasOwnProperty(i)&&(f=r.generateHash(i),r.inArray(t,f)||(u[i]=n[i]));return u};this.findKeyInObject=function(n,t){if(t&&n)for(var i in n)if(n.hasOwnProperty(i)&&i.toLowerCase()===t.toLowerCase())return i;return null};this.decoded=function(n){return decodeURIComponent(n.replace(ue," "))};this.converted=function(n){return n.indexOf('"')===0&&(n=n.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),n};this.isEventType=function(t){for(var i in n.EventType)if(n.EventType.hasOwnProperty(i)&&n.EventType[i]===t)return!0;return!1};this.parseNumber=function(n){if(isNaN(n)||!isFinite(n))return 0;var t=parseFloat(n);return isNaN(t)?0:t};this.parseStringOrNumber=function(n){return r.Validators.isStringOrNumber(n)?n:null};this.generateHash=function(n){var t=0,i=0,r;if(n===undefined||n===null)return 0;if(n=n.toString().toLowerCase(),Array.prototype.reduce)return n.split("").reduce(function(n,t){return n=(n<<5)-n+t.charCodeAt(0),n&n},0);if(n.length===0)return t;for(i=0;i<n.length;i++)r=n.charCodeAt(i),t=(t<<5)-t+r,t=t&t;return t};this.sanitizeAttributes=function(n){var u,t;if(!n||!r.isObject(n))return null;u={};for(t in n)n.hasOwnProperty(t)&&r.Validators.isValidAttributeValue(n[t])?u[t]=n[t]:i.Logger.warning("The corresponding attribute value of "+t+" must be a string, number, boolean, or null.");return u};this.Validators={isValidAttributeValue:function(n){return n!==undefined&&!r.isObject(n)&&!Array.isArray(n)},isValidKeyValue:function(n){return Boolean(n&&!r.isObject(n)&&!Array.isArray(n))},isStringOrNumber:function(n){return typeof n=="string"||typeof n=="number"},isNumber:function(n){return typeof n=="number"},isFunction:function(n){return typeof n=="function"},validateIdentities:function(u,f){var s={userIdentities:1,onUserAlias:1,copyUserAttributes:1},e,o;if(u){if(f==="modify"&&(r.isObject(u.userIdentities)&&!Object.keys(u.userIdentities).length||!r.isObject(u.userIdentities)))return{valid:!1,error:t.Messages.ValidationMessages.ModifyIdentityRequestUserIdentitiesPresent};for(e in u)if(u.hasOwnProperty(e)){if(!s[e])return{valid:!1,error:t.Messages.ValidationMessages.IdentityRequesetInvalidKey};if(e==="onUserAlias"&&!i._Helpers.Validators.isFunction(u[e]))return{valid:!1,error:t.Messages.ValidationMessages.OnUserAliasType+h(u[e])}}if(Object.keys(u).length===0)return{valid:!0};if(u.userIdentities===undefined)return{valid:!1,error:t.Messages.ValidationMessages.UserIdentities};if(u.userIdentities!==null&&!r.isObject(u.userIdentities))return{valid:!1,error:t.Messages.ValidationMessages.UserIdentities};if(r.isObject(u.userIdentities)&&Object.keys(u.userIdentities).length)for(o in u.userIdentities)if(u.userIdentities.hasOwnProperty(o)){if(n.IdentityType.getIdentityType(o)===!1)return{valid:!1,error:t.Messages.ValidationMessages.UserIdentitiesInvalidKey};if(!(typeof u.userIdentities[o]=="string"||u.userIdentities[o]===null))return{valid:!1,error:t.Messages.ValidationMessages.UserIdentitiesInvalidValues}}}return{valid:!0}}};this.isDelayedByIntegration=function(n,t,r){if(r-t>i._Store.SDKConfig.integrationDelayTimeout)return!1;for(var u in n){if(n[u]===!0)return!0;continue}return!1};this.createMainStorageName=function(n){return n?kt.currentStorageName+"_"+n:kt.currentStorageName};this.createProductStorageName=function(n){return n?kt.currentStorageProductsName+"_"+n:kt.currentStorageProductsName};this.isSlug=function(n){return n===re(n)}}function ee(n){var t=this;this.isBridgeV2Available=function(n){if(!n)return!1;var i=er+"_"+n+"_v2",t=fi+"_"+n+"_v2";return window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.hasOwnProperty(t)?!0:window.mParticle&&window.mParticle.uiwebviewBridgeName&&window.mParticle.uiwebviewBridgeName===t?!0:window.hasOwnProperty(i)?!0:!1};this.isWebviewEnabled=function(i,r){return(n._Store.bridgeV2Available=t.isBridgeV2Available(i),n._Store.bridgeV1Available=t.isBridgeV1Available(),r===2)?n._Store.bridgeV2Available:window.mParticle&&window.mParticle.uiwebviewBridgeName&&window.mParticle.uiwebviewBridgeName!==fi+"_"+i+"_v2"?!1:r<2?n._Store.bridgeV2Available||n._Store.bridgeV1Available:!1};this.isBridgeV1Available=function(){return n._Store.SDKConfig.useNativeSdk||window.mParticleAndroid||n._Store.SDKConfig.isIOS?!0:!1};this.sendToNative=function(i,r){if(n._Store.bridgeV2Available&&n._Store.SDKConfig.minWebviewBridgeVersion===2){t.sendViaBridgeV2(i,r,n._Store.SDKConfig.requiredWebviewBridgeName);return}if(n._Store.bridgeV2Available&&n._Store.SDKConfig.minWebviewBridgeVersion<2){t.sendViaBridgeV2(i,r,n._Store.SDKConfig.requiredWebviewBridgeName);return}if(n._Store.bridgeV1Available&&n._Store.SDKConfig.minWebviewBridgeVersion<2){t.sendViaBridgeV1(i,r);return}};this.sendViaBridgeV1=function(i,r){window.mParticleAndroid&&window.mParticleAndroid.hasOwnProperty(i)?(n.Logger.verbose(vt.InformationMessages.SendAndroid+i),window.mParticleAndroid[i](r)):n._Store.SDKConfig.isIOS&&(n.Logger.verbose(vt.InformationMessages.SendIOS+i),t.sendViaIframeToIOS(i,r))};this.sendViaIframeToIOS=function(n,t){var i=document.createElement("IFRAME");i.setAttribute("src","mp-sdk://"+n+"/"+encodeURIComponent(t));document.documentElement.appendChild(i);i.parentNode.removeChild(i)};this.sendViaBridgeV2=function(i,r,u){if(u){var h=er+"_"+u+"_v2",e=window[h],f=fi+"_"+u+"_v2",o,s;if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers[f]&&(o=window.webkit.messageHandlers[f]),n.uiwebviewBridgeName===f&&(s=n[f]),e&&e.hasOwnProperty(i)){n.Logger.verbose(vt.InformationMessages.SendAndroid+i);e[i](r);return}o?(n.Logger.verbose(vt.InformationMessages.SendIOS+i),o.postMessage(JSON.stringify({path:i,value:r?JSON.parse(r):null}))):s&&(n.Logger.verbose(vt.InformationMessages.SendIOS+i),t.sendViaIframeToIOS(i,r))}}}function oe(n){var t=this;this.attemptCookieSync=function(i,r){var u,e,o,s,f;r&&!n._Store.webviewBridgeEnabled&&n._Store.pixelConfigurations.forEach(function(h){u={moduleId:h.moduleId,frequencyCap:h.frequencyCap,pixelUrl:t.replaceAmp(h.pixelUrl),redirectUrl:h.redirectUrl?t.replaceAmp(h.redirectUrl):null};o=t.replaceMPID(u.pixelUrl,r);s=u.redirectUrl?t.replaceMPID(u.redirectUrl,r):"";f=o+encodeURIComponent(s);var c=n._Persistence.getPersistence();if(i&&i!==r){c&&c[r]&&(c[r].csd||(c[r].csd={}),t.performCookieSync(f,u.moduleId,r,c[r].csd));return}c[r]&&(c[r].csd||(c[r].csd={}),e=c[r].csd[u.moduleId.toString()]?c[r].csd[u.moduleId.toString()]:null,e?(new Date).getTime()>new Date(e).getTime()+u.frequencyCap*864e5&&t.performCookieSync(f,u.moduleId,r,c[r].csd):t.performCookieSync(f,u.moduleId,r,c[r].csd))})};this.replaceMPID=function(n,t){return n.replace("%%mpid%%",t)};this.replaceAmp=function(n){return n.replace(/&amp;/g,"&")};this.performCookieSync=function(t,i,r,u){var f=document.createElement("img");n.Logger.verbose(or.InformationMessages.CookieSync);f.src=t;u[i.toString()]=(new Date).getTime();n._Persistence.saveUserCookieSyncDatesToPersistence(r,u)}}function se(t){var i=this;this.initialize=function(){var r,n;t._Store.sessionId?(r=t._Store.SDKConfig.sessionTimeout*6e4,new Date>new Date(t._Store.dateLastEventSent.getTime()+r)?(i.endSession(),i.startNewSession()):(n=t._Persistence.getPersistence(),n&&!n.cu&&(t.Identity.identify(t._Store.SDKConfig.identifyRequest,t._Store.SDKConfig.identityCallback),t._Store.identifyCalled=!0,t._Store.SDKConfig.identityCallback=null))):i.startNewSession()};this.getSession=function(){return t._Store.sessionId};this.startNewSession=function(){var r,u,f;t.Logger.verbose(ht.InformationMessages.StartingNewSession);t._Helpers.canLog()?(t._Store.sessionId=t._Helpers.generateUniqueId().toUpperCase(),r=t.Identity.getCurrentUser(),u=r?r.getMPID():null,u&&(t._Store.currentSessionMPIDs=[u]),t._Store.sessionStartDate||(f=new Date,t._Store.sessionStartDate=f,t._Store.dateLastEventSent=f),i.setSessionTimer(),t._Store.identifyCalled||(t.Identity.identify(t._Store.SDKConfig.identifyRequest,t._Store.SDKConfig.identityCallback),t._Store.identifyCalled=!0,t._Store.SDKConfig.identityCallback=null),t._Events.logEvent({messageType:n.MessageType.SessionStart})):t.Logger.verbose(ht.InformationMessages.AbandonStartSession)};this.endSession=function(r){var f,u,e,o;if(t.Logger.verbose(ht.InformationMessages.StartingEndSession),r)t._Events.logEvent({messageType:n.MessageType.SessionEnd}),t._Store.sessionId=null,t._Store.dateLastEventSent=null,t._Store.sessionAttributes={},t._Persistence.update();else if(t._Helpers.canLog()){if(u=t._Persistence.getPersistence(),!u)return;if(u.gs&&!u.gs.sid){t.Logger.verbose(ht.InformationMessages.NoSessionToEnd);return}u.gs.sid&&t._Store.sessionId!==u.gs.sid&&(t._Store.sessionId=u.gs.sid);u.gs&&u.gs.les&&(f=t._Store.SDKConfig.sessionTimeout*6e4,o=(new Date).getTime(),e=o-u.gs.les,e<f?i.setSessionTimer():(t._Events.logEvent({messageType:n.MessageType.SessionEnd}),t._Store.sessionId=null,t._Store.dateLastEventSent=null,t._Store.sessionStartDate=null,t._Store.sessionAttributes={},t._Persistence.update()))}else t.Logger.verbose(ht.InformationMessages.AbandonEndSession)};this.setSessionTimer=function(){var n=t._Store.SDKConfig.sessionTimeout*6e4;t._Store.globalTimer=window.setTimeout(function(){i.endSession()},n)};this.resetSessionTimer=function(){t._Store.webviewBridgeEnabled||(t._Store.sessionId||i.startNewSession(),i.clearSessionTimeout(),i.setSessionTimer());i.startNewSessionIfNeeded()};this.clearSessionTimeout=function(){clearTimeout(t._Store.globalTimer)};this.startNewSessionIfNeeded=function(){if(!t._Store.webviewBridgeEnabled){var n=t._Persistence.getPersistence();!t._Store.sessionId&&n&&(n.sid?t._Store.sessionId=n.sid:i.startNewSession())}}}function he(t){var i=this;this.convertTransactionAttributesToProductAction=function(n,t){n.hasOwnProperty("Id")&&(t.TransactionId=n.Id);n.hasOwnProperty("Affiliation")&&(t.Affiliation=n.Affiliation);n.hasOwnProperty("CouponCode")&&(t.CouponCode=n.CouponCode);n.hasOwnProperty("Revenue")&&(t.TotalAmount=n.Revenue);n.hasOwnProperty("Shipping")&&(t.ShippingAmount=n.Shipping);n.hasOwnProperty("Tax")&&(t.TaxAmount=n.Tax);n.hasOwnProperty("Step")&&(t.CheckoutStep=n.Step);n.hasOwnProperty("Option")&&(t.CheckoutOptions=n.Option)};this.getProductActionEventName=function(t){switch(t){case n.ProductActionType.AddToCart:return"AddToCart";case n.ProductActionType.AddToWishlist:return"AddToWishlist";case n.ProductActionType.Checkout:return"Checkout";case n.ProductActionType.CheckoutOption:return"CheckoutOption";case n.ProductActionType.Click:return"Click";case n.ProductActionType.Purchase:return"Purchase";case n.ProductActionType.Refund:return"Refund";case n.ProductActionType.RemoveFromCart:return"RemoveFromCart";case n.ProductActionType.RemoveFromWishlist:return"RemoveFromWishlist";case n.ProductActionType.ViewDetail:return"ViewDetail";case n.ProductActionType.Unknown:default:return"Unknown"}};this.getPromotionActionEventName=function(t){switch(t){case n.PromotionActionType.PromotionClick:return"PromotionClick";case n.PromotionActionType.PromotionView:return"PromotionView";default:return"Unknown"}};this.convertProductActionToEventType=function(i){switch(i){case n.ProductActionType.AddToCart:return n.CommerceEventType.ProductAddToCart;case n.ProductActionType.AddToWishlist:return n.CommerceEventType.ProductAddToWishlist;case n.ProductActionType.Checkout:return n.CommerceEventType.ProductCheckout;case n.ProductActionType.CheckoutOption:return n.CommerceEventType.ProductCheckoutOption;case n.ProductActionType.Click:return n.CommerceEventType.ProductClick;case n.ProductActionType.Purchase:return n.CommerceEventType.ProductPurchase;case n.ProductActionType.Refund:return n.CommerceEventType.ProductRefund;case n.ProductActionType.RemoveFromCart:return n.CommerceEventType.ProductRemoveFromCart;case n.ProductActionType.RemoveFromWishlist:return n.CommerceEventType.ProductRemoveFromWishlist;case n.ProductActionType.Unknown:return n.EventType.Unknown;case n.ProductActionType.ViewDetail:return n.CommerceEventType.ProductViewDetail;default:return t.Logger.error("Could not convert product action type "+i+" to event type"),null}};this.convertPromotionActionToEventType=function(i){switch(i){case n.PromotionActionType.PromotionClick:return n.CommerceEventType.PromotionClick;case n.PromotionActionType.PromotionView:return n.CommerceEventType.PromotionView;default:return t.Logger.error("Could not convert promotion action type "+i+" to event type"),null}};this.generateExpandedEcommerceName=function(n,t){return"eCommerce - "+n+" - "+(t?"Total":"Item")};this.extractProductAttributes=function(n,t){t.CouponCode&&(n["Coupon Code"]=t.CouponCode);t.Brand&&(n.Brand=t.Brand);t.Category&&(n.Category=t.Category);t.Name&&(n.Name=t.Name);t.Sku&&(n.Id=t.Sku);t.Price&&(n["Item Price"]=t.Price);t.Quantity&&(n.Quantity=t.Quantity);t.Position&&(n.Position=t.Position);t.Variant&&(n.Variant=t.Variant);n["Total Product Amount"]=t.TotalAmount||0};this.extractTransactionId=function(n,t){t.TransactionId&&(n["Transaction Id"]=t.TransactionId)};this.extractActionAttributes=function(n,t){i.extractTransactionId(n,t);t.Affiliation&&(n.Affiliation=t.Affiliation);t.CouponCode&&(n["Coupon Code"]=t.CouponCode);t.TotalAmount&&(n["Total Amount"]=t.TotalAmount);t.ShippingAmount&&(n["Shipping Amount"]=t.ShippingAmount);t.TaxAmount&&(n["Tax Amount"]=t.TaxAmount);t.CheckoutOptions&&(n["Checkout Options"]=t.CheckoutOptions);t.CheckoutStep&&(n["Checkout Step"]=t.CheckoutStep)};this.extractPromotionAttributes=function(n,t){t.Id&&(n.Id=t.Id);t.Creative&&(n.Creative=t.Creative);t.Name&&(n.Name=t.Name);t.Position&&(n.Position=t.Position)};this.buildProductList=function(n,t){return t?Array.isArray(t)?t:[t]:n.ShoppingCart.ProductList};this.createProduct=function(n,i,r,u,f,e,o,s,h,c){return(c=t._Helpers.sanitizeAttributes(c),typeof n!="string")?(t.Logger.error("Name is required when creating a product"),null):t._Helpers.Validators.isStringOrNumber(i)?t._Helpers.Validators.isStringOrNumber(r)?(s&&!t._Helpers.Validators.isNumber(s)&&(t.Logger.error("Position must be a number, it will be set to null."),s=null),u||(u=1),{Name:n,Sku:i,Price:r,Quantity:u,Brand:o,Variant:f,Category:e,Position:s,CouponCode:h,TotalAmount:u*r,Attributes:c}):(t.Logger.error("Price is required when creating a product, and must be a string or a number"),null):(t.Logger.error("SKU is required when creating a product, and must be a string or a number"),null)};this.createPromotion=function(n,i,r,u){return t._Helpers.Validators.isStringOrNumber(n)?{Id:n,Creative:i,Name:r,Position:u}:(t.Logger.error(yt.ErrorMessages.PromotionIdRequired),null)};this.createImpression=function(n,i){return typeof n!="string"?(t.Logger.error("Name is required when creating an impression."),null):i?{Name:n,Product:i}:(t.Logger.error("Product is required when creating an impression."),null)};this.createTransactionAttributes=function(n,i,r,u,f,e){return t._Helpers.Validators.isStringOrNumber(n)?{Id:n,Affiliation:i,CouponCode:r,Revenue:u,Shipping:f,Tax:e}:(t.Logger.error(yt.ErrorMessages.TransactionIdRequired),null)};this.expandProductImpression=function(r){var u=[];return r.ProductImpressions?(r.ProductImpressions.forEach(function(f){f.ProductList&&f.ProductList.forEach(function(e){var o=t._Helpers.extend(!1,{},r.EventAttributes),s,h;if(e.Attributes)for(s in e.Attributes)o[s]=e.Attributes[s];i.extractProductAttributes(o,e);f.ProductImpressionList&&(o["Product Impression List"]=f.ProductImpressionList);h=t._ServerModel.createEventObject({messageType:n.MessageType.PageEvent,name:i.generateExpandedEcommerceName("Impression"),data:o,eventType:n.EventType.Transaction});u.push(h)})}),u):u};this.expandCommerceEvent=function(n){return n?i.expandProductAction(n).concat(i.expandPromotionAction(n)).concat(i.expandProductImpression(n)):null};this.expandPromotionAction=function(r){var u=[],f;return r.PromotionAction?(f=r.PromotionAction.PromotionList,f.forEach(function(f){var e=t._Helpers.extend(!1,{},r.EventAttributes),o;i.extractPromotionAttributes(e,f);o=t._ServerModel.createEventObject({messageType:n.MessageType.PageEvent,name:i.generateExpandedEcommerceName(n.PromotionActionType.getExpansionName(r.PromotionAction.PromotionActionType)),data:e,eventType:n.EventType.Transaction});u.push(o)}),u):u};this.expandProductAction=function(r){var u=[],e,f,s,o;return r.ProductAction?(e=!1,r.ProductAction.ProductActionType===n.ProductActionType.Purchase||r.ProductAction.ProductActionType===n.ProductActionType.Refund?(f=t._Helpers.extend(!1,{},r.EventAttributes),f["Product Count"]=r.ProductAction.ProductList?r.ProductAction.ProductList.length:0,i.extractActionAttributes(f,r.ProductAction),r.CurrencyCode&&(f["Currency Code"]=r.CurrencyCode),s=t._ServerModel.createEventObject({messageType:n.MessageType.PageEvent,name:i.generateExpandedEcommerceName(n.ProductActionType.getExpansionName(r.ProductAction.ProductActionType),!0),data:f,eventType:n.EventType.Transaction}),u.push(s)):e=!0,o=r.ProductAction.ProductList,!o)?u:(o.forEach(function(f){var o=t._Helpers.extend(!1,r.EventAttributes,f.Attributes),s;e?i.extractActionAttributes(o,r.ProductAction):i.extractTransactionId(o,r.ProductAction);i.extractProductAttributes(o,f);s=t._ServerModel.createEventObject({messageType:n.MessageType.PageEvent,name:i.generateExpandedEcommerceName(n.ProductActionType.getExpansionName(r.ProductAction.ProductActionType)),data:o,eventType:n.EventType.Transaction});u.push(s)}),u):u};this.createCommerceEventObject=function(i){var r;return(t.Logger.verbose(yt.InformationMessages.StartingLogCommerceEvent),t._Helpers.canLog())?(r=t._ServerModel.createEventObject({messageType:n.MessageType.Commerce}),r.EventName="eCommerce - ",r.CurrencyCode=t._Store.currencyCode,r.ShoppingCart=[],r.CustomFlags=i,r):(t.Logger.verbose(yt.InformationMessages.AbandonLogEvent),null)}}function ce(n){var r={};for(var i in t.DefaultConfig)t.DefaultConfig.hasOwnProperty(i)&&(r[i]=t.DefaultConfig[i]);if(n)for(i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);for(i in t.DefaultUrls)r[i]=t.DefaultUrls[i];return r}function sr(n,i){var f={isEnabled:!0,sessionAttributes:{},currentSessionMPIDs:[],consentState:null,sessionId:null,isFirstRun:null,clientId:null,deviceId:null,devToken:null,migrationData:{},serverSettings:{},dateLastEventSent:null,sessionStartDate:null,currentPosition:null,isTracking:!1,watchPositionId:null,cartProducts:[],eventQueue:[],currencyCode:null,globalTimer:null,context:"",configurationLoaded:!1,identityCallInFlight:!1,SDKConfig:{},migratingToIDSyncCookies:!1,nonCurrentUserMPIDs:{},identifyCalled:!1,isLoggedIn:!1,cookieSyncDates:{},integrationAttributes:{},requireDelay:!0,isLocalStorageAvailable:null,storageName:null,prodStorageName:null,activeForwarders:[],kits:{},configuredForwarders:[],pixelConfigurations:[]},r,u;for(r in f)this[r]=f[r];this.integrationDelayTimeoutStart=Date.now();this.SDKConfig=ce(n);n&&(this.SDKConfig.isDevelopmentMode=n.hasOwnProperty("isDevelopmentMode")?i._Helpers.returnConvertedBoolean(n.isDevelopmentMode):!1,n.hasOwnProperty("v1SecureServiceUrl")&&(this.SDKConfig.v1SecureServiceUrl=n.v1SecureServiceUrl),n.hasOwnProperty("v2SecureServiceUrl")&&(this.SDKConfig.v2SecureServiceUrl=n.v2SecureServiceUrl),n.hasOwnProperty("v3SecureServiceUrl")&&(this.SDKConfig.v3SecureServiceUrl=n.v3SecureServiceUrl),n.hasOwnProperty("identityUrl")&&(this.SDKConfig.identityUrl=n.identityUrl),n.hasOwnProperty("aliasUrl")&&(this.SDKConfig.aliasUrl=n.aliasUrl),n.hasOwnProperty("configUrl")&&(this.SDKConfig.configUrl=n.configUrl),n.hasOwnProperty("logLevel")&&(this.SDKConfig.logLevel=n.logLevel),this.SDKConfig.useNativeSdk=n.hasOwnProperty("useNativeSdk")?n.useNativeSdk:!1,n.hasOwnProperty("kits")&&(this.SDKConfig.kits=n.kits),this.SDKConfig.isIOS=n.hasOwnProperty("isIOS")?n.isIOS:window.mParticle&&window.mParticle.isIOS?window.mParticle.isIOS:!1,this.SDKConfig.useCookieStorage=n.hasOwnProperty("useCookieStorage")?n.useCookieStorage:!1,this.SDKConfig.maxProducts=n.hasOwnProperty("maxProducts")?n.maxProducts:t.DefaultConfig.maxProducts,this.SDKConfig.maxCookieSize=n.hasOwnProperty("maxCookieSize")?n.maxCookieSize:t.DefaultConfig.maxCookieSize,n.hasOwnProperty("appName")&&(this.SDKConfig.appName=n.appName),this.SDKConfig.integrationDelayTimeout=n.hasOwnProperty("integrationDelayTimeout")?n.integrationDelayTimeout:t.DefaultConfig.integrationDelayTimeout,n.hasOwnProperty("identifyRequest")&&(this.SDKConfig.identifyRequest=n.identifyRequest),n.hasOwnProperty("identityCallback")&&(u=n.identityCallback,i._Helpers.Validators.isFunction(u)?this.SDKConfig.identityCallback=n.identityCallback:i.Logger.warning("The optional callback must be a function. You tried entering a(n) "+h(u)," . Callback not set. Please set your callback again.")),n.hasOwnProperty("appVersion")&&(this.SDKConfig.appVersion=n.appVersion),n.hasOwnProperty("appName")&&(this.SDKConfig.appName=n.appName),n.hasOwnProperty("sessionTimeout")&&(this.SDKConfig.sessionTimeout=n.sessionTimeout),n.hasOwnProperty("dataPlan")&&(this.SDKConfig.dataPlan={PlanVersion:null,PlanId:null},n.dataPlan.hasOwnProperty("planId")&&(typeof n.dataPlan.planId=="string"?i._Helpers.isSlug(n.dataPlan.planId)?this.SDKConfig.dataPlan.PlanId=n.dataPlan.planId:i.Logger.error("Your data plan id must be in a slug format"):i.Logger.error("Your data plan id must be a string")),n.dataPlan.hasOwnProperty("planVersion")&&(typeof n.dataPlan.planVersion=="number"?this.SDKConfig.dataPlan.PlanVersion=n.dataPlan.planVersion:i.Logger.error("Your data plan version must be a number"))),this.SDKConfig.forceHttps=n.hasOwnProperty("forceHttps")?n.forceHttps:!0,n.hasOwnProperty("customFlags")&&(this.SDKConfig.customFlags=n.customFlags),this.SDKConfig.minWebviewBridgeVersion=n.hasOwnProperty("minWebviewBridgeVersion")?n.minWebviewBridgeVersion:1,this.SDKConfig.aliasMaxWindow=n.hasOwnProperty("aliasMaxWindow")?n.aliasMaxWindow:t.DefaultConfig.aliasMaxWindow,n.hasOwnProperty("flags")||(this.SDKConfig.flags={}),this.SDKConfig.flags.hasOwnProperty(t.FeatureFlags.EventsV3)||(this.SDKConfig.flags[t.FeatureFlags.EventsV3]=0),this.SDKConfig.flags.hasOwnProperty(t.FeatureFlags.EventBatchingIntervalMillis)||(this.SDKConfig.flags[t.FeatureFlags.EventBatchingIntervalMillis]=t.DefaultConfig.uploadInterval),this.SDKConfig.flags.hasOwnProperty(t.FeatureFlags.ReportBatching)||(this.SDKConfig.flags[t.FeatureFlags.ReportBatching]=!1))}function le(n){var i=this,t=n.logLevel||"warning";this.logger=n.hasOwnProperty("logger")?n.logger:new ae;this.verbose=function(n){t!=="none"&&i.logger.verbose&&t==="verbose"&&i.logger.verbose(n)};this.warning=function(n){t!=="none"&&i.logger.warning&&(t==="verbose"||t==="warning")&&i.logger.warning(n)};this.error=function(n){t!=="none"&&i.logger.error&&i.logger.error(n)};this.setLogLevel=function(n){t=n}}function ae(){this.verbose=function(n){window.console&&window.console.info&&window.console.info(n)};this.error=function(n){window.console&&window.console.error&&window.console.error(n)};this.warning=function(n){window.console&&window.console.warn&&window.console.warn(n)}}function ve(n){function u(t){var i=n._Store;return t.gs.sid=i.sessionId,t.gs.ie=i.isEnabled,t.gs.sa=i.sessionAttributes,t.gs.ss=i.serverSettings,t.gs.dt=i.devToken,t.gs.les=i.dateLastEventSent?i.dateLastEventSent.getTime():null,t.gs.av=i.SDKConfig.appVersion,t.gs.cgid=i.clientId,t.gs.das=i.deviceId,t.gs.c=i.context,t.gs.ssd=i.sessionStartDate?i.sessionStartDate.getTime():null,t.gs.ia=i.integrationAttributes,t}function i(n){localStorage.removeItem(n)}function r(n,i,r){return t.encodePersistence(JSON.stringify(n))+";expires="+i+";path=/"+r}var t=this;this.useLocalStorage=function(){return!n._Store.SDKConfig.useCookieStorage&&n._Store.isLocalStorageAvailable};this.initializeStorage=function(){var o,r,i,u,e,s,f;try{r=t.getLocalStorage();i=t.getCookie();r||i?n._Store.isFirstRun=!1:(n._Store.isFirstRun=!0,n._Store.mpid=0);n._Store.isLocalStorageAvailable||(n._Store.SDKConfig.useCookieStorage=!0);n._Store.isLocalStorageAvailable?(o=window.localStorage,n._Store.SDKConfig.useCookieStorage?(r?(u=i?n._Helpers.extend(!1,r,i):r,o.removeItem(n._Store.storageName)):i&&(u=i),t.storeDataInMemory(u)):i?(u=r?n._Helpers.extend(!1,r,i):i,t.storeDataInMemory(u),t.expireCookies(n._Store.storageName)):t.storeDataInMemory(r)):t.storeDataInMemory(i);try{n._Store.isLocalStorageAvailable&&(e=localStorage.getItem(n._Store.prodStorageName),e&&(s=JSON.parse(k.decode(e))),n._Store.mpid&&t.storeProductsInMemory(s,n._Store.mpid))}catch(h){n._Store.isLocalStorageAvailable&&localStorage.removeItem(n._Store.prodStorageName);n._Store.cartProducts=[];n.Logger.error("Error loading products in initialization: "+h)}for(f in u)u.hasOwnProperty(f)&&(pt[f]||(n._Store.nonCurrentUserMPIDs[f]=u[f]));t.update()}catch(h){t.useLocalStorage()&&n._Store.isLocalStorageAvailable?localStorage.removeItem(n._Store.storageName):t.expireCookies(n._Store.storageName);n.Logger.error("Error initializing storage: "+h)}};this.update=function(){n._Store.webviewBridgeEnabled||(n._Store.SDKConfig.useCookieStorage&&t.setCookie(),t.setLocalStorage())};this.storeProductsInMemory=function(t,i){if(t)try{n._Store.cartProducts=t[i]&&t[i].cp?t[i].cp:[]}catch(r){n.Logger.error(ct.ErrorMessages.CookieParseError)}};this.storeDataInMemory=function(t,i){try{t?(n._Store.mpid=i?i:t.cu||0,t.gs=t.gs||{},n._Store.sessionId=t.gs.sid||n._Store.sessionId,n._Store.isEnabled=typeof t.gs.ie!="undefined"?t.gs.ie:n._Store.isEnabled,n._Store.sessionAttributes=t.gs.sa||n._Store.sessionAttributes,n._Store.serverSettings=t.gs.ss||n._Store.serverSettings,n._Store.devToken=n._Store.devToken||t.gs.dt,n._Store.SDKConfig.appVersion=n._Store.SDKConfig.appVersion||t.gs.av,n._Store.clientId=t.gs.cgid||n._Store.clientId||n._Helpers.generateUniqueId(),n._Store.deviceId=t.gs.das||n._Store.deviceId||n._Helpers.generateUniqueId(),n._Store.integrationAttributes=t.gs.ia||{},n._Store.context=t.gs.c||n._Store.context,n._Store.currentSessionMPIDs=t.gs.csm||n._Store.currentSessionMPIDs,n._Store.isLoggedIn=t.l===!0,t.gs.les&&(n._Store.dateLastEventSent=new Date(t.gs.les)),n._Store.sessionStartDate=t.gs.ssd?new Date(t.gs.ssd):new Date,t=i?t[i]:t[t.cu]):(n.Logger.verbose(ct.InformationMessages.CookieNotFound),n._Store.clientId=n._Store.clientId||n._Helpers.generateUniqueId(),n._Store.deviceId=n._Store.deviceId||n._Helpers.generateUniqueId())}catch(r){n.Logger.error(ct.ErrorMessages.CookieParseError)}};this.determineLocalStorageAvailability=function(n){var t;window.mParticle&&window.mParticle._forceNoLocalStorage&&(n=undefined);try{return n.setItem("mparticle","test"),t=n.getItem("mparticle")==="test",n.removeItem("mparticle"),t&&n}catch(i){return!1}};this.getUserProductsFromLS=function(t){if(!n._Store.isLocalStorageAvailable)return[];var r,i,u=localStorage.getItem(n._Store.prodStorageName);if(u&&(r=k.decode(u)),t)try{return r&&(i=JSON.parse(r)),r&&i[t]&&i[t].cp&&Array.isArray(i[t].cp)?i[t].cp:[]}catch(f){return[]}else return[]};this.getAllUserProductsFromLS=function(){var i,r=localStorage.getItem(n._Store.prodStorageName),t;r&&(i=k.decode(r));try{t=JSON.parse(i)}catch(u){t={}}return t};this.setLocalStorage=function(){if(n._Store.isLocalStorageAvailable){var o=n._Store.storageName,r=t.getAllUserProductsFromLS(),i=t.getLocalStorage()||{},e=n.Identity.getCurrentUser(),f=e?e.getMPID():null,s={cp:r[f]?r[f].cp:[]};if(f){r=r||{};r[f]=s;try{window.localStorage.setItem(encodeURIComponent(n._Store.prodStorageName),k.encode(JSON.stringify(r)))}catch(h){n.Logger.error("Error with setting products on localStorage.")}}if(!n._Store.SDKConfig.useCookieStorage){i.gs=i.gs||{};i.l=n._Store.isLoggedIn?1:0;n._Store.sessionId&&(i.gs.csm=n._Store.currentSessionMPIDs);i.gs.ie=n._Store.isEnabled;f&&(i.cu=f);Object.keys(n._Store.nonCurrentUserMPIDs).length&&(i=n._Helpers.extend({},i,n._Store.nonCurrentUserMPIDs),n._Store.nonCurrentUserMPIDs={});i=u(i);try{window.localStorage.setItem(encodeURIComponent(o),t.encodePersistence(JSON.stringify(i)))}catch(h){n.Logger.error("Error with setting localStorage item.")}}}};this.getLocalStorage=function(){if(!n._Store.isLocalStorageAvailable)return null;var f=n._Store.storageName,i=t.decodePersistence(window.localStorage.getItem(f)),u={},r;if(i){i=JSON.parse(i);for(r in i)i.hasOwnProperty(r)&&(u[r]=i[r])}return Object.keys(u).length?u:null};this.expireCookies=function(n){var i=new Date,u,f,r;r=t.getCookieDomain();f=r===""?"":";domain="+r;i.setTime(i.getTime()-864e5);u="; expires="+i.toUTCString();document.cookie=n+"="+u+"; path=/"+f};this.getCookie=function(){var s=window.document.cookie.split("; "),i=n._Store.storageName,r,h,f,e,o,u=i?undefined:{};for(n.Logger.verbose(ct.InformationMessages.CookieSearch),r=0,h=s.length;r<h;r++){if(f=s[r].split("="),e=n._Helpers.decoded(f.shift()),o=n._Helpers.decoded(f.join("=")),i&&i===e){u=n._Helpers.converted(o);break}i||(u[e]=n._Helpers.converted(o))}return u?(n.Logger.verbose(ct.InformationMessages.CookieFound),JSON.parse(t.decodePersistence(u))):null};this.setCookie=function(){var r,e=n.Identity.getCurrentUser();e&&(r=e.getMPID());var h=new Date,c=n._Store.storageName,i=t.getCookie()||{},l=new Date(h.getTime()+n._Store.SDKConfig.cookieExpiration*864e5).toGMTString(),f,o,s;f=t.getCookieDomain();o=f===""?"":";domain="+f;i.gs=i.gs||{};n._Store.sessionId&&(i.gs.csm=n._Store.currentSessionMPIDs);r&&(i.cu=r);i.l=n._Store.isLoggedIn?1:0;i=u(i);Object.keys(n._Store.nonCurrentUserMPIDs).length&&(i=n._Helpers.extend({},i,n._Store.nonCurrentUserMPIDs),n._Store.nonCurrentUserMPIDs={});s=t.reduceAndEncodePersistence(i,l,o,n._Store.SDKConfig.maxCookieSize);n.Logger.verbose(ct.InformationMessages.CookieSet);window.document.cookie=encodeURIComponent(c)+"="+s};this.reduceAndEncodePersistence=function(t,i,u,f){var e,c=t.gs.csm?t.gs.csm:[],o,s,h,l,a,v;if(c.length){s={};for(h in t)t.hasOwnProperty(h)&&(pt[h]||h===t.cu||(s[h]=1));if(Object.keys(s).length)for(l in s)e=r(t,i,u),e.length>f&&s.hasOwnProperty(l)&&c.indexOf(l)===-1&&delete t[l];for(a=0;a<c.length;a++)if(e=r(t,i,u),e.length>f)v=c[a],t[v]?(n.Logger.verbose("Size of new encoded cookie is larger than maxCookieSize setting of "+f+". Removing from cookie the earliest logged in MPID containing: "+JSON.stringify(t[v],0,2)),delete t[v]):n.Logger.error("Unable to save MPID data to cookies because the resulting encoded cookie is larger than the maxCookieSize setting of "+f+". We recommend using a maxCookieSize of 1500.");else break}else for(o in t)t.hasOwnProperty(o)&&(e=r(t,i,u),e.length>f&&(pt[o]||o===t.cu||delete t[o]));return e};this.findPrevCookiesBasedOnUI=function(i){var r=n._Persistence.getPersistence(),f,e,u,o,s;if(i)for(e in i.userIdentities)if(r&&Object.keys(r).length)for(u in r)if(r[u].mpid){o=r[u].ui;for(s in o)if(e===s&&i.userIdentities[e]===o[s]){f=u;break}}f&&t.storeDataInMemory(r,f)};this.encodePersistence=function(i){var r,u;i=JSON.parse(i);for(r in i.gs)i.gs.hasOwnProperty(r)&&(dt[r]?i.gs[r]?Array.isArray(i.gs[r])&&i.gs[r].length||n._Helpers.isObject(i.gs[r])&&Object.keys(i.gs[r]).length?i.gs[r]=k.encode(JSON.stringify(i.gs[r])):delete i.gs[r]:delete i.gs[r]:r==="ie"?i.gs[r]=i.gs[r]?1:0:i.gs[r]||delete i.gs[r]);for(u in i)if(i.hasOwnProperty(u)&&!pt[u])for(r in i[u])i[u].hasOwnProperty(r)&&dt[r]&&(n._Helpers.isObject(i[u][r])&&Object.keys(i[u][r]).length?i[u][r]=k.encode(JSON.stringify(i[u][r])):delete i[u][r]);return t.createCookieString(JSON.stringify(i))};this.decodePersistence=function(i){var r,u;try{if(i){if(i=JSON.parse(t.revertCookieString(i)),n._Helpers.isObject(i)&&Object.keys(i).length){for(r in i.gs)i.gs.hasOwnProperty(r)&&(dt[r]?i.gs[r]=JSON.parse(k.decode(i.gs[r])):r==="ie"&&(i.gs[r]=Boolean(i.gs[r])));for(u in i)if(i.hasOwnProperty(u))if(pt[u])u==="l"&&(i[u]=Boolean(i[u]));else for(r in i[u])i[u].hasOwnProperty(r)&&dt[r]&&i[u][r].length&&(i[u][r]=JSON.parse(k.decode(i[u][r])))}return JSON.stringify(i)}}catch(f){n.Logger.error("Problem with decoding cookie",f)}};this.replaceCommasWithPipes=function(n){return n.replace(/,/g,"|")};this.replacePipesWithCommas=function(n){return n.replace(/\|/g,",")};this.replaceApostrophesWithQuotes=function(n){return n.replace(/\'/g,'"')};this.replaceQuotesWithApostrophes=function(n){return n.replace(/\"/g,"'")};this.createCookieString=function(n){return t.replaceCommasWithPipes(t.replaceQuotesWithApostrophes(n))};this.revertCookieString=function(n){return t.replacePipesWithCommas(t.replaceApostrophesWithQuotes(n))};this.getCookieDomain=function(){if(n._Store.SDKConfig.cookieDomain)return n._Store.SDKConfig.cookieDomain;var i=t.getDomain(document,location.hostname);return i===""?"":"."+i};this.getDomain=function(n,t){for(var r,u="mptest=cookie",f=t.split("."),i=f.length-1;i>=0;i--)if(r=f.slice(i).join("."),n.cookie=u+";domain=."+r+";",n.cookie.indexOf(u)>-1)return n.cookie=u.split("=")[0]+"=;domain=."+r+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",r;return""};this.getUserIdentities=function(n){var i=t.getPersistence();return i&&i[n]&&i[n].ui?i[n].ui:{}};this.getAllUserAttributes=function(n){var i=t.getPersistence();return i&&i[n]&&i[n].ua?i[n].ua:{}};this.getCartProducts=function(t){var i,r=localStorage.getItem(n._Store.prodStorageName);return r&&(i=JSON.parse(k.decode(r)),i&&i[t]&&i[t].cp)?i[t].cp:[]};this.setCartProducts=function(t){if(n._Store.isLocalStorageAvailable)try{window.localStorage.setItem(encodeURIComponent(n._Store.prodStorageName),k.encode(JSON.stringify(t)))}catch(i){n.Logger.error("Error with setting products on localStorage.")}};this.saveUserIdentitiesToPersistence=function(n,i){if(i){var r=t.getPersistence();r&&(r[n]?r[n].ui=i:r[n]={ui:i},t.savePersistence(r))}};this.saveUserAttributesToPersistence=function(n,i){var r=t.getPersistence();i&&(r&&(r[n]?r[n].ui=i:r[n]={ui:i}),t.savePersistence(r))};this.saveUserCookieSyncDatesToPersistence=function(n,i){if(i){var r=t.getPersistence();r&&(r[n]?r[n].csd=i:r[n]={csd:i});t.savePersistence(r)}};this.saveUserConsentStateToCookies=function(i,r){if(r||r===null){var u=t.getPersistence();u&&(u[i]?u[i].con=n._Consent.ConsentSerialization.toMinifiedJsonObject(r):u[i]={con:n._Consent.ConsentSerialization.toMinifiedJsonObject(r)},t.savePersistence(u))}};this.savePersistence=function(i){var e=t.encodePersistence(JSON.stringify(i)),o=new Date,s=n._Store.storageName,h=new Date(o.getTime()+n._Store.SDKConfig.cookieExpiration*864e5).toGMTString(),r=t.getCookieDomain(),u,f;u=r===""?"":";domain="+r;n._Store.SDKConfig.useCookieStorage?(f=t.reduceAndEncodePersistence(i,h,u,n._Store.SDKConfig.maxCookieSize),window.document.cookie=encodeURIComponent(s)+"="+f):n._Store.isLocalStorageAvailable&&localStorage.setItem(n._Store.storageName,e)};this.getPersistence=function(){return this.useLocalStorage()?this.getLocalStorage():this.getCookie()};this.getConsentState=function(i){var r=t.getPersistence();return r&&r[i]&&r[i].con?n._Consent.ConsentSerialization.fromMinifiedJsonObject(r[i].con):null};this.getFirstSeenTime=function(n){if(!n)return null;var i=t.getPersistence();return i&&i[n]&&i[n].fst?i[n].fst:null};this.setFirstSeenTime=function(n,i){if(n){i||(i=(new Date).getTime());var r=t.getPersistence();r&&(r[n]||(r[n]={}),r[n].fst||(r[n].fst=i,t.savePersistence(r)))}};this.getLastSeenTime=function(i){if(!i)return null;if(i===n.Identity.getCurrentUser().getMPID())return(new Date).getTime();var r=t.getPersistence();return r&&r[i]&&r[i].lst?r[i].lst:null};this.setLastSeenTime=function(n,i){if(n){i||(i=(new Date).getTime());var r=t.getPersistence();r&&r[n]&&(r[n].lst=i,t.savePersistence(r))}};this.getDeviceId=function(){return n._Store.deviceId};this.resetPersistence=function(){if(i(it.localStorageName),i(it.localStorageNameV3),i(it.localStorageNameV4),i(n._Store.prodStorageName),i(n._Store.storageName),i(it.localStorageProductsV4),t.expireCookies(it.cookieName),t.expireCookies(it.cookieNameV2),t.expireCookies(it.cookieNameV3),t.expireCookies(it.cookieNameV4),t.expireCookies(n._Store.prodStorageName),t.expireCookies(n._Store.storageName),mParticle._isTestEnv){var r="abcdef";i(n._Helpers.createMainStorageName(r));t.expireCookies(n._Helpers.createMainStorageName(r));i(n._Helpers.createProductStorageName(r))}};this.forwardingStatsBatches={uploadsTable:{},forwardingStatsEventQueue:[]}}function ye(t){var i=this;this.logEvent=function(n){if(t.Logger.verbose(rt.InformationMessages.StartingLogEvent+": "+n.name),t._Helpers.canLog()){n.data&&(n.data=t._Helpers.sanitizeAttributes(n.data));var i=t._ServerModel.createEventObject(n);t._APIClient.sendEventToServer(i)}else t.Logger.verbose(rt.InformationMessages.AbandonLogEvent)};this.startTracking=function(n){function u(r){t._Store.currentPosition={lat:r.coords.latitude,lng:r.coords.longitude};i(n,r);n=null;t._Store.isTracking=!0}function f(){i(n);n=null;t._Store.isTracking=!1}function i(n,i){if(n)try{i?n(i):n()}catch(r){t.Logger.error("Error invoking the callback passed to startTrackingLocation.");t.Logger.error(r)}}if(t._Store.isTracking){var r={coords:{latitude:t._Store.currentPosition.lat,longitude:t._Store.currentPosition.lng}};i(n,r)}else"geolocation"in navigator&&(t._Store.watchPositionId=navigator.geolocation.watchPosition(u,f))};this.stopTracking=function(){t._Store.isTracking&&(navigator.geolocation.clearWatch(t._Store.watchPositionId),t._Store.currentPosition=null,t._Store.isTracking=!1)};this.logOptOut=function(){t.Logger.verbose(rt.InformationMessages.StartingLogOptOut);var i=t._ServerModel.createEventObject({messageType:n.MessageType.OptOut,eventType:n.EventType.Other});t._APIClient.sendEventToServer(i)};this.logAST=function(){i.logEvent({messageType:n.MessageType.AppStateTransition})};this.logCheckoutEvent=function(r,u,f,e){var o=t._Ecommerce.createCommerceEventObject(e);o&&(o.EventName+=t._Ecommerce.getProductActionEventName(n.ProductActionType.Checkout),o.EventCategory=n.CommerceEventType.ProductCheckout,o.ProductAction={ProductActionType:n.ProductActionType.Checkout,CheckoutStep:r,CheckoutOptions:u,ProductList:[]},i.logCommerceEvent(o,f))};this.logProductActionEvent=function(n,r,u,f,e){var o=t._Ecommerce.createCommerceEventObject(f);o&&(o.EventCategory=t._Ecommerce.convertProductActionToEventType(n),o.EventName+=t._Ecommerce.getProductActionEventName(n),o.ProductAction={ProductActionType:n,ProductList:Array.isArray(r)?r:[r]},t._Helpers.isObject(e)&&t._Ecommerce.convertTransactionAttributesToProductAction(e,o.ProductAction),i.logCommerceEvent(o,u))};this.logPurchaseEvent=function(r,u,f,e){var o=t._Ecommerce.createCommerceEventObject(e);o&&(o.EventName+=t._Ecommerce.getProductActionEventName(n.ProductActionType.Purchase),o.EventCategory=n.CommerceEventType.ProductPurchase,o.ProductAction={ProductActionType:n.ProductActionType.Purchase},o.ProductAction.ProductList=t._Ecommerce.buildProductList(o,u),t._Ecommerce.convertTransactionAttributesToProductAction(r,o.ProductAction),i.logCommerceEvent(o,f))};this.logRefundEvent=function(r,u,f,e){if(!r){t.Logger.error(rt.ErrorMessages.TransactionRequired);return}var o=t._Ecommerce.createCommerceEventObject(e);o&&(o.EventName+=t._Ecommerce.getProductActionEventName(n.ProductActionType.Refund),o.EventCategory=n.CommerceEventType.ProductRefund,o.ProductAction={ProductActionType:n.ProductActionType.Refund},o.ProductAction.ProductList=t._Ecommerce.buildProductList(o,u),t._Ecommerce.convertTransactionAttributesToProductAction(r,o.ProductAction),i.logCommerceEvent(o,f))};this.logPromotionEvent=function(n,r,u,f){var e=t._Ecommerce.createCommerceEventObject(f);e&&(e.EventName+=t._Ecommerce.getPromotionActionEventName(n),e.EventCategory=t._Ecommerce.convertPromotionActionToEventType(n),e.PromotionAction={PromotionActionType:n,PromotionList:[r]},i.logCommerceEvent(e,u))};this.logImpressionEvent=function(r,u,f){var e=t._Ecommerce.createCommerceEventObject(f);e&&(e.EventName+="Impression",e.EventCategory=n.CommerceEventType.ProductImpression,Array.isArray(r)||(r=[r]),e.ProductImpressions=[],r.forEach(function(n){e.ProductImpressions.push({ProductImpressionList:n.Name,ProductList:Array.isArray(n.Product)?n.Product:[n.Product]})}),i.logCommerceEvent(e,u))};this.logCommerceEvent=function(n,i){t.Logger.verbose(rt.InformationMessages.StartingLogCommerceEvent);i=t._Helpers.sanitizeAttributes(i);t._Helpers.canLog()?(t._Store.webviewBridgeEnabled&&(n.ShoppingCart={}),i&&(n.EventAttributes=i),t._APIClient.sendEventToServer(n),t._Persistence.update()):t.Logger.verbose(rt.InformationMessages.AbandonLogEvent)};this.addEventHandler=function(r,u,f,e,o){var h=[],l=function(r){var u=function(){s.href?window.location.href=s.href:s.submit&&s.submit()};t.Logger.verbose("DOM event triggered, handling event");i.logEvent({messageType:n.MessageType.PageEvent,name:typeof f=="function"?f(s):f,data:typeof e=="function"?e(s):e,eventType:o||n.EventType.Other});(s.href&&s.target!=="_blank"||s.submit)&&(r.preventDefault?r.preventDefault():r.returnValue=!1,setTimeout(u,t._Store.SDKConfig.timeout))},s,c;if(!u){t.Logger.error("Can't bind event, selector is required");return}if(typeof u=="string"?h=document.querySelectorAll(u):u.nodeType&&(h=[u]),h.length)for(t.Logger.verbose("Found "+h.length+" element"+(h.length>1?"s":"")+", attaching event handlers"),c=0;c<h.length;c++)s=h[c],s.addEventListener?s.addEventListener(r,l,!1):s.attachEvent?s.attachEvent("on"+r,l):s["on"+r]=l;else t.Logger.verbose("No elements found")}}function be(n){function e(){var c=window.document.cookie.split("; "),l,f,a,s,e,h;for(n.Logger.verbose(t.Messages.InformationMessages.CookieSearch),f=0,a=c.length;f<a;f++){if(s=c[f].split("="),e=n._Helpers.decoded(s.shift()),h=n._Helpers.decoded(s.join("=")),e===n._Store.storageName)return;if(e===o.cookieNameV4){r(h,o.cookieNameV4);n._Store.isLocalStorageAvailable&&u();return}if(e===o.cookieNameV3){l=i.convertSDKv1CookiesV3ToSDKv2CookiesV4(h);r(l,o.cookieNameV3);break}}}function r(i,r){var s=new Date,u=n._Persistence.getCookieDomain(),f,e;f=new Date(s.getTime()+o.CookieExpiration*864e5).toGMTString();e=u===""?"":";domain="+u;n.Logger.verbose(t.Messages.InformationMessages.CookieSet);window.document.cookie=encodeURIComponent(n._Store.storageName)+"="+i+";expires="+f+";path=/"+e;n._Persistence.expireCookies(r);n._Store.migratingToIDSyncCookies=!0}function s(t){var r,i;try{r={gs:{csm:[]}};t=JSON.parse(t);for(i in t)t.hasOwnProperty(i)&&(pe[i]?r.gs[i]=t[i]:i==="mpid"?r.cu=t[i]:t.mpid&&(r[t.mpid]=r[t.mpid]||{},we[i]&&(r[t.mpid][i]=t[i])));return JSON.stringify(r)}catch(u){n.Logger.error("Failed to restructure previous cookie into most current cookie schema")}}function u(){var t=o.localStorageProductsV4,i=localStorage.getItem(o.localStorageProductsV4);localStorage.setItem(n._Store.prodStorageName,i);localStorage.removeItem(t)}function f(t,i){if(n._Store.isLocalStorageAvailable){var r={};if(r[i]={},t.cp){try{r[i].cp=JSON.parse(ei.decode(t.cp))}catch(u){r[i].cp=t.cp}Array.isArray(r[i].cp)||(r[i].cp=[])}localStorage.setItem(n._Store.prodStorageName,ei.encode(JSON.stringify(r)))}}function h(){function l(t,i){try{window.localStorage.setItem(encodeURIComponent(n._Store.storageName),t)}catch(r){n.Logger.error("Error with setting localStorage item.")}window.localStorage.removeItem(encodeURIComponent(i))}var r,s=o.localStorageNameV3,h=o.localStorageNameV4,a=window.localStorage.getItem(n._Store.storageName),e,t,c;if(!a){if(e=window.localStorage.getItem(h),e){l(e,h);u();return}if(t=window.localStorage.getItem(s),t){if(n._Store.migratingToIDSyncCookies=!0,c=t.slice(),t=JSON.parse(n._Persistence.replacePipesWithCommas(n._Persistence.replaceApostrophesWithQuotes(t))),t.mpid){t=JSON.parse(i.convertSDKv1CookiesV3ToSDKv2CookiesV4(c));l(JSON.stringify(t),s);return}if((t.cp||t.pb)&&!t.mpid){if(r=n._Persistence.getCookie(),r){f(t,r.cu);localStorage.removeItem(o.localStorageNameV3);return}localStorage.removeItem(o.localStorageNameV3);return}}}}var i=this;this.migrate=function(){try{e()}catch(t){n._Persistence.expireCookies(o.cookieNameV3);n._Persistence.expireCookies(o.cookieNameV4);n.Logger.error("Error migrating cookie: "+t)}if(n._Store.isLocalStorageAvailable)try{h()}catch(t){localStorage.removeItem(o.localStorageNameV3);localStorage.removeItem(o.localStorageNameV4);n.Logger.error("Error migrating localStorage: "+t)}};this.convertSDKv1CookiesV3ToSDKv2CookiesV4=function(t){t=n._Persistence.replacePipesWithCommas(n._Persistence.replaceApostrophesWithQuotes(t));var i=JSON.parse(t),r=JSON.parse(s(t));return i.mpid&&(r.gs.csm.push(i.mpid),r.gs.csm=ei.encode(JSON.stringify(r.gs.csm)),f(i,i.mpid)),JSON.stringify(r)}}function hr(t,i,r){var u=this;return{getUserIdentities:function(){var u={},f=r._Persistence.getUserIdentities(t);for(var e in f)f.hasOwnProperty(e)&&(u[n.IdentityType.getIdentityName(r._Helpers.parseNumber(e))]=f[e]);return u=r._Helpers.filterUserIdentitiesForForwarders(u,i.userIdentityFilters),{userIdentities:u}},getMPID:function(){return t},getUserAttributesLists:function(n){var t,f={},i;t=u.getAllUserAttributes();for(i in t)t.hasOwnProperty(i)&&Array.isArray(t[i])&&(f[i]=t[i].slice());return r._Helpers.filterUserAttributes(f,n.userAttributeFilters)},getAllUserAttributes:function(){var f={},n=r._Persistence.getAllUserAttributes(t),u;if(n)for(u in n)n.hasOwnProperty(u)&&(f[u]=Array.isArray(n[u])?n[u].slice():n[u]);return r._Helpers.filterUserAttributes(f,i.userAttributeFilters)}}}function ke(t){var i=this;this.initForwarders=function(n,r){var u=t.Identity.getCurrentUser();!t._Store.webviewBridgeEnabled&&t._Store.configuredForwarders&&(t._Store.configuredForwarders.sort(function(n,t){return n.settings.PriorityValue=n.settings.PriorityValue||0,t.settings.PriorityValue=t.settings.PriorityValue||0,-1*(n.settings.PriorityValue-t.settings.PriorityValue)}),t._Store.activeForwarders=t._Store.configuredForwarders.filter(function(f){if(!i.isEnabledForUserConsent(f.filteringConsentRuleValues,u)||!i.isEnabledForUserAttributes(f.filteringUserAttributeValue,u)||!i.isEnabledForUnknownUser(f.excludeAnonymousUser,u))return!1;var e=t._Helpers.filterUserIdentities(n,f.userIdentityFilters),o=t._Helpers.filterUserAttributes(u?u.getAllUserAttributes():{},f.userAttributeFilters);return f.initialized||(f.init(f.settings,r,!1,null,o,e,t._Store.SDKConfig.appVersion,t._Store.SDKConfig.appName,t._Store.SDKConfig.customFlags,t._Store.clientId),f.initialized=!0),!0}))};this.isEnabledForUserConsent=function(n,i){var r,u,e,h,o,s;if(!n||!n.values||!n.values.length)return!0;if(!i)return!1;if(r={},u=i.getConsentState(),u){var f=u.getGDPRConsentState();if(f)for(e in f)f.hasOwnProperty(e)&&(o=t._Helpers.generateHash("1"+e).toString(),r[o]=f[e].Consented);h=u.getCCPAConsentState();h&&(o=t._Helpers.generateHash("2data_sale_opt_out").toString(),r[o]=h.Consented)}return s=!1,n.values.forEach(function(n){if(!s){var t=n.consentPurpose,i=n.hasConsented;r.hasOwnProperty(t)&&r[t]===i&&(s=!0)}}),n.includeOnMatch===s};this.isEnabledForUserAttributes=function(n,i){var e,o,r,f,u;if(!n||!t._Helpers.isObject(n)||!Object.keys(n).length)return!0;if(i)r=i.getAllUserAttributes();else return!1;f=!1;try{if(r&&t._Helpers.isObject(r)&&Object.keys(r).length)for(u in r)if(r.hasOwnProperty(u)&&(e=t._Helpers.generateHash(u).toString(),o=t._Helpers.generateHash(r[u]).toString(),e===n.userAttributeName&&o===n.userAttributeValue)){f=!0;break}return n?n.includeOnMatch===f:!0}catch(s){return!0}};this.isEnabledForUnknownUser=function(n,t){return(!t||!t.isLoggedIn())&&n?!1:!0};this.applyToForwarders=function(n,i){t._Store.activeForwarders.length&&t._Store.activeForwarders.forEach(function(r){var f=r[n],u;if(f)try{u=r[n](i);u&&t.Logger.verbose(u)}catch(e){t.Logger.verbose(e)}})};this.sendEventToForwarders=function(i){var u,o,s,p=function(n,i){n.UserIdentities&&n.UserIdentities.length&&n.UserIdentities.forEach(function(r,u){t._Helpers.inArray(i,r.Type)&&(n.UserIdentities.splice(u,1),u>0&&u--)})},v=function(n,i){var u,r;if(i)for(r in n.EventAttributes)n.EventAttributes.hasOwnProperty(r)&&(u=t._Helpers.generateHash(n.EventCategory+n.EventName+r),t._Helpers.inArray(i,u)&&delete n.EventAttributes[r])},e=function(n,i){return n&&n.length&&t._Helpers.inArray(n,i)?!0:!1},w=[n.MessageType.PageEvent,n.MessageType.PageView,n.MessageType.Commerce],r,f,h,c,l,y,a;if(!t._Store.webviewBridgeEnabled&&t._Store.activeForwarders)for(o=t._Helpers.generateHash(i.EventCategory+i.EventName),s=t._Helpers.generateHash(i.EventCategory),r=0;r<t._Store.activeForwarders.length;r++){if(w.indexOf(i.EventDataType)>-1&&t._Store.activeForwarders[r].filteringEventAttributeValue&&t._Store.activeForwarders[r].filteringEventAttributeValue.eventAttributeName&&t._Store.activeForwarders[r].filteringEventAttributeValue.eventAttributeValue){if(f=null,i.EventAttributes)for(h in i.EventAttributes)if(c=t._Helpers.generateHash(h).toString(),c===t._Store.activeForwarders[r].filteringEventAttributeValue.eventAttributeName&&(f={name:c,value:t._Helpers.generateHash(i.EventAttributes[h]).toString()}),f)break;if(l=f!==null&&f.value===t._Store.activeForwarders[r].filteringEventAttributeValue.eventAttributeValue,y=t._Store.activeForwarders[r].filteringEventAttributeValue.includeOnMatch===!0?l:!l,!y)continue}if(u={},u=t._Helpers.extend(!0,u,i),i.EventDataType===n.MessageType.PageEvent&&(e(t._Store.activeForwarders[r].eventNameFilters,o)||e(t._Store.activeForwarders[r].eventTypeFilters,s)))continue;else if(i.EventDataType===n.MessageType.Commerce&&e(t._Store.activeForwarders[r].eventTypeFilters,s))continue;else if(i.EventDataType===n.MessageType.PageView&&e(t._Store.activeForwarders[r].screenNameFilters,o))continue;u.EventAttributes&&(i.EventDataType===n.MessageType.PageEvent?v(u,t._Store.activeForwarders[r].attributeFilters):i.EventDataType===n.MessageType.PageView&&v(u,t._Store.activeForwarders[r].pageViewAttributeFilters));p(u,t._Store.activeForwarders[r].userIdentityFilters);u.UserAttributes=t._Helpers.filterUserAttributes(u.UserAttributes,t._Store.activeForwarders[r].userAttributeFilters);t.Logger.verbose("Sending message to forwarder: "+t._Store.activeForwarders[r].name);t._Store.activeForwarders[r].process&&(a=t._Store.activeForwarders[r].process(u),a&&t.Logger.verbose(a))}};this.callSetUserAttributeOnForwarders=function(n,i){t._Store.activeForwarders.length&&t._Store.activeForwarders.forEach(function(r){if(r.setUserAttribute&&r.userAttributeFilters&&!t._Helpers.inArray(r.userAttributeFilters,t._Helpers.generateHash(n)))try{var u=r.setUserAttribute(n,i);u&&t.Logger.verbose(u)}catch(f){t.Logger.error(f)}})};this.setForwarderUserIdentities=function(n){t._Store.activeForwarders.forEach(function(i){var r=t._Helpers.filterUserIdentities(n,i.userIdentityFilters);i.setUserIdentity&&r.forEach(function(n){var r=i.setUserIdentity(n.Identity,n.Type);r&&t.Logger.verbose(r)})})};this.setForwarderOnUserIdentified=function(n){t._Store.activeForwarders.forEach(function(i){var u=hr(n.getMPID(),i,t),r;i.onUserIdentified&&(r=i.onUserIdentified(u),r&&t.Logger.verbose(r))})};this.setForwarderOnIdentityComplete=function(n,i){var r;t._Store.activeForwarders.forEach(function(u){var f=hr(n.getMPID(),u,t);i==="identify"?u.onIdentifyComplete&&(r=u.onIdentifyComplete(f),r&&t.Logger.verbose(r)):i==="login"?u.onLoginComplete&&(r=u.onLoginComplete(f),r&&t.Logger.verbose(r)):i==="logout"?u.onLogoutComplete&&(r=u.onLogoutComplete(f),r&&t.Logger.verbose(r)):i==="modify"&&u.onModifyComplete&&(r=u.onModifyComplete(f),r&&t.Logger.verbose(r))})};this.getForwarderStatsQueue=function(){return t._Persistence.forwardingStatsBatches.forwardingStatsEventQueue};this.setForwarderStatsQueue=function(n){t._Persistence.forwardingStatsBatches.forwardingStatsEventQueue=n};this.configureForwarder=function(n){var r=null,i=n,u={},f;t._Helpers.isObject(t._Store.SDKConfig.kits)&&Object.keys(t._Store.SDKConfig.kits).length>0?u=t._Store.SDKConfig.kits:t._preInit.forwarderConstructors.length>0&&t._preInit.forwarderConstructors.forEach(function(n){u[n.name]=n});for(f in u)if(f===i.name&&(i.isDebug===t._Store.SDKConfig.isDevelopmentMode||i.isSandbox===t._Store.SDKConfig.isDevelopmentMode)){r=new u[f].constructor;r.id=i.moduleId;r.isSandbox=i.isDebug||i.isSandbox;r.hasSandbox=i.hasDebugString==="true";r.isVisible=i.isVisible;r.settings=i.settings;r.eventNameFilters=i.eventNameFilters;r.eventTypeFilters=i.eventTypeFilters;r.attributeFilters=i.attributeFilters;r.screenNameFilters=i.screenNameFilters;r.screenNameFilters=i.screenNameFilters;r.pageViewAttributeFilters=i.pageViewAttributeFilters;r.userIdentityFilters=i.userIdentityFilters;r.userAttributeFilters=i.userAttributeFilters;r.filteringEventAttributeValue=i.filteringEventAttributeValue;r.filteringUserAttributeValue=i.filteringUserAttributeValue;r.eventSubscriptionId=i.eventSubscriptionId;r.filteringConsentRuleValues=i.filteringConsentRuleValues;r.excludeAnonymousUser=i.excludeAnonymousUser;t._Store.configuredForwarders.push(r);break}};this.configurePixel=function(n){(n.isDebug===t._Store.SDKConfig.isDevelopmentMode||n.isProduction!==t._Store.SDKConfig.isDevelopmentMode)&&t._Store.pixelConfigurations.push(n)};this.processForwarders=function(n,r){if(n)try{Array.isArray(n.kitConfigs)&&n.kitConfigs.length&&n.kitConfigs.forEach(function(n){i.configureForwarder(n)});Array.isArray(n.pixelConfigs)&&n.pixelConfigs.length&&n.pixelConfigs.forEach(function(n){i.configurePixel(n)});i.initForwarders(t._Store.SDKConfig.identifyRequest.userIdentities,r)}catch(u){t.Logger.error("Config was not parsed propertly. Forwarders may not be initialized.")}else t.Logger.warning("No config was passed. Cannot process forwarders")}}function lr(i){function f(n,t){var r=[],i;t.flags={};for(i in n.CustomFlags)r=[],n.CustomFlags.hasOwnProperty(i)&&(Array.isArray(n.CustomFlags[i])?n.CustomFlags[i].forEach(function(n){(typeof n=="number"||typeof n=="string"||typeof n=="boolean")&&r.push(n.toString())}):(typeof n.CustomFlags[i]=="number"||typeof n.CustomFlags[i]=="string"||typeof n.CustomFlags[i]=="boolean")&&r.push(n.CustomFlags[i].toString()),r.length&&(t.flags[i]=r))}function r(n){return n?n.map(function(n){return e(n)}):[]}function e(n){return{id:i._Helpers.parseStringOrNumber(n.Sku),nm:i._Helpers.parseStringOrNumber(n.Name),pr:i._Helpers.parseNumber(n.Price),qt:i._Helpers.parseNumber(n.Quantity),br:i._Helpers.parseStringOrNumber(n.Brand),va:i._Helpers.parseStringOrNumber(n.Variant),ca:i._Helpers.parseStringOrNumber(n.Category),ps:i._Helpers.parseNumber(n.Position),cc:i._Helpers.parseStringOrNumber(n.CouponCode),tpa:i._Helpers.parseNumber(n.TotalAmount),attrs:n.Attributes}}var u=this;this.appendUserInfo=function(t,r){var e,u,o,s,h,c,f;if(r){if(!t){r.MPID=null;r.ConsentState=null;r.UserAttributes=null;r.UserIdentities=null;return}if(!r.MPID||r.MPID!==t.getMPID()){r.MPID=t.getMPID();r.ConsentState=t.getConsentState();r.UserAttributes=t.getAllUserAttributes();e=t.getUserIdentities().userIdentities;u={};for(o in e)s=n.IdentityType.getIdentityType(o),s!==!1&&(u[s]=e[o]);if(h=[],i._Helpers.isObject(u)&&Object.keys(u).length)for(c in u)f={},f.Identity=u[c],f.Type=i._Helpers.parseNumber(c),h.push(f);r.UserIdentities=h}}};this.convertToConsentStateDTO=function(n){var f,e,r,i,t,u;if(!n)return null;if(f={},e=n.getGDPRConsentState(),e){r={};f.gdpr=r;for(i in e)e.hasOwnProperty(i)&&(t=e[i],f.gdpr[i]={},typeof t.Consented=="boolean"&&(r[i].c=t.Consented),typeof t.Timestamp=="number"&&(r[i].ts=t.Timestamp),typeof t.ConsentDocument=="string"&&(r[i].d=t.ConsentDocument),typeof t.Location=="string"&&(r[i].l=t.Location),typeof t.HardwareId=="string"&&(r[i].h=t.HardwareId))}return u=n.getCCPAConsentState(),u&&(f.ccpa={data_sale_opt_out:{c:u.Consented,ts:u.Timestamp,d:u.ConsentDocument,l:u.Location,h:u.HardwareId}}),f};this.createEventObject=function(r,f){var o={},e={},h=r.messageType===n.MessageType.OptOut?!i._Store.isEnabled:null,s;return i._Store.sessionId||r.messageType==n.MessageType.OptOut||i._Store.webviewBridgeEnabled?(e=r.hasOwnProperty("toEventAPIObject")?r.toEventAPIObject():{EventName:r.name||r.messageType,EventCategory:r.eventType,EventAttributes:i._Helpers.sanitizeAttributes(r.data),EventDataType:r.messageType,CustomFlags:r.customFlags||{},UserAttributeChanges:r.userAttributeChanges,UserIdentityChanges:r.userIdentityChanges},r.messageType!==n.MessageType.SessionEnd&&(i._Store.dateLastEventSent=new Date),o={Store:i._Store.serverSettings,SDKVersion:t.sdkVersion,SessionId:i._Store.sessionId,SessionStartDate:i._Store.sessionStartDate?i._Store.sessionStartDate.getTime():null,Debug:i._Store.SDKConfig.isDevelopmentMode,Location:i._Store.currentPosition,OptOut:h,ExpandedEventCount:0,AppVersion:i.getAppVersion(),AppName:i.getAppName(),ClientGeneratedId:i._Store.clientId,DeviceId:i._Store.deviceId,IntegrationAttributes:i._Store.integrationAttributes,CurrencyCode:i._Store.currencyCode,DataPlan:i._Store.SDKConfig.dataPlan?i._Store.SDKConfig.dataPlan:{}},e.CurrencyCode=i._Store.currencyCode,s=f||i.Identity.getCurrentUser(),u.appendUserInfo(s,e),r.messageType===n.MessageType.SessionEnd&&(e.SessionLength=i._Store.dateLastEventSent.getTime()-i._Store.sessionStartDate.getTime(),e.currentSessionMPIDs=i._Store.currentSessionMPIDs,e.EventAttributes=i._Store.sessionAttributes,i._Store.currentSessionMPIDs=[],i._Store.sessionStartDate=null),o.Timestamp=i._Store.dateLastEventSent.getTime(),i._Helpers.extend({},e,o)):null};this.convertEventToDTO=function(n,t){var e={n:n.EventName,et:n.EventCategory,ua:n.UserAttributes,ui:n.UserIdentities,ia:n.IntegrationAttributes,str:n.Store,attrs:n.EventAttributes,sdk:n.SDKVersion,sid:n.SessionId,sl:n.SessionLength,ssd:n.SessionStartDate,dt:n.EventDataType,dbg:n.Debug,ct:n.Timestamp,lc:n.Location,o:n.OptOut,eec:n.ExpandedEventCount,av:n.AppVersion,cgid:n.ClientGeneratedId,das:n.DeviceId,mpid:n.MPID,smpids:n.currentSessionMPIDs},o;return n.DataPlan&&n.DataPlan.PlanId&&(e.dp_id=n.DataPlan.PlanId,n.DataPlan.PlanVersion&&(e.dp_v=n.DataPlan.PlanVersion)),o=u.convertToConsentStateDTO(n.ConsentState),o&&(e.con=o),n.EventDataType===gt.AppStateTransition&&(e.fr=t,e.iu=!1,e.at=cr.AppInit,e.lr=window.location.href||null,e.attrs=null),n.CustomFlags&&f(n,e),n.EventDataType===gt.Commerce?(e.cu=n.CurrencyCode,n.ShoppingCart&&(e.sc={pl:r(n.ShoppingCart.ProductList)}),n.ProductAction?e.pd={an:n.ProductAction.ProductActionType,cs:i._Helpers.parseNumber(n.ProductAction.CheckoutStep),co:n.ProductAction.CheckoutOptions,pl:r(n.ProductAction.ProductList),ti:n.ProductAction.TransactionId,ta:n.ProductAction.Affiliation,tcc:n.ProductAction.CouponCode,tr:i._Helpers.parseNumber(n.ProductAction.TotalAmount),ts:i._Helpers.parseNumber(n.ProductAction.ShippingAmount),tt:i._Helpers.parseNumber(n.ProductAction.TaxAmount)}:n.PromotionAction?e.pm={an:n.PromotionAction.PromotionActionType,pl:n.PromotionAction.PromotionList.map(function(n){return{id:n.Id,nm:n.Name,cr:n.Creative,ps:n.Position?n.Position:0}})}:n.ProductImpressions&&(e.pi=n.ProductImpressions.map(function(n){return{pil:n.ProductImpressionList,pl:r(n.ProductList)}}))):n.EventDataType===gt.Profile&&(e.pet=n.ProfileMessageType),e}}function de(n){function t(){var i=n._Forwarders.getForwarderStatsQueue(),t=n._Persistence.forwardingStatsBatches.uploadsTable,u=Date.now(),r;i.length&&(t[u]={uploading:!1,data:i},n._Forwarders.setForwarderStatsQueue([]));for(r in t)(function(i){if(t.hasOwnProperty(i)&&t[i].uploading===!1){var u=function(){r.readyState===4&&(r.status===200||r.status===202?(n.Logger.verbose("Successfully sent  "+r.statusText+" from server"),delete t[i]):r.status.toString()[0]==="4"?r.status!==429&&delete t[i]:t[i].uploading=!1)},r=n._Helpers.createXHR(u),f=t[i].data;t[i].uploading=!0;n._APIClient.sendBatchForwardingStatsToServer(f,r)}})(r)}this.startForwardingStatsTimer=function(){mParticle._forwardingStatsTimer=setInterval(function(){t()},n._Store.SDKConfig.forwarderStatsTimeout)}}function ge(i){var r=this;this.checkIdentitySwap=function(n,t,r){if(n&&t&&n!==t){var u=i._Persistence.getPersistence();u&&(u.cu=t,u.gs.csm=r,i._Persistence.savePersistence(u))}};this.IdentityRequest={createKnownIdentities:function(n,t){var r={},u;if(n&&n.userIdentities&&i._Helpers.isObject(n.userIdentities))for(u in n.userIdentities)r[u]=n.userIdentities[u];return r.device_application_stamp=t,r},preProcessIdentityRequest:function(n,t,r){var u,e;return(i.Logger.verbose(f.InformationMessages.StartingLogEvent+": "+r),u=i._Helpers.Validators.validateIdentities(n,r),!u.valid)?(i.Logger.error("ERROR: "+u.error),{valid:!1,error:u.error}):t&&!i._Helpers.Validators.isFunction(t)?(e="The optional callback must be a function. You tried entering a(n) "+h(t),i.Logger.error(e),{valid:!1,error:e}):{valid:!0}},createIdentityRequest:function(n,t,r,u,f,e,o){return{client_sdk:{platform:t,sdk_vendor:r,sdk_version:u},context:e,environment:i._Store.SDKConfig.isDevelopmentMode?"development":"production",request_id:i._Helpers.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),previous_mpid:o||null,known_identities:this.createKnownIdentities(n,f)}},createModifyIdentityRequest:function(n,t,r,u,f,e){return{client_sdk:{platform:r,sdk_vendor:u,sdk_version:f},context:e,environment:i._Store.SDKConfig.isDevelopmentMode?"development":"production",request_id:i._Helpers.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),identity_changes:this.createIdentityChanges(n,t)}},createIdentityChanges:function(n,t){var u=[],r;if(t&&i._Helpers.isObject(t)&&n&&i._Helpers.isObject(n))for(r in t)u.push({old_value:n[r]||null,new_value:t[r],identity_type:r});return u},combineUserIdentities:function(t,r){var e={},o=i._Helpers.extend(t,r),u,f;for(u in o)f=n.IdentityType.getIdentityType(u),f!==!1&&f>=0&&(e[n.IdentityType.getIdentityType(u)]=o[u]);return e},createAliasNetworkRequest:function(n){return{request_id:i._Helpers.generateUniqueId(),request_type:"alias",environment:i._Store.SDKConfig.isDevelopmentMode?"development":"production",api_key:i._Store.devToken,data:{destination_mpid:n.destinationMpid,source_mpid:n.sourceMpid,start_unixtime_ms:n.startTime,end_unixtime_ms:n.endTime,device_application_stamp:i._Store.deviceId}}},convertAliasToNative:function(n){return{DestinationMpid:n.destinationMpid,SourceMpid:n.sourceMpid,StartUnixtimeMs:n.startTime,EndUnixtimeMs:n.endTime}},convertToNative:function(t){var r=[],i;if(t&&t.userIdentities){for(i in t.userIdentities)t.userIdentities.hasOwnProperty(i)&&r.push({Type:n.IdentityType.getIdentityType(i),Identity:t.userIdentities[i]});return{UserIdentities:r}}}};this.IdentityAPI={HTTPCodes:e,identify:function(n,u){var o,h=i.Identity.getCurrentUser(),s=i._Identity.IdentityRequest.preProcessIdentityRequest(n,u,"identify"),c;h&&(o=h.getMPID());s.valid?(c=i._Identity.IdentityRequest.createIdentityRequest(n,t.platform,t.sdkVendor,t.sdkVersion,i._Store.deviceId,i._Store.context,o),i._Helpers.canLog()?i._Store.webviewBridgeEnabled?(i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.Identify,JSON.stringify(i._Identity.IdentityRequest.convertToNative(n))),i._Helpers.invokeCallback(u,e.nativeIdentityRequest,"Identify request sent to native sdk")):i._APIClient.sendIdentityRequest(c,"identify",u,n,r.parseIdentityResponse,o):(i._Helpers.invokeCallback(u,e.loggingDisabledOrMissingAPIKey,f.InformationMessages.AbandonLogEvent),i.Logger.verbose(f.InformationMessages.AbandonLogEvent))):(i._Helpers.invokeCallback(u,e.validationIssue,s.error),i.Logger.verbose(s))},logout:function(u,o){var s,l=i.Identity.getCurrentUser(),h=i._Identity.IdentityRequest.preProcessIdentityRequest(u,o,"logout"),c,a;l&&(s=l.getMPID());h.valid?(a=i._Identity.IdentityRequest.createIdentityRequest(u,t.platform,t.sdkVendor,t.sdkVersion,i._Store.deviceId,i._Store.context,s),i._Helpers.canLog()?i._Store.webviewBridgeEnabled?(i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.Logout,JSON.stringify(i._Identity.IdentityRequest.convertToNative(u))),i._Helpers.invokeCallback(o,e.nativeIdentityRequest,"Logout request sent to native sdk")):(i._APIClient.sendIdentityRequest(a,"logout",o,u,r.parseIdentityResponse,s),c=i._ServerModel.createEventObject({messageType:n.MessageType.Profile}),c.ProfileMessageType=n.ProfileMessageType.Logout,i._Store.activeForwarders.length&&i._Store.activeForwarders.forEach(function(n){n.logOut&&n.logOut(c)})):(i._Helpers.invokeCallback(o,e.loggingDisabledOrMissingAPIKey,f.InformationMessages.AbandonLogEvent),i.Logger.verbose(f.InformationMessages.AbandonLogEvent))):(i._Helpers.invokeCallback(o,e.validationIssue,h.error),i.Logger.verbose(h))},login:function(n,u){var o,h=i.Identity.getCurrentUser(),s=i._Identity.IdentityRequest.preProcessIdentityRequest(n,u,"login"),c;h&&(o=h.getMPID());s.valid?(c=i._Identity.IdentityRequest.createIdentityRequest(n,t.platform,t.sdkVendor,t.sdkVersion,i._Store.deviceId,i._Store.context,o),i._Helpers.canLog()?i._Store.webviewBridgeEnabled?(i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.Login,JSON.stringify(i._Identity.IdentityRequest.convertToNative(n))),i._Helpers.invokeCallback(u,e.nativeIdentityRequest,"Login request sent to native sdk")):i._APIClient.sendIdentityRequest(c,"login",u,n,r.parseIdentityResponse,o):(i._Helpers.invokeCallback(u,e.loggingDisabledOrMissingAPIKey,f.InformationMessages.AbandonLogEvent),i.Logger.verbose(f.InformationMessages.AbandonLogEvent))):(i._Helpers.invokeCallback(u,e.validationIssue,s.error),i.Logger.verbose(s))},modify:function(n,u){var h,o=i.Identity.getCurrentUser(),s=i._Identity.IdentityRequest.preProcessIdentityRequest(n,u,"modify"),c,l;o&&(h=o.getMPID());c=n&&n.userIdentities?n.userIdentities:{};s.valid?(l=i._Identity.IdentityRequest.createModifyIdentityRequest(o?o.getUserIdentities().userIdentities:{},c,t.platform,t.sdkVendor,t.sdkVersion,i._Store.context),i._Helpers.canLog()?i._Store.webviewBridgeEnabled?(i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.Modify,JSON.stringify(i._Identity.IdentityRequest.convertToNative(n))),i._Helpers.invokeCallback(u,e.nativeIdentityRequest,"Modify request sent to native sdk")):i._APIClient.sendIdentityRequest(l,"modify",u,n,r.parseIdentityResponse,h):(i._Helpers.invokeCallback(u,e.loggingDisabledOrMissingAPIKey,f.InformationMessages.AbandonLogEvent),i.Logger.verbose(f.InformationMessages.AbandonLogEvent))):(i._Helpers.invokeCallback(u,e.validationIssue,s.error),i.Logger.verbose(s))},getCurrentUser:function(){var n;return i._Store?(n=i._Store.mpid,n?(n=i._Store.mpid.slice(),r.mParticleUser(n,i._Store.isLoggedIn)):i._Store.webviewBridgeEnabled?r.mParticleUser():null):null},getUser:function(n){var u=i._Persistence.getPersistence();return u?u[n]&&!t.SDKv2NonMPIDCookieKeys.hasOwnProperty(n)?r.mParticleUser(n):null:null},getUsers:function(){var f=i._Persistence.getPersistence(),n=[],u;if(f)for(u in f)t.SDKv2NonMPIDCookieKeys.hasOwnProperty(u)||n.push(r.mParticleUser(u));return n.sort(function(n,t){var i=n.getLastSeenTime()||0,r=t.getLastSeenTime()||0;return i>r?-1:1}),n},aliasUsers:function(n,r){var u,o;if(n.destinationMpid&&n.sourceMpid||(u=f.ValidationMessages.AliasMissingMpid),n.destinationMpid===n.sourceMpid&&(u=f.ValidationMessages.AliasNonUniqueMpid),n.startTime&&n.endTime||(u=f.ValidationMessages.AliasMissingTime),n.startTime>n.endTime&&(u=f.ValidationMessages.AliasStartBeforeEndTime),u){i.Logger.warning(u);i._Helpers.invokeAliasCallback(r,e.validationIssue,u);return}i._Helpers.canLog()?i._Store.webviewBridgeEnabled?(i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.Alias,JSON.stringify(i._Identity.IdentityRequest.convertAliasToNative(n))),i._Helpers.invokeAliasCallback(r,e.nativeIdentityRequest,"Alias request sent to native sdk")):(i.Logger.verbose(f.InformationMessages.StartingAliasRequest+": "+n.sourceMpid+" -> "+n.destinationMpid),o=i._Identity.IdentityRequest.createAliasNetworkRequest(n),i._APIClient.sendAliasRequest(o,r)):(i._Helpers.invokeAliasCallback(r,e.loggingDisabledOrMissingAPIKey,f.InformationMessages.AbandonAliasUsers),i.Logger.verbose(f.InformationMessages.AbandonAliasUsers))},createAliasRequest:function(n,t){var r,u,f;try{return!t||!n?(i.Logger.error("'destinationUser' and 'sourceUser' must both be present"),null):(r=n.getFirstSeenTime(),r||i.Identity.getUsers().forEach(function(n){n.getFirstSeenTime()&&(!r||n.getFirstSeenTime()<r)&&(r=n.getFirstSeenTime())}),u=(new Date).getTime()-i._Store.SDKConfig.aliasMaxWindow*864e5,f=n.getLastSeenTime()||(new Date).getTime(),r<u&&(r=u,f<r&&i.Logger.warning("Source User has not been seen in the last "+i._Store.SDKConfig.maxAliasWindow+" days, Alias Request will likely fail")),{destinationMpid:t.getMPID(),sourceMpid:n.getMPID(),startTime:r,endTime:f})}catch(e){return i.Logger.error("There was a problem with creating an alias request: "+e),null}}};this.mParticleUser=function(r,u){var e=this;return{getUserIdentities:function(){var f={},t=i._Persistence.getUserIdentities(r);for(var u in t)t.hasOwnProperty(u)&&(f[n.IdentityType.getIdentityName(i._Helpers.parseNumber(u))]=t[u]);return{userIdentities:f}},getMPID:function(){return r},setUserTag:function(n){if(!i._Helpers.Validators.isValidKeyValue(n)){i.Logger.error(f.ErrorMessages.BadKey);return}this.setUserAttribute(n,null)},removeUserTag:function(n){if(!i._Helpers.Validators.isValidKeyValue(n)){i.Logger.error(f.ErrorMessages.BadKey);return}this.removeUserAttribute(n)},setUserAttribute:function(n,u){var s,o,l,c,h;if(i._SessionManager.resetSessionTimer(),i._Helpers.canLog()){if(!i._Helpers.Validators.isValidAttributeValue(u)){i.Logger.error(f.ErrorMessages.BadAttribute);return}if(!i._Helpers.Validators.isValidKeyValue(n)){i.Logger.error(f.ErrorMessages.BadKey);return}i._Store.webviewBridgeEnabled?i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.SetUserAttribute,JSON.stringify({key:n,value:u})):(s=i._Persistence.getPersistence(),o=this.getAllUserAttributes(),h=i._Helpers.findKeyInObject(o,n),h?(c=!1,l=o[h],delete o[h]):c=!0,o[n]=u,s&&s[r]&&(s[r].ua=o,i._Persistence.savePersistence(s,r)),e.sendUserAttributeChangeEvent(n,u,l,c,!1,this),i._Forwarders.initForwarders(e.IdentityAPI.getCurrentUser().getUserIdentities(),i._APIClient.prepareForwardingStats),i._Forwarders.callSetUserAttributeOnForwarders(n,u))}},setUserAttributes:function(n){if(i._SessionManager.resetSessionTimer(),i._Helpers.isObject(n)){if(i._Helpers.canLog())for(var t in n)n.hasOwnProperty(t)&&this.setUserAttribute(t,n[t])}else i.Logger.error("Must pass an object into setUserAttributes. You passed a "+h(n))},removeUserAttribute:function(n){var o,u,s,h;if(i._SessionManager.resetSessionTimer(),!i._Helpers.Validators.isValidKeyValue(n)){i.Logger.error(f.ErrorMessages.BadKey);return}i._Store.webviewBridgeEnabled?i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.RemoveUserAttribute,JSON.stringify({key:n,value:null})):(o=i._Persistence.getPersistence(),u=this.getAllUserAttributes(),s=i._Helpers.findKeyInObject(u,n),s&&(n=s),h=u[n]?u[n].toString():null,delete u[n],o&&o[r]&&(o[r].ua=u,i._Persistence.savePersistence(o,r)),e.sendUserAttributeChangeEvent(n,null,h,!1,!0,this),i._Forwarders.initForwarders(e.IdentityAPI.getCurrentUser().getUserIdentities(),i._APIClient.prepareForwardingStats),i._Forwarders.applyToForwarders("removeUserAttribute",n))},setUserAttributeList:function(n,u){var c,o,s,p,a,v,y,l;if(i._SessionManager.resetSessionTimer(),!i._Helpers.Validators.isValidKeyValue(n)){i.Logger.error(f.ErrorMessages.BadKey);return}if(!Array.isArray(u)){i.Logger.error("The value you passed in to setUserAttributeList must be an array. You passed in a "+(typeof value=="undefined"?"undefined":h(value)));return}if(v=u.slice(),i._Store.webviewBridgeEnabled)i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.SetUserAttributeList,JSON.stringify({key:n,value:v}));else{if(c=i._Persistence.getPersistence(),o=this.getAllUserAttributes(),y=i._Helpers.findKeyInObject(o,n),y?(p=!1,s=o[y],delete o[y]):p=!0,o[n]=v,c&&c[r]&&(c[r].ua=o,i._Persistence.savePersistence(c,r)),i._APIClient.shouldEnableBatching()){if(s&&Array.isArray(s)){if(u.length!==s.length)a=!0;else for(l=0;l<u.length;l++)if(s[l]!==u[l]){a=!0;break}}else a=!0;a&&e.sendUserAttributeChangeEvent(n,u,s,p,!1,this)}i._Forwarders.initForwarders(e.IdentityAPI.getCurrentUser().getUserIdentities(),i._APIClient.prepareForwardingStats);i._Forwarders.callSetUserAttributeOnForwarders(n,v)}},removeAllUserAttributes:function(){var n,r;if(i._SessionManager.resetSessionTimer(),i._Store.webviewBridgeEnabled)i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.RemoveAllUserAttributes);else if(n=this.getAllUserAttributes(),i._Forwarders.initForwarders(e.IdentityAPI.getCurrentUser().getUserIdentities(),i._APIClient.prepareForwardingStats),n)for(r in n)n.hasOwnProperty(r)&&i._Forwarders.applyToForwarders("removeUserAttribute",r),this.removeUserAttribute(r)},getUserAttributesLists:function(){var n,i={},t;n=this.getAllUserAttributes();for(t in n)n.hasOwnProperty(t)&&Array.isArray(n[t])&&(i[t]=n[t].slice());return i},getAllUserAttributes:function(){var u={},n=i._Persistence.getAllUserAttributes(r),t;if(n)for(t in n)n.hasOwnProperty(t)&&(u[t]=Array.isArray(n[t])?n[t].slice():n[t]);return u},getCart:function(){return i.Logger.warning("Deprecated function Identity.getCurrentUser().getCart() will be removed in future releases"),e.mParticleUserCart(r)},getConsentState:function(){return i._Persistence.getConsentState(r)},setConsentState:function(n){i._Persistence.saveUserConsentStateToCookies(r,n);i._Forwarders.initForwarders(this.getUserIdentities().userIdentities,i._APIClient.prepareForwardingStats)},isLoggedIn:function(){return u},getLastSeenTime:function(){return i._Persistence.getLastSeenTime(r)},getFirstSeenTime:function(){return i._Persistence.getFirstSeenTime(r)}}};this.mParticleUserCart=function(r){return{add:function(u,f){var s,e,o,h;i.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().add() will be removed in future releases");o=Array.isArray(u)?u.slice():[u];o.forEach(function(n){n.Attributes=i._Helpers.sanitizeAttributes(n.Attributes)});i._Store.webviewBridgeEnabled?i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.AddToCart,JSON.stringify(o)):(i._SessionManager.resetSessionTimer(),e=i._Persistence.getUserProductsFromLS(r),e=e.concat(o),f===!0&&i._Events.logProductActionEvent(n.ProductActionType.AddToCart,o),h={},h[r]={cp:e},e.length>i._Store.SDKConfig.maxProducts&&(i.Logger.verbose("The cart contains "+e.length+" items. Only "+i._Store.SDKConfig.maxProducts+" can currently be saved in cookies."),e=e.slice(-i._Store.SDKConfig.maxProducts)),s=i._Persistence.getAllUserProductsFromLS(),s[r].cp=e,i._Persistence.setCartProducts(s))},remove:function(u,f){var s,e,o,h,c;i.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().remove() will be removed in future releases");o=-1;h=null;i._Store.webviewBridgeEnabled?i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.RemoveFromCart,JSON.stringify(u)):(i._SessionManager.resetSessionTimer(),e=i._Persistence.getUserProductsFromLS(r),e&&(e.forEach(function(n,t){n.Sku===u.Sku&&(o=t,h=n)}),o>-1&&(e.splice(o,1),f===!0&&i._Events.logProductActionEvent(n.ProductActionType.RemoveFromCart,h))),c={},c[r]={cp:e},s=i._Persistence.getAllUserProductsFromLS(),s[r].cp=e,i._Persistence.setCartProducts(s))},clear:function(){i.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().clear() will be removed in future releases");var n;i._Store.webviewBridgeEnabled?i._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.ClearCart):(i._SessionManager.resetSessionTimer(),n=i._Persistence.getAllUserProductsFromLS(),n&&n[r]&&n[r].cp&&(n[r].cp=[],n[r].cp=[],i._Persistence.setCartProducts(n)))},getCartProducts:function(){return i.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().getCartProducts() will be removed in future releases"),i._Persistence.getCartProducts(r)}}};this.parseIdentityResponse=function(t,u,f,o,s){var c=i.Identity.getUser(u),l,h,v,a={},w=c?c.getUserIdentities().userIdentities:{},tt=i._Helpers.extend({},w),d,nt,y,p;i._Store.identityCallInFlight=!1;try{if(i.Logger.verbose('Parsing "'+s+'" identity response from server'),t.responseText&&(h=JSON.parse(t.responseText),h.hasOwnProperty("is_logged_in")&&(i._Store.isLoggedIn=h.is_logged_in)),(!c||c.getMPID()&&h.mpid&&h.mpid!==c.getMPID())&&(i._Store.mpid=h.mpid,c&&i._Persistence.setLastSeenTime(u),i._Persistence.setFirstSeenTime(h.mpid)),t.status===200){if(s==="modify")a=i._Identity.IdentityRequest.combineUserIdentities(w,o.userIdentities),i._Persistence.saveUserIdentitiesToPersistence(u,a);else{var b=r.IdentityAPI.getUser(h.mpid),k=b?b.getUserIdentities().userIdentities:{},it=i._Helpers.extend({},k);i.Logger.verbose("Successfully parsed Identity Response");s==="identify"&&c&&h.mpid===c.getMPID()&&i._Persistence.setFirstSeenTime(h.mpid);v=i._Store.currentSessionMPIDs.indexOf(h.mpid);i._Store.sessionId&&h.mpid&&u!==h.mpid&&v<0&&i._Store.currentSessionMPIDs.push(h.mpid);v>-1&&(i._Store.currentSessionMPIDs=i._Store.currentSessionMPIDs.slice(0,v).concat(i._Store.currentSessionMPIDs.slice(v+1,i._Store.currentSessionMPIDs.length)),i._Store.currentSessionMPIDs.push(h.mpid));i._CookieSyncManager.attemptCookieSync(u,h.mpid);r.checkIdentitySwap(u,h.mpid,i._Store.currentSessionMPIDs);Object.keys(i._Store.migrationData).length?(a=i._Store.migrationData.userIdentities||{},d=i._Store.migrationData.userAttributes||{},i._Persistence.saveUserAttributesToPersistence(h.mpid,d)):o&&o.userIdentities&&Object.keys(o.userIdentities).length&&(a=r.IdentityRequest.combineUserIdentities(k,o.userIdentities));i._Persistence.saveUserIdentitiesToPersistence(h.mpid,a);i._Persistence.update();i._Persistence.findPrevCookiesBasedOnUI(o);i._Store.context=h.context||i._Store.context}if(l=i.Identity.getCurrentUser(),o&&o.onUserAlias&&i._Helpers.Validators.isFunction(o.onUserAlias))try{i.Logger.warning("Deprecated function onUserAlias will be removed in future releases");o.onUserAlias(c,l)}catch(g){i.Logger.error("There was an error with your onUserAlias function - "+g)}nt=i._Persistence.getPersistence();l&&(i._Persistence.storeDataInMemory(nt,l.getMPID()),c&&l.getMPID()===c.getMPID()&&c.isLoggedIn()===l.isLoggedIn()||i._Forwarders.initForwarders(l.getUserIdentities().userIdentities,i._APIClient.prepareForwardingStats),i._Forwarders.setForwarderUserIdentities(l.getUserIdentities().userIdentities),i._Forwarders.setForwarderOnIdentityComplete(l,s),i._Forwarders.setForwarderOnUserIdentified(l,s));y={};for(p in a)y[n.IdentityType.getIdentityName(i._Helpers.parseNumber(p))]=a[p];r.sendUserIdentityChangeEvent(y,s,h.mpid,s==="modify"?tt:it)}f?t.status===0?i._Helpers.invokeCallback(f,e.noHttpCoverage,h||null,l):i._Helpers.invokeCallback(f,t.status,h||null,l):h&&h.errors&&h.errors.length&&i.Logger.error("Received HTTP response code of "+t.status+" - "+h.errors[0].message);i._APIClient.processQueuedEvents()}catch(g){f&&i._Helpers.invokeCallback(f,t.status,h||null);i.Logger.error("Error parsing JSON response from Identity server: "+g)}};this.sendUserIdentityChangeEvent=function(n,t,u,f){var o,s,e,h;if(i._APIClient.shouldEnableBatching()&&(u||t==="modify")){o=this.IdentityAPI.getUser(u);for(e in n)f[e]!==n[e]&&(h=!f[e],s=r.createUserIdentityChange(e,n[e],f[e],h,o),i._APIClient.sendEventToServer(s))}};this.createUserIdentityChange=function(t,r,u,f,e){return i._ServerModel.createEventObject({messageType:n.MessageType.UserIdentityChange,userIdentityChanges:{New:{IdentityType:t,Identity:r,CreatedThisBatch:f},Old:{IdentityType:t,Identity:u,CreatedThisBatch:!1}},userInMemory:e})};this.sendUserAttributeChangeEvent=function(n,t,u,f,e,o){if(i._APIClient.shouldEnableBatching()){var s=r.createUserAttributeChange(n,t,u,f,e,o);s&&i._APIClient.sendEventToServer(s)}};this.createUserAttributeChange=function(t,r,u,f,e,o){u||(u=null);var s;return r!==u&&(s=i._ServerModel.createEventObject({messageType:n.MessageType.UserAttributeChange,userAttributeChanges:{UserAttributeName:t,New:r,Old:u||null,Deleted:e,IsNewAttribute:f}},o)),s}}function no(n){var i=this,t="data_sale_opt_out";this.createPrivacyConsent=function(t,i,r,u,f){return typeof t!="boolean"?(n.Logger.error("Consented boolean is required when constructing a Consent object."),null):i&&isNaN(i)?(n.Logger.error("Timestamp must be a valid number when constructing a Consent object."),null):r&&typeof r!="string"?(n.Logger.error("Document must be a valid string when constructing a Consent object."),null):u&&typeof u!="string"?(n.Logger.error("Location must be a valid string when constructing a Consent object."),null):f&&typeof f!="string"?(n.Logger.error("Hardware ID must be a valid string when constructing a Consent object."),null):{Consented:t,Timestamp:i||Date.now(),ConsentDocument:r,Location:u,HardwareId:f}};this.ConsentSerialization={toMinifiedJsonObject:function(n){var i={},e,f,u,r;if(n){if(e=n.getGDPRConsentState(),e){i.gdpr={};for(f in e)e.hasOwnProperty(f)&&(u=e[f],i.gdpr[f]={},typeof u.Consented=="boolean"&&(i.gdpr[f].c=u.Consented),typeof u.Timestamp=="number"&&(i.gdpr[f].ts=u.Timestamp),typeof u.ConsentDocument=="string"&&(i.gdpr[f].d=u.ConsentDocument),typeof u.Location=="string"&&(i.gdpr[f].l=u.Location),typeof u.HardwareId=="string"&&(i.gdpr[f].h=u.HardwareId))}r=n.getCCPAConsentState();r&&(i.ccpa={},i.ccpa[t]={},typeof r.Consented=="boolean"&&(i.ccpa[t].c=r.Consented),typeof r.Timestamp=="number"&&(i.ccpa[t].ts=r.Timestamp),typeof r.ConsentDocument=="string"&&(i.ccpa[t].d=r.ConsentDocument),typeof r.Location=="string"&&(i.ccpa[t].l=r.Location),typeof r.HardwareId=="string"&&(i.ccpa[t].h=r.HardwareId))}return i},fromMinifiedJsonObject:function(n){var u=i.createConsentState(),r,f,e;if(n.gdpr)for(r in n.gdpr)n.gdpr.hasOwnProperty(r)&&(f=i.createPrivacyConsent(n.gdpr[r].c,n.gdpr[r].ts,n.gdpr[r].d,n.gdpr[r].l,n.gdpr[r].h),u.addGDPRConsentState(r,f));return n.ccpa&&n.ccpa.hasOwnProperty(t)&&(e=i.createPrivacyConsent(n.ccpa[t].c,n.ccpa[t].ts,n.ccpa[t].d,n.ccpa[t].l,n.ccpa[t].h),u.setCCPAConsentState(e)),u}};this.createConsentState=function(r){function e(n){if(typeof n!="string")return null;var t=n.trim();return t.length?t.toLowerCase():null}function o(t,r){var o=e(t),f;return o?n._Helpers.isObject(r)?(f=i.createPrivacyConsent(r.Consented,r.Timestamp,r.ConsentDocument,r.Location,r.HardwareId),f&&(u[o]=f),this):(n.Logger.error("Invoked with a bad or empty consent object."),this):(n.Logger.error("Purpose must be a string."),this)}function s(t){if(t){if(n._Helpers.isObject(t)){u={};for(var i in t)t.hasOwnProperty(i)&&o(i,t[i])}}else u={};return this}function l(n){var t=e(n);return t?(delete u[t],this):this}function a(){return n._Helpers.extend({},u)}function h(r){if(!n._Helpers.isObject(r))return n.Logger.error("Invoked with a bad or empty CCPA consent object."),this;var u=i.createPrivacyConsent(r.Consented,r.Timestamp,r.ConsentDocument,r.Location,r.HardwareId);return u&&(f[t]=u),this}function v(){return f[t]}function c(){return delete f[t],this}function y(){return n.Logger.warning("removeCCPAState is deprecated and will be removed in a future release; use removeCCPAConsentState instead"),c()}var u={},f={};return r&&(s(r.getGDPRConsentState()),h(r.getCCPAConsentState())),{setGDPRConsentState:s,addGDPRConsentState:o,setCCPAConsentState:h,getCCPAConsentState:v,getGDPRConsentState:a,removeGDPRConsentState:l,removeCCPAState:y,removeCCPAConsentState:c}}}function vr(i){var r=this;this._instanceName=i;this._NativeSdkHelpers=new ee(this);this._Migrations=new be(this);this._SessionManager=new se(this);this._Persistence=new ve(this);this._Helpers=new fe(this);this._Forwarders=new ke(this);this._APIClient=new ie(this);this._Events=new ye(this);this._CookieSyncManager=new oe(this);this._ServerModel=new lr(this);this._Ecommerce=new he(this);this._ForwardingStatsUploader=new de(this);this._Consent=new no(this);this._preInit={readyQueue:[],integrationDelays:{},forwarderConstructors:[]};this.IdentityType=n.IdentityType;this.EventType=n.EventType;this.CommerceEventType=n.CommerceEventType;this.PromotionType=n.PromotionActionType;this.ProductActionType=n.ProductActionType;this._Identity=new ge(this);this.Identity=this._Identity.IdentityAPI;this.generateHash=this._Helpers.generateHash;this.getDeviceId=this._Persistence.getDeviceId;window.mParticle&&window.mParticle.config&&window.mParticle.config.hasOwnProperty("rq")&&(this._preInit.readyQueue=window.mParticle.config.rq);this.init=function(n,t){if(t||window.console.warn("You did not pass a config object to init(). mParticle will not initialize properly"),to(this,n,t),t)!t.hasOwnProperty("requestConfig")||t.requestConfig?r._APIClient.getSDKConfiguration(n,t,yr,this):yr(n,t,this);else{window.console.error("No config available on the window, please pass a config object to mParticle.init()");return}};this.setLogLevel=function(n){r.Logger.setLogLevel(n)};this.reset=function(n){n._Persistence.resetPersistence();n._Store&&delete n._Store};this._resetForTests=function(n,t,i){i._Store&&delete i._Store;i._Store=new sr(n,i);i._Store.isLocalStorageAvailable=i._Persistence.determineLocalStorageAvailability(window.localStorage);i._Events.stopTracking();t||i._Persistence.resetPersistence();i._Persistence.forwardingStatsBatches.uploadsTable={};i._Persistence.forwardingStatsBatches.forwardingStatsEventQueue=[];i._preInit={readyQueue:[],pixelConfigurations:[],integrationDelays:{},forwarderConstructors:[],isDevelopmentMode:!1}};this.ready=function(n){r._Store.isInitialized&&typeof n=="function"?n():r._preInit.readyQueue.push(n)};this.getVersion=function(){return t.sdkVersion};this.setAppVersion=function(n){r._Store.SDKConfig.appVersion=n;r._Persistence.update()};this.getAppName=function(){return r._Store.SDKConfig.appName};this.setAppName=function(n){r._Store.SDKConfig.appName=n};this.getAppVersion=function(){return r._Store.SDKConfig.appVersion};this.stopTrackingLocation=function(){r._SessionManager.resetSessionTimer();r._Events.stopTracking()};this.startTrackingLocation=function(n){r._Helpers.Validators.isFunction(n)||r.Logger.warning("Warning: Location tracking is triggered, but not including a callback into the `startTrackingLocation` may result in events logged too quickly and not being associated with a location.");r._SessionManager.resetSessionTimer();r._Events.startTracking(n)};this.setPosition=function(n,t){r._SessionManager.resetSessionTimer();typeof n=="number"&&typeof t=="number"?r._Store.currentPosition={lat:n,lng:t}:r.Logger.error("Position latitude and/or longitude must both be of type number")};this.startNewSession=function(){r._SessionManager.startNewSession()};this.endSession=function(){r._SessionManager.endSession(!0)};this.logBaseEvent=function(t){if(!r._Store.isInitialized){r.ready(function(){r.logBaseEvent(t)});return}if(r._SessionManager.resetSessionTimer(),typeof t.name!="string"){r.Logger.error(nt.ErrorMessages.EventNameInvalidType);return}if(t.eventType||(t.eventType=n.EventType.Unknown),!r._Helpers.canLog()){r.Logger.error(nt.ErrorMessages.LoggingDisabled);return}r._Events.logEvent(t)};this.logEvent=function(t,i,u,f){if(!r._Store.isInitialized){r.ready(function(){r.logEvent(t,i,u,f)});return}if(r._SessionManager.resetSessionTimer(),typeof t!="string"){r.Logger.error(nt.ErrorMessages.EventNameInvalidType);return}if(i||(i=n.EventType.Unknown),!r._Helpers.isEventType(i)){r.Logger.error("Invalid event type: "+i+", must be one of: \n"+JSON.stringify(n.EventType));return}if(!r._Helpers.canLog()){r.Logger.error(nt.ErrorMessages.LoggingDisabled);return}r._Events.logEvent({messageType:n.MessageType.PageEvent,name:t,data:u,eventType:i,customFlags:f})};this.logError=function(t,i){var u,f,e;if(!r._Store.isInitialized){r.ready(function(){r.logError(t,i)});return}if(r._SessionManager.resetSessionTimer(),t){if(typeof t=="string"&&(t={message:t}),u={m:t.message?t.message:t,s:"Error",t:t.stack},i){f=r._Helpers.sanitizeAttributes(i);for(e in f)u[e]=f[e]}r._Events.logEvent({messageType:n.MessageType.CrashReport,name:t.name?t.name:"Error",data:u,eventType:n.EventType.Other})}};this.logLink=function(n,t,i,u){r._Events.addEventHandler("click",n,t,u,i)};this.logForm=function(n,t,i,u){r._Events.addEventHandler("submit",n,t,u,i)};this.logPageView=function(t,i,u){if(!r._Store.isInitialized){r.ready(function(){r.logPageView(t,i,u)});return}if(r._SessionManager.resetSessionTimer(),r._Helpers.canLog()){if(r._Helpers.Validators.isStringOrNumber(t)||(t="PageView"),i){if(!r._Helpers.isObject(i)){r.Logger.error("The attributes argument must be an object. A "+h(i)+" was entered. Please correct and retry.");return}}else i={hostname:window.location.hostname,title:window.document.title};if(u&&!r._Helpers.isObject(u)){r.Logger.error("The customFlags argument must be an object. A "+h(u)+" was entered. Please correct and retry.");return}}r._Events.logEvent({messageType:n.MessageType.PageView,name:t,data:i,eventType:n.EventType.Unknown,customFlags:u})};this.upload=function(){r._Helpers.canLog()&&(r._Store.webviewBridgeEnabled?r._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.Upload):r._APIClient.uploader.prepareAndUpload(!1,!1))};this.Consent={createCCPAConsent:r._Consent.createPrivacyConsent,createGDPRConsent:r._Consent.createPrivacyConsent,createConsentState:r._Consent.createConsentState};this.eCommerce={Cart:{add:function(n,t){r.Logger.warning("Deprecated function eCommerce.Cart.add() will be removed in future releases");var i,u=r.Identity.getCurrentUser();u&&(i=u.getMPID());r._Identity.mParticleUserCart(i).add(n,t)},remove:function(n,t){r.Logger.warning("Deprecated function eCommerce.Cart.remove() will be removed in future releases");var i,u=r.Identity.getCurrentUser();u&&(i=u.getMPID());r._Identity.mParticleUserCart(i).remove(n,t)},clear:function(){r.Logger.warning("Deprecated function eCommerce.Cart.clear() will be removed in future releases");var n,t=r.Identity.getCurrentUser();t&&(n=t.getMPID());r._Identity.mParticleUserCart(n).clear()}},setCurrencyCode:function(n){if(!r._Store.isInitialized){r.ready(function(){r.setCurrencyCode(n)});return}if(typeof n!="string"){r.Logger.error("Code must be a string");return}r._SessionManager.resetSessionTimer();r._Store.currencyCode=n},createProduct:function(n,t,i,u,f,e,o,s,h,c){return r._Ecommerce.createProduct(n,t,i,u,f,e,o,s,h,c)},createPromotion:function(n,t,i,u){return r._Ecommerce.createPromotion(n,t,i,u)},createImpression:function(n,t){return r._Ecommerce.createImpression(n,t)},createTransactionAttributes:function(n,t,i,u,f,e){return r._Ecommerce.createTransactionAttributes(n,t,i,u,f,e)},logCheckout:function(n,t,i,u){if(r.Logger.warning("mParticle.logCheckout is deprecated, please use mParticle.logProductAction instead"),!r._Store.isInitialized){r.ready(function(){r.eCommerce.logCheckout(n,t,i,u)});return}r._SessionManager.resetSessionTimer();r._Events.logCheckoutEvent(n,t,i,u)},logProductAction:function(n,t,i,u,f){if(!r._Store.isInitialized){r.ready(function(){r.eCommerce.logProductAction(n,t,i,u,f)});return}r._SessionManager.resetSessionTimer();r._Events.logProductActionEvent(n,t,i,u,f)},logPurchase:function(n,t,i,u,f){if(r.Logger.warning("mParticle.logPurchase is deprecated, please use mParticle.logProductAction instead"),!r._Store.isInitialized){r.ready(function(){r.eCommerce.logPurchase(n,t,i,u,f)});return}if(!n||!t){r.Logger.error(nt.ErrorMessages.BadLogPurchase);return}r._SessionManager.resetSessionTimer();r._Events.logPurchaseEvent(n,t,u,f)},logPromotion:function(n,t,i,u){if(!r._Store.isInitialized){r.ready(function(){r.eCommerce.logPromotion(n,t,i,u)});return}r._SessionManager.resetSessionTimer();r._Events.logPromotionEvent(n,t,i,u)},logImpression:function(n,t,i){if(!r._Store.isInitialized){r.ready(function(){r.eCommerce.logImpression(n,t,i)});return}r._SessionManager.resetSessionTimer();r._Events.logImpressionEvent(n,t,i)},logRefund:function(n,t,i,u,f){if(r.Logger.warning("mParticle.logRefund is deprecated, please use mParticle.logProductAction instead"),!r._Store.isInitialized){r.ready(function(){r.eCommerce.logRefund(n,t,i,u,f)});return}r._SessionManager.resetSessionTimer();r._Events.logRefundEvent(n,t,u,f)},expandCommerceEvent:function(n){return r._Ecommerce.expandCommerceEvent(n)}};this.setSessionAttribute=function(n,i){if(!r._Store.isInitialized){r.ready(function(){r.setSessionAttribute(n,i)});return}if(r._Helpers.canLog()){if(!r._Helpers.Validators.isValidAttributeValue(i)){r.Logger.error(nt.ErrorMessages.BadAttribute);return}if(!r._Helpers.Validators.isValidKeyValue(n)){r.Logger.error(nt.ErrorMessages.BadKey);return}if(r._Store.webviewBridgeEnabled)r._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:n,value:i}));else{var u=r._Helpers.findKeyInObject(r._Store.sessionAttributes,n);u&&(n=u);r._Store.sessionAttributes[n]=i;r._Persistence.update();r._Forwarders.applyToForwarders("setSessionAttribute",[n,i])}}};this.setOptOut=function(n){if(!r._Store.isInitialized){r.ready(function(){r.setOptOut(n)});return}r._SessionManager.resetSessionTimer();r._Store.isEnabled=!n;r._Events.logOptOut();r._Persistence.update();r._Store.activeForwarders.length&&r._Store.activeForwarders.forEach(function(t){if(t.setOptOut){var i=t.setOptOut(n);i&&r.Logger.verbose(i)}})};this.setIntegrationAttribute=function(n,t){if(!r._Store.isInitialized){r.ready(function(){r.setIntegrationAttribute(n,t)});return}if(typeof n!="number"){r.Logger.error("integrationId must be a number");return}if(t===null)r._Store.integrationAttributes[n]={};else if(r._Helpers.isObject(t))if(Object.keys(t).length===0)r._Store.integrationAttributes[n]={};else for(var i in t)if(typeof i=="string")if(typeof t[i]=="string")r._Helpers.isObject(r._Store.integrationAttributes[n])?r._Store.integrationAttributes[n][i]=t[i]:(r._Store.integrationAttributes[n]={},r._Store.integrationAttributes[n][i]=t[i]);else{r.Logger.error("Values for integration attributes must be strings. You entered a "+h(t[i]));continue}else{r.Logger.error("Keys must be strings, you entered a "+h(i));continue}else{r.Logger.error("Attrs must be an object with keys and values. You entered a "+h(t));return}r._Persistence.update()};this.getIntegrationAttributes=function(n){return r._Store.integrationAttributes[n]?r._Store.integrationAttributes[n]:{}};this.addForwarder=function(n){r._preInit.forwarderConstructors.push(n)};this.configurePixel=function(n){r._Forwarders.configurePixel(n)};this._getActiveForwarders=function(){return r._Store.activeForwarders};this._getIntegrationDelays=function(){return r._preInit.integrationDelays};this._setIntegrationDelay=function(n,t){r._preInit.integrationDelays[n]=t}}function yr(n,i,r){var u,o,f,e;if(i.flags&&(i.flags.hasOwnProperty(t.FeatureFlags.EventsV3)&&(r._Store.SDKConfig.flags[t.FeatureFlags.EventsV3]=i.flags[t.FeatureFlags.EventsV3]),i.flags.hasOwnProperty(t.FeatureFlags.EventBatchingIntervalMillis)&&(r._Store.SDKConfig.flags[t.FeatureFlags.EventBatchingIntervalMillis]=i.flags[t.FeatureFlags.EventBatchingIntervalMillis])),r._Store.storageName=r._Helpers.createMainStorageName(i.workspaceToken),r._Store.prodStorageName=r._Helpers.createProductStorageName(i.workspaceToken),i.hasOwnProperty("workspaceToken")?r._Store.SDKConfig.workspaceToken=i.workspaceToken:r.Logger.warning("You should have a workspaceToken on your config object for security purposes."),i.hasOwnProperty("requiredWebviewBridgeName")?r._Store.SDKConfig.requiredWebviewBridgeName=i.requiredWebviewBridgeName:i.hasOwnProperty("workspaceToken")&&(r._Store.SDKConfig.requiredWebviewBridgeName=i.workspaceToken),r._Store.webviewBridgeEnabled=r._NativeSdkHelpers.isWebviewEnabled(r._Store.SDKConfig.requiredWebviewBridgeName,r._Store.SDKConfig.minWebviewBridgeVersion),r._Store.configurationLoaded=!0,r._Store.webviewBridgeEnabled||(r._Migrations.migrate(),r._Persistence.initializeStorage()),r._Store.webviewBridgeEnabled)r._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:"$src_env",value:"webview"})),n&&r._NativeSdkHelpers.sendToNative(t.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:"$src_key",value:n}));else{if(r._Helpers.isObject(r._Store.SDKConfig.identifyRequest)&&r._Helpers.isObject(r._Store.SDKConfig.identifyRequest.userIdentities)&&Object.keys(r._Store.SDKConfig.identifyRequest.userIdentities).length===0||!r._Store.SDKConfig.identifyRequest){if(o={},u=r.Identity.getCurrentUser(),u){f=u.getUserIdentities().userIdentities||{};for(e in f)f.hasOwnProperty(e)&&(o[e]=f[e])}r._Store.SDKConfig.identifyRequest={userIdentities:o}}r._Store.migratingToIDSyncCookies&&(r.Identity.identify(r._Store.SDKConfig.identifyRequest,r._Store.SDKConfig.identityCallback),r._Store.migratingToIDSyncCookies=!1);u=r.Identity.getCurrentUser();r._Helpers.getFeatureFlag(t.FeatureFlags.ReportBatching)&&r._ForwardingStatsUploader.startForwardingStatsTimer();r._Forwarders.processForwarders(i,r._APIClient.prepareForwardingStats);!r._Store.identifyCalled&&r._Store.SDKConfig.identityCallback&&u&&u.getMPID()&&r._Store.SDKConfig.identityCallback({httpCode:ar.activeSession,getUser:function(){return r._Identity.mParticleUser(u.getMPID())},getPreviousUser:function(){var t=r.Identity.getUsers(),n=t.shift();return n&&u&&n.getMPID()===u.getMPID()&&(n=t.shift()),n||null},body:{mpid:u.getMPID(),is_logged_in:r._Store.isLoggedIn,matched_identities:u.getUserIdentities().userIdentities,context:null,is_ephemeral:!1}});r._SessionManager.initialize();r._Events.logAST()}r._Store.isInitialized=!0;r._preInit.readyQueue&&r._preInit.readyQueue.length&&(r._preInit.readyQueue.forEach(function(n){r._Helpers.Validators.isFunction(n)?n():Array.isArray(n)&&io(n,r)}),r._preInit.readyQueue=[]);r._Store.isFirstRun&&(r._Store.isFirstRun=!1)}function to(n,t,i){n.Logger=new le(i);n._Store=new sr(i,n);window.mParticle.Store=n._Store;n._Store.devToken=t||null;n.Logger.verbose(nt.InformationMessages.StartingInitialization);try{n._Store.isLocalStorageAvailable=n._Persistence.determineLocalStorageAvailability(window.localStorage)}catch(r){n.Logger.warning("localStorage is not available, using cookies if avaialble");n._Store.isLocalStorageAvailable=!1}}function io(n,t){var i=n,e=i.splice(0,1)[0],f,r,u,o;if(mParticle[i[0]])mParticle[e].apply(this,i);else{f=e.split(".");try{for(r=mParticle,u=0;u<f.length;u++)o=f[u],r=r[o];r.apply(this,i)}catch(s){t.Logger.verbose("Unable to compute proper mParticle function "+s)}}}function ro(){var i=this;this.Store={};this._instances={};this.IdentityType=n.IdentityType;this.EventType=n.EventType;this.CommerceEventType=n.CommerceEventType;this.PromotionType=n.PromotionActionType;this.ProductActionType=n.ProductActionType;this.isIOS=window.mParticle&&window.mParticle.isIOS?window.mParticle.isIOS:!1;this.config=window.mParticle&&window.mParticle.config?window.mParticle.config:{};this.init=function(n,r,u){!r&&window.mParticle&&window.mParticle.config&&(window.console.warn("You did not pass a config object to mParticle.init(). Attempting to use the window.mParticle.config if it exists. Please note that in a future release, this may not work and mParticle will not initialize properly"),r=window.mParticle?window.mParticle.config:{});u=(!u||u.length===0?t.DefaultInstance:u).toLowerCase();var f=i._instances[u];f===undefined&&(f=new vr(n,r,u),i._instances[u]=f);f.init(n,r,u)};this.getInstance=function(n){var r;return n?(r=i._instances[n.toLowerCase()],!r)?(console.log("You tried to initialize an instance named "+n+". This instance does not exist. Check your instance name or initialize a new instance with this name before calling it."),null):r:(n=t.DefaultInstance,r=i._instances[n],r||(r=new vr(n),i._instances[t.DefaultInstance]=r),r)};this.getDeviceId=function(){return i.getInstance().getDeviceId()};this.startNewSession=function(){i.getInstance().startNewSession()};this.endSession=function(){i.getInstance().endSession()};this.setLogLevel=function(n){i.getInstance().setLogLevel(n)};this.ready=function(n){i.getInstance().ready(n)};this.setAppVersion=function(n){i.getInstance().setAppVersion(n)};this.getAppName=function(){return i.getInstance().getAppName()};this.setAppName=function(n){i.getInstance().setAppName(n)};this.getAppVersion=function(){return i.getInstance().getAppVersion()};this.stopTrackingLocation=function(){i.getInstance().stopTrackingLocation()};this.startTrackingLocation=function(n){i.getInstance().startTrackingLocation(n)};this.setPosition=function(n,t){i.getInstance().setPosition(n,t)};this.startNewSession=function(){i.getInstance().startNewSession()};this.endSession=function(){i.getInstance().endSession()};this.logBaseEvent=function(n){i.getInstance().logBaseEvent(n)};this.logEvent=function(n,t,r,u){i.getInstance().logEvent(n,t,r,u)};this.logError=function(n,t){i.getInstance().logError(n,t)};this.logLink=function(n,t,r,u){i.getInstance().logLink(n,t,r,u)};this.logForm=function(n,t,r,u){i.getInstance().logForm(n,t,r,u)};this.logPageView=function(n,t,r){i.getInstance().logPageView(n,t,r)};this.upload=function(){i.getInstance().upload()};this.eCommerce={Cart:{add:function(n,t){i.getInstance().eCommerce.Cart.add(n,t)},remove:function(n,t){i.getInstance().eCommerce.Cart.remove(n,t)},clear:function(){i.getInstance().eCommerce.Cart.clear()}},setCurrencyCode:function(n){i.getInstance().eCommerce.setCurrencyCode(n)},createProduct:function(n,t,r,u,f,e,o,s,h,c){return i.getInstance().eCommerce.createProduct(n,t,r,u,f,e,o,s,h,c)},createPromotion:function(n,t,r,u){return i.getInstance().eCommerce.createPromotion(n,t,r,u)},createImpression:function(n,t){return i.getInstance().eCommerce.createImpression(n,t)},createTransactionAttributes:function(n,t,r,u,f,e){return i.getInstance().eCommerce.createTransactionAttributes(n,t,r,u,f,e)},logCheckout:function(n,t,r,u){i.getInstance().eCommerce.logCheckout(n,t,r,u)},logProductAction:function(n,t,r,u,f){i.getInstance().eCommerce.logProductAction(n,t,r,u,f)},logPurchase:function(n,t,r,u,f){i.getInstance().eCommerce.logPurchase(n,t,r,u,f)},logPromotion:function(n,t,r,u){i.getInstance().eCommerce.logPromotion(n,t,r,u)},logImpression:function(n,t,r){i.getInstance().eCommerce.logImpression(n,t,r)},logRefund:function(n,t,r,u,f){i.getInstance().eCommerce.logRefund(n,t,r,u,f)},expandCommerceEvent:function(n){return i.getInstance().eCommerce.expandCommerceEvent(n)}};this.setSessionAttribute=function(n,t){i.getInstance().setSessionAttribute(n,t)};this.setOptOut=function(n){i.getInstance().setOptOut(n)};this.setIntegrationAttribute=function(n,t){i.getInstance().setIntegrationAttribute(n,t)};this.getIntegrationAttributes=function(n){return i.getInstance().getIntegrationAttributes(n)};this.Identity={HTTPCodes:i.getInstance().Identity.HTTPCodes,aliasUsers:function(n,t){i.getInstance().Identity.aliasUsers(n,t)},createAliasRequest:function(n,t){return i.getInstance().Identity.createAliasRequest(n,t)},getCurrentUser:function(){return i.getInstance().Identity.getCurrentUser()},getUser:function(n){return i.getInstance().Identity.getUser(n)},getUsers:function(){return i.getInstance().Identity.getUsers()},identify:function(n,t){i.getInstance().Identity.identify(n,t)},login:function(n,t){i.getInstance().Identity.login(n,t)},logout:function(n,t){i.getInstance().Identity.logout(n,t)},modify:function(n,t){i.getInstance().Identity.modify(n,t)}};this.sessionManager={getSession:function(){return i.getInstance()._SessionManager.getSession()}};this.Consent={createConsentState:function(){return i.getInstance().Consent.createConsentState()},createGDPRConsent:function(n,t,r,u,f){return i.getInstance().Consent.createGDPRConsent(n,t,r,u,f)},createCCPAConsent:function(n,t,r,u,f){return i.getInstance().Consent.createGDPRConsent(n,t,r,u,f)}};this.reset=function(){i.getInstance().reset(i.getInstance())};this._resetForTests=function(n,t){typeof t=="boolean"?i.getInstance()._resetForTests(n,t,i.getInstance()):i.getInstance()._resetForTests(n,!1,i.getInstance())};this.configurePixel=function(n){i.getInstance().configurePixel(n)};this._setIntegrationDelay=function(n,t){i.getInstance()._setIntegrationDelay(n,t)};this._getIntegrationDelays=function(){return i.getInstance()._getIntegrationDelays()};this.getVersion=function(){return i.getInstance().getVersion()};this.generateHash=function(n){return i.getInstance().generateHash(n)};this.addForwarder=function(n){i.getInstance().addForwarder(n)};this._getActiveForwarders=function(){return i.getInstance()._getActiveForwarders()}}var y={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(n){try{if(window.btoa&&window.atob)return window.btoa(unescape(encodeURIComponent(n)))}catch(t){window.console.log("Error encoding cookie values into Base64:"+t)}return this._encode(n)},_encode:function(n){var f="",e,t,i,s,h,o,r,u=0;for(n=si.encode(n);u<n.length;)e=n.charCodeAt(u++),t=n.charCodeAt(u++),i=n.charCodeAt(u++),s=e>>2,h=(e&3)<<4|t>>4,o=(t&15)<<2|i>>6,r=i&63,isNaN(t)?o=r=64:isNaN(i)&&(r=64),f=f+y._keyStr.charAt(s)+y._keyStr.charAt(h)+y._keyStr.charAt(o)+y._keyStr.charAt(r);return f},decode:function(n){try{if(window.btoa&&window.atob)return decodeURIComponent(escape(window.atob(n)))}catch(t){}return y._decode(n)},_decode:function(n){var t="",e,o,s,h,u,r,f,i=0;for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<n.length;)h=y._keyStr.indexOf(n.charAt(i++)),u=y._keyStr.indexOf(n.charAt(i++)),r=y._keyStr.indexOf(n.charAt(i++)),f=y._keyStr.indexOf(n.charAt(i++)),e=h<<2|u>>4,o=(u&15)<<4|r>>2,s=(r&3)<<6|f,t=t+String.fromCharCode(e),r!==64&&(t=t+String.fromCharCode(o)),f!==64&&(t=t+String.fromCharCode(s));return si.decode(t)}},si={encode:function(n){for(var t,i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i},decode:function(n){for(var r="",t=0,i=0,u=0,f=0;t<n.length;)i=n.charCodeAt(t),i<128?(r+=String.fromCharCode(i),t++):i>191&&i<224?(u=n.charCodeAt(t+1),r+=String.fromCharCode((i&31)<<6|u&63),t+=2):(u=n.charCodeAt(t+1),f=n.charCodeAt(t+2),r+=String.fromCharCode((i&15)<<12|(u&63)<<6|f&63),t+=3);return r}},ut={forEach:function(n,t){var u,i,r,f,e;if(this==null)throw new TypeError(" this is null or not defined");if(r=Object(this),f=r.length>>>0,typeof n!="function")throw new TypeError(n+" is not a function");for(arguments.length>1&&(u=t),i=0;i<f;)i in r&&(e=r[i],n.call(u,e,i,r)),i++},map:function(n,t){var e,u,i,r,f,o,s;if(this===null)throw new TypeError(" this is null or not defined");if(r=Object(this),f=r.length>>>0,typeof n!="function")throw new TypeError(n+" is not a function");for(arguments.length>1&&(e=t),u=new Array(f),i=0;i<f;)i in r&&(o=r[i],s=n.call(e,o,i,r),u[i]=s),i++;return u},filter:function(n){var i,f,r,e,t,u;if(this===void 0||this===null)throw new TypeError;if(i=Object(this),f=i.length>>>0,typeof n!="function")throw new TypeError;for(r=[],e=arguments.length>=2?arguments[1]:void 0,t=0;t<f;t++)t in i&&(u=i[t],n.call(e,u,t,i)&&r.push(u));return r},isArray:function(n){return Object.prototype.toString.call(n)==="[object Array]"},Base64:y},l=wr,hi={SessionStart:1,SessionEnd:2,PageView:3,PageEvent:4,CrashReport:5,OptOut:6,AppStateTransition:10,Profile:14,Commerce:16,Media:20,UserAttributeChange:17,UserIdentityChange:18},br=l({},hi.Commerce,1),d={Unknown:0,Navigation:1,Location:2,Search:3,Transaction:4,UserContent:5,UserPreference:6,Social:7,Other:8,Media:9,getName:function(n){switch(n){case d.Unknown:return"Unknown";case d.Navigation:return"Navigation";case d.Location:return"Location";case d.Search:return"Search";case d.Transaction:return"Transaction";case d.UserContent:return"User Content";case d.UserPreference:return"User Preference";case d.Social:return"Social";case s.ProductAddToCart:return"Product Added to Cart";case s.ProductAddToWishlist:return"Product Added to Wishlist";case s.ProductCheckout:return"Product Checkout";case s.ProductCheckoutOption:return"Product Checkout Options";case s.ProductClick:return"Product Click";case s.ProductImpression:return"Product Impression";case s.ProductPurchase:return"Product Purchased";case s.ProductRefund:return"Product Refunded";case s.ProductRemoveFromCart:return"Product Removed From Cart";case s.ProductRemoveFromWishlist:return"Product Removed from Wishlist";case s.ProductViewDetail:return"Product View Details";case s.PromotionClick:return"Promotion Click";case s.PromotionView:return"Promotion View";default:return"Other"}}},s={ProductAddToCart:10,ProductRemoveFromCart:11,ProductCheckout:12,ProductCheckoutOption:13,ProductClick:14,ProductViewDetail:15,ProductPurchase:16,ProductRefund:17,PromotionView:18,PromotionClick:19,ProductAddToWishlist:20,ProductRemoveFromWishlist:21,ProductImpression:22},i={Other:0,CustomerId:1,Facebook:2,Twitter:3,Google:4,Microsoft:5,Yahoo:6,Email:7,FacebookCustomAudienceId:9,Other2:10,Other3:11,Other4:12,Other5:13,Other6:14,Other7:15,Other8:16,Other9:17,Other10:18,MobileNumber:19,PhoneNumber2:20,PhoneNumber3:21},u,tt,h,ci,ni,li,wt,vi,yi,pi,wi,ti,et,ot,lt,a,r,bt,or,ht,yt,rt,gt,cr,f,e,nt,ar,pr,oi;i.isValid=function(n){if(typeof n=="number")for(var t in i)if(i.hasOwnProperty(t)&&i[t]===n)return!0;return!1};i.getName=function(n){switch(n){case window.mParticle.IdentityType.CustomerId:return"Customer ID";case window.mParticle.IdentityType.Facebook:return"Facebook ID";case window.mParticle.IdentityType.Twitter:return"Twitter ID";case window.mParticle.IdentityType.Google:return"Google ID";case window.mParticle.IdentityType.Microsoft:return"Microsoft ID";case window.mParticle.IdentityType.Yahoo:return"Yahoo ID";case window.mParticle.IdentityType.Email:return"Email";case window.mParticle.IdentityType.FacebookCustomAudienceId:return"Facebook App User ID";default:return"Other ID"}};i.getIdentityType=function(n){switch(n){case"other":return i.Other;case"customerid":return i.CustomerId;case"facebook":return i.Facebook;case"twitter":return i.Twitter;case"google":return i.Google;case"microsoft":return i.Microsoft;case"yahoo":return i.Yahoo;case"email":return i.Email;case"facebookcustomaudienceid":return i.FacebookCustomAudienceId;case"other2":return i.Other2;case"other3":return i.Other3;case"other4":return i.Other4;case"other5":return i.Other5;case"other6":return i.Other6;case"other7":return i.Other7;case"other8":return i.Other8;case"other9":return i.Other9;case"other10":return i.Other10;case"mobile_number":return i.MobileNumber;case"phone_number_2":return i.PhoneNumber2;case"phone_number_3":return i.PhoneNumber3;default:return!1}};i.getIdentityName=function(n){switch(n){case i.Other:return"other";case i.CustomerId:return"customerid";case i.Facebook:return"facebook";case i.Twitter:return"twitter";case i.Google:return"google";case i.Microsoft:return"microsoft";case i.Yahoo:return"yahoo";case i.Email:return"email";case i.FacebookCustomAudienceId:return"facebookcustomaudienceid";case i.Other2:return"other2";case i.Other3:return"other3";case i.Other4:return"other4";case i.Other5:return"other5";case i.Other6:return"other6";case i.Other7:return"other7";case i.Other8:return"other8";case i.Other9:return"other9";case i.Other10:return"other10";case i.MobileNumber:return"mobile_number";case i.PhoneNumber2:return"phone_number_2";case i.PhoneNumber3:return"phone_number_3"}};u={Unknown:0,AddToCart:1,RemoveFromCart:2,Checkout:3,CheckoutOption:4,Click:5,ViewDetail:6,Purchase:7,Refund:8,AddToWishlist:9,RemoveFromWishlist:10};u.getName=function(n){switch(n){case u.AddToCart:return"Add to Cart";case u.RemoveFromCart:return"Remove from Cart";case u.Checkout:return"Checkout";case u.CheckoutOption:return"Checkout Option";case u.Click:return"Click";case u.ViewDetail:return"View Detail";case u.Purchase:return"Purchase";case u.Refund:return"Refund";case u.AddToWishlist:return"Add to Wishlist";case u.RemoveFromWishlist:return"Remove from Wishlist";default:return"Unknown"}};u.getExpansionName=function(n){switch(n){case u.AddToCart:return"add_to_cart";case u.RemoveFromCart:return"remove_from_cart";case u.Checkout:return"checkout";case u.CheckoutOption:return"checkout_option";case u.Click:return"click";case u.ViewDetail:return"view_detail";case u.Purchase:return"purchase";case u.Refund:return"refund";case u.AddToWishlist:return"add_to_wishlist";case u.RemoveFromWishlist:return"remove_from_wishlist";default:return"unknown"}};tt={Unknown:0,PromotionView:1,PromotionClick:2};tt.getName=function(n){switch(n){case tt.PromotionView:return"view";case tt.PromotionClick:return"click";default:return"unknown"}};tt.getExpansionName=function(n){switch(n){case tt.PromotionView:return"view";case tt.PromotionClick:return"click";default:return"unknown"}};var n={MessageType:hi,EventType:d,CommerceEventType:s,IdentityType:i,ProfileMessageType:{Logout:3},ApplicationTransitionType:{AppInit:1},ProductActionType:u,PromotionActionType:tt,TriggerUploadType:br},t={sdkVersion:"2.11.15",sdkVendor:"mparticle",platform:"web",Messages:{ErrorMessages:{NoToken:"A token must be specified.",EventNameInvalidType:"Event name must be a valid string value.",EventDataInvalidType:"Event data must be a valid object hash.",LoggingDisabled:"Event logging is currently disabled.",CookieParseError:"Could not parse cookie",EventEmpty:"Event object is null or undefined, cancelling send",APIRequestEmpty:"APIRequest is null or undefined, cancelling send",NoEventType:"Event type must be specified.",TransactionIdRequired:"Transaction ID is required",TransactionRequired:"A transaction attributes object is required",PromotionIdRequired:"Promotion ID is required",BadAttribute:"Attribute value cannot be object or array",BadKey:"Key value cannot be object or array",BadLogPurchase:"Transaction attributes and a product are both required to log a purchase, https://docs.mparticle.com/?javascript#measuring-transactions"},InformationMessages:{CookieSearch:"Searching for cookie",CookieFound:"Cookie found, parsing values",CookieNotFound:"Cookies not found",CookieSet:"Setting cookie",CookieSync:"Performing cookie sync",SendBegin:"Starting to send event",SendIdentityBegin:"Starting to send event to identity server",SendWindowsPhone:"Sending event to Windows Phone container",SendIOS:"Calling iOS path: ",SendAndroid:"Calling Android JS interface method: ",SendHttp:"Sending event to mParticle HTTP service",SendAliasHttp:"Sending alias request to mParticle HTTP service",SendIdentityHttp:"Sending event to mParticle HTTP service",StartingNewSession:"Starting new Session",StartingLogEvent:"Starting to log event",StartingLogOptOut:"Starting to log user opt in/out",StartingEndSession:"Starting to end session",StartingInitialization:"Starting to initialize",StartingLogCommerceEvent:"Starting to log commerce event",StartingAliasRequest:"Starting to Alias MPIDs",LoadingConfig:"Loading configuration options",AbandonLogEvent:"Cannot log event, logging disabled or developer token not set",AbandonAliasUsers:"Cannot Alias Users, logging disabled or developer token not set",AbandonStartSession:"Cannot start session, logging disabled or developer token not set",AbandonEndSession:"Cannot end session, logging disabled or developer token not set",NoSessionToEnd:"Cannot end session, no active session found"},ValidationMessages:{ModifyIdentityRequestUserIdentitiesPresent:"identityRequests to modify require userIdentities to be present. Request not sent to server. Please fix and try again",IdentityRequesetInvalidKey:"There is an invalid key on your identityRequest object. It can only contain a `userIdentities` object and a `onUserAlias` function. Request not sent to server. Please fix and try again.",OnUserAliasType:"The onUserAlias value must be a function. The onUserAlias provided is of type",UserIdentities:"The userIdentities key must be an object with keys of identityTypes and values of strings. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidKey:"There is an invalid identity key on your `userIdentities` object within the identityRequest. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidValues:"All user identity values must be strings or null. Request not sent to server. Please fix and try again.",AliasMissingMpid:"Alias Request must contain both a destinationMpid and a sourceMpid",AliasNonUniqueMpid:"Alias Request's destinationMpid and sourceMpid must be unique",AliasMissingTime:"Alias Request must have both a startTime and an endTime",AliasStartBeforeEndTime:"Alias Request's endTime must be later than its startTime"}},NativeSdkPaths:{LogEvent:"logEvent",SetUserTag:"setUserTag",RemoveUserTag:"removeUserTag",SetUserAttribute:"setUserAttribute",RemoveUserAttribute:"removeUserAttribute",SetSessionAttribute:"setSessionAttribute",AddToCart:"addToCart",RemoveFromCart:"removeFromCart",ClearCart:"clearCart",LogOut:"logOut",SetUserAttributeList:"setUserAttributeList",RemoveAllUserAttributes:"removeAllUserAttributes",GetUserAttributesLists:"getUserAttributesLists",GetAllUserAttributes:"getAllUserAttributes",Identify:"identify",Logout:"logout",Login:"login",Modify:"modify",Alias:"aliasUsers",Upload:"upload"},StorageNames:{localStorageName:"mprtcl-api",localStorageNameV3:"mprtcl-v3",cookieName:"mprtcl-api",cookieNameV2:"mprtcl-v2",cookieNameV3:"mprtcl-v3",localStorageNameV4:"mprtcl-v4",localStorageProductsV4:"mprtcl-prodv4",cookieNameV4:"mprtcl-v4",currentStorageName:"mprtcl-v4",currentStorageProductsName:"mprtcl-prodv4"},DefaultConfig:{cookieDomain:null,cookieExpiration:365,logLevel:null,timeout:300,sessionTimeout:30,maxProducts:20,forwarderStatsTimeout:5e3,integrationDelayTimeout:5e3,maxCookieSize:3e3,aliasMaxWindow:90,uploadInterval:0},DefaultUrls:{v1SecureServiceUrl:"jssdks.mparticle.com/v1/JS/",v2SecureServiceUrl:"jssdks.mparticle.com/v2/JS/",v3SecureServiceUrl:"jssdks.mparticle.com/v3/JS/",configUrl:"jssdkcdns.mparticle.com/JS/v2/",identityUrl:"identity.mparticle.com/v1/",aliasUrl:"jssdks.mparticle.com/v1/identity/"},Base64CookieKeys:{csm:1,sa:1,ss:1,ua:1,ui:1,csd:1,ia:1,con:1},SDKv2NonMPIDCookieKeys:{gs:1,cu:1,l:1,globalSettings:1,currentUserMPID:1},HTTPCodes:{noHttpCoverage:-1,activeIdentityRequest:-2,activeSession:-3,validationIssue:-4,nativeIdentityRequest:-5,loggingDisabledOrMissingAPIKey:-6,tooManyRequests:429},FeatureFlags:{ReportBatching:"reportBatching",EventsV3:"eventsV3",EventBatchingIntervalMillis:"eventBatchingIntervalMillis"},DefaultInstance:"default_instance"},kr=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};h=ft(function(n){function t(i){"@babel/helpers - typeof";return n.exports=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(n){return typeof n}:t=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t(i)}n.exports=t});ci=ft(function(n){function t(i,r){return n.exports=t=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},t(i,r)}n.exports=t});ni=gr;li=nu;var iu=tu,ai=ft(function(n){function t(i){return n.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},t(i)}n.exports=t}),ru=ft(function(n){var t=function(n){function nt(n,t,i,r){var f=t&&t.prototype instanceof w?t:w,u=Object.create(f.prototype),e=new k(r||[]);return u._invoke=st(n,i,e),u}function p(n,t,i){try{return{type:"normal",arg:n.call(t,i)}}catch(r){return{type:"throw",arg:r}}}function w(){}function c(){}function f(){}function rt(n){["next","throw","return"].forEach(function(t){n[t]=function(n){return this._invoke(t,n)}})}function v(n,t){function i(u,f,e,o){var c=p(n[u],n,f),h,s;if(c.type==="throw")o(c.arg);else return(h=c.arg,s=h.value,s&&typeof s=="object"&&r.call(s,"__await"))?t.resolve(s.__await).then(function(n){i("next",n,e,o)},function(n){i("throw",n,e,o)}):t.resolve(s).then(function(n){h.value=n;e(h)},function(n){return i("throw",n,e,o)})}function f(n,r){function f(){return new t(function(t,u){i(n,r,t,u)})}return u=u?u.then(f,f):f()}var u;this._invoke=f}function st(n,i,r){var u=tt;return function(f,e){var c,s,o;if(u===it)throw new Error("Generator is already running");if(u===h){if(f==="throw")throw e;return ft()}for(r.method=f,r.arg=e;;){if(c=r.delegate,c&&(s=ut(c,r),s)){if(s===t)continue;return s}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(u===tt){u=h;throw r.arg;}r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);if(u=it,o=p(n,i,r),o.type==="normal"){if(u=r.done?h:ot,o.arg===t)continue;return{value:o.arg,done:r.done}}o.type==="throw"&&(u=h,r.method="throw",r.arg=o.arg)}}}function ut(n,r){var e=n.iterator[r.method],f,u;if(e===i){if(r.delegate=null,r.method==="throw"){if(n.iterator["return"]&&(r.method="return",r.arg=i,ut(n,r),r.method==="throw"))return t;r.method="throw";r.arg=new TypeError("The iterator does not provide a 'throw' method")}return t}if(f=p(e,n.iterator,r.arg),f.type==="throw")return r.method="throw",r.arg=f.arg,r.delegate=null,t;if(u=f.arg,!u)return r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,t;if(u.done)r[n.resultName]=u.value,r.next=n.nextLoc,r.method!=="return"&&(r.method="next",r.arg=i);else return u;return r.delegate=null,t}function ht(n){var t={tryLoc:n[0]};1 in n&&(t.catchLoc=n[1]);2 in n&&(t.finallyLoc=n[2],t.afterLoc=n[3]);this.tryEntries.push(t)}function b(n){var t=n.completion||{};t.type="normal";delete t.arg;n.completion=t}function k(n){this.tryEntries=[{tryLoc:"root"}];n.forEach(ht,this);this.reset(!0)}function d(n){var f,u,t;if(n){if(f=n[o],f)return f.call(n);if(typeof n.next=="function")return n;if(!isNaN(n.length))return u=-1,t=function t(){while(++u<n.length)if(r.call(n,u))return t.value=n[u],t.done=!1,t;return t.value=i,t.done=!0,t},t.next=t}return{next:ft}}function ft(){return{value:i,done:!0}}var g=Object.prototype,r=g.hasOwnProperty,i,y=typeof Symbol=="function"?Symbol:{},o=y.iterator||"@@iterator",et=y.asyncIterator||"@@asyncIterator",s=y.toStringTag||"@@toStringTag",l,a,e,u;n.wrap=nt;var tt="suspendedStart",ot="suspendedYield",it="executing",h="completed",t={};return l={},l[o]=function(){return this},a=Object.getPrototypeOf,e=a&&a(a(d([]))),e&&e!==g&&r.call(e,o)&&(l=e),u=f.prototype=w.prototype=Object.create(l),c.prototype=u.constructor=f,f.constructor=c,f[s]=c.displayName="GeneratorFunction",n.isGeneratorFunction=function(n){var t=typeof n=="function"&&n.constructor;return t?t===c||(t.displayName||t.name)==="GeneratorFunction":!1},n.mark=function(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,f):(n.__proto__=f,s in n||(n[s]="GeneratorFunction")),n.prototype=Object.create(u),n},n.awrap=function(n){return{__await:n}},rt(v.prototype),v.prototype[et]=function(){return this},n.AsyncIterator=v,n.async=function(t,i,r,u,f){f===void 0&&(f=Promise);var e=new v(nt(t,i,r,u),f);return n.isGeneratorFunction(i)?e:e.next().then(function(n){return n.done?n.value:e.next()})},rt(u),u[s]="Generator",u[o]=function(){return this},u.toString=function(){return"[object Generator]"},n.keys=function(n){var i=[];for(var r in n)i.push(r);return i.reverse(),function t(){while(i.length){var r=i.pop();if(r in n)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=d,k.prototype={constructor:k,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(b),!n)for(var t in this)t.charAt(0)==="t"&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=i)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if(n.type==="throw")throw n.arg;return this.rval},dispatchException:function(n){function u(t,r){return o.type="throw",o.arg=n,f.next=t,r&&(f.method="next",f.arg=i),!!r}var f,e,t,o,s,h;if(this.done)throw n;for(f=this,e=this.tryEntries.length-1;e>=0;--e){if(t=this.tryEntries[e],o=t.completion,t.tryLoc==="root")return u("end");if(t.tryLoc<=this.prev)if(s=r.call(t,"catchLoc"),h=r.call(t,"finallyLoc"),s&&h){if(this.prev<t.catchLoc)return u(t.catchLoc,!0);if(this.prev<t.finallyLoc)return u(t.finallyLoc)}else if(s){if(this.prev<t.catchLoc)return u(t.catchLoc,!0)}else if(h){if(this.prev<t.finallyLoc)return u(t.finallyLoc)}else throw new Error("try statement without catch or finally");}},abrupt:function(n,i){for(var f,u,o,e=this.tryEntries.length-1;e>=0;--e)if(f=this.tryEntries[e],f.tryLoc<=this.prev&&r.call(f,"finallyLoc")&&this.prev<f.finallyLoc){u=f;break}return(u&&(n==="break"||n==="continue")&&u.tryLoc<=i&&i<=u.finallyLoc&&(u=null),o=u?u.completion:{},o.type=n,o.arg=i,u)?(this.method="next",this.next=u.finallyLoc,t):this.complete(o)},complete:function(n,i){if(n.type==="throw")throw n.arg;return n.type==="break"||n.type==="continue"?this.next=n.arg:n.type==="return"?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):n.type==="normal"&&i&&(this.next=i),t},finish:function(n){for(var i,r=this.tryEntries.length-1;r>=0;--r)if(i=this.tryEntries[r],i.finallyLoc===n)return this.complete(i.completion,i.afterLoc),b(i),t},"catch":function(n){for(var i,r,u,t=this.tryEntries.length-1;t>=0;--t)if(i=this.tryEntries[t],i.tryLoc===n)return r=i.completion,r.type==="throw"&&(u=r.arg,b(i)),u;throw new Error("illegal catch attempt");},delegateYield:function(n,r,u){return this.delegate={iterator:d(n),resultName:r,nextLoc:u},this.method==="next"&&(this.arg=i),t}},n}(n.exports);try{regeneratorRuntime=t}catch(i){Function("r","regeneratorRuntime = r")(t)}}),p=ru;wt=uu;vi=fu;yi=eu;pi=ou;wi=su;ti=hu;et=cu;ot=lu;lt=au,function(n){n[n.Unknown=0]="Unknown";n[n.AddToCart=1]="AddToCart";n[n.RemoveFromCart=2]="RemoveFromCart";n[n.Checkout=3]="Checkout";n[n.CheckoutOption=4]="CheckoutOption";n[n.Click=5]="Click";n[n.ViewDetail=6]="ViewDetail";n[n.Purchase=7]="Purchase";n[n.Refund=8]="Refund";n[n.AddToWishlist=9]="AddToWishlist";n[n.RemoveFromWishlist=10]="RemoveFromWishlist"}(a||(a={}));r=ft(function(n,t){var i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt;Object.defineProperty(t,"__esModule",{value:!0}),function(n){n.unknown="Unknown";n.iOS="IOS";n.android="Android";n.windowsPhone="WindowsPhone";n.mobileWeb="MobileWeb";n.unityIOS="UnityIOS";n.unityAndroid="UnityAndroid";n.desktop="Desktop";n.tvOS="TVOS";n.roku="Roku";n.outOfBand="OutOfBand";n.alexa="Alexa";n.smartTV="SmartTV";n.fireTV="FireTV";n.xbox="Xbox"}(i=t.ApplicationInformationOsEnum||(t.ApplicationInformationOsEnum={})),function(n){n.applicationStateTransition="application_state_transition"}(r=t.ApplicationStateTransitionEventEventTypeEnum||(t.ApplicationStateTransitionEventEventTypeEnum={})),function(n){n.applicationInitialized="application_initialized";n.applicationExit="application_exit";n.applicationBackground="application_background";n.applicationForeground="application_foreground"}(u=t.ApplicationStateTransitionEventDataApplicationTransitionTypeEnum||(t.ApplicationStateTransitionEventDataApplicationTransitionTypeEnum={})),function(n){n.unknown="unknown";n.development="development";n.production="production"}(f=t.BatchEnvironmentEnum||(t.BatchEnvironmentEnum={})),function(n){n.breadcrumb="breadcrumb"}(e=t.BreadcrumbEventEventTypeEnum||(t.BreadcrumbEventEventTypeEnum={})),function(n){n.commerceEvent="commerce_event"}(o=t.CommerceEventEventTypeEnum||(t.CommerceEventEventTypeEnum={})),function(n){n.addToCart="add_to_cart";n.removeFromCart="remove_from_cart";n.checkout="checkout";n.checkoutOption="checkout_option";n.click="click";n.viewDetail="view_detail";n.purchase="purchase";n.refund="refund";n.promotionView="promotion_view";n.promotionClick="promotion_click";n.addToWishlist="add_to_wishlist";n.removeFromWishlist="remove_from_wishlist";n.impression="impression"}(s=t.CommerceEventDataCustomEventTypeEnum||(t.CommerceEventDataCustomEventTypeEnum={})),function(n){n.crashReport="crash_report"}(h=t.CrashReportEventEventTypeEnum||(t.CrashReportEventEventTypeEnum={})),function(n){n.customEvent="custom_event"}(c=t.CustomEventEventTypeEnum||(t.CustomEventEventTypeEnum={})),function(n){n.navigation="navigation";n.location="location";n.search="search";n.transaction="transaction";n.userContent="user_content";n.userPreference="user_preference";n.social="social";n.other="other";n.unknown="unknown"}(l=t.CustomEventDataCustomEventTypeEnum||(t.CustomEventDataCustomEventTypeEnum={})),function(n){n.portrait="portrait";n.portraitUpsideDown="portrait_upside_down";n.landscape="landscape";n.landscapeLeft="LandscapeLeft";n.landscapeRight="LandscapeRight";n.faceUp="FaceUp";n.faceDown="FaceDown";n.square="Square"}(a=t.DeviceCurrentStateDeviceOrientationEnum||(t.DeviceCurrentStateDeviceOrientationEnum={})),function(n){n.portrait="portrait";n.portraitUpsideDown="portrait_upside_down";n.landscape="landscape";n.landscapeLeft="LandscapeLeft";n.landscapeRight="LandscapeRight";n.faceUp="FaceUp";n.faceDown="FaceDown";n.square="Square"}(v=t.DeviceCurrentStateStatusBarOrientationEnum||(t.DeviceCurrentStateStatusBarOrientationEnum={})),function(n){n.iOS="iOS";n.android="Android";n.web="web";n.desktop="desktop";n.tvOS="tvOS";n.roku="roku";n.outOfBand="out_of_band";n.smartTV="smart_tv";n.xbox="xbox"}(y=t.DeviceInformationPlatformEnum||(t.DeviceInformationPlatformEnum={})),function(n){n.unknown="unknown";n.sessionStart="session_start";n.sessionEnd="session_end";n.screenView="screen_view";n.customEvent="custom_event";n.crashReport="crash_report";n.optOut="opt_out";n.firstRun="first_run";n.preAttribution="pre_attribution";n.pushRegistration="push_registration";n.applicationStateTransition="application_state_transition";n.pushMessage="push_message";n.networkPerformance="network_performance";n.breadcrumb="breadcrumb";n.profile="profile";n.pushReaction="push_reaction";n.commerceEvent="commerce_event";n.userAttributeChange="user_attribute_change";n.userIdentityChange="user_identity_change";n.uninstall="uninstall";n.validationResult="validation_result"}(p=t.EventTypeEnum||(t.EventTypeEnum={})),function(n){n.other="other";n.customerId="customer_id";n.facebook="facebook";n.twitter="twitter";n.google="google";n.microsoft="microsoft";n.yahoo="yahoo";n.email="email";n.alias="alias";n.facebookCustomAudienceId="facebook_custom_audience_id";n.otherId2="other_id_2";n.otherId3="other_id_3";n.otherId4="other_id_4";n.otherId5="other_id_5";n.otherId6="other_id_6";n.otherId7="other_id_7";n.otherId8="other_id_8";n.otherId9="other_id_9";n.otherId10="other_id_10";n.mobileNumber="mobile_number";n.phoneNumber2="phone_number_2";n.phoneNumber3="phone_number_3"}(w=t.IdentityTypeEnum||(t.IdentityTypeEnum={})),function(n){n.networkPerformance="network_performance"}(b=t.NetworkPerformanceEventEventTypeEnum||(t.NetworkPerformanceEventEventTypeEnum={})),function(n){n.optOut="opt_out"}(k=t.OptOutEventEnum||(t.OptOutEventEnum={})),function(n){n.unknown="unknown";n.addToCart="add_to_cart";n.removeFromCart="remove_from_cart";n.checkout="checkout";n.checkoutOption="checkout_option";n.click="click";n.viewDetail="view_detail";n.purchase="purchase";n.refund="refund";n.addToWishlist="add_to_wishlist";n.removeFromWishlist="remove_from_wish_list"}(d=t.ProductActionActionEnum||(t.ProductActionActionEnum={})),function(n){n.profile="profile"}(g=t.ProfileEventEventTypeEnum||(t.ProfileEventEventTypeEnum={})),function(n){n.signup="signup";n.login="login";n.logout="logout";n.update="update";n["delete"]="delete"}(nt=t.ProfileEventDataProfileEventTypeEnum||(t.ProfileEventDataProfileEventTypeEnum={})),function(n){n.view="view";n.click="click"}(tt=t.PromotionActionActionEnum||(t.PromotionActionActionEnum={})),function(n){n.pushMessage="push_message"}(it=t.PushMessageEventEventTypeEnum||(t.PushMessageEventEventTypeEnum={})),function(n){n.sent="sent";n.received="received";n.action="action"}(rt=t.PushMessageEventDataPushMessageTypeEnum||(t.PushMessageEventDataPushMessageTypeEnum={})),function(n){n.notRunning="not_running";n.background="background";n.foreground="foreground"}(ut=t.PushMessageEventDataApplicationStateEnum||(t.PushMessageEventDataApplicationStateEnum={})),function(n){n.received="Received";n.directOpen="DirectOpen";n.read="Read";n.influencedOpen="InfluencedOpen";n.displayed="Displayed"}(ft=t.PushMessageEventDataPushMessageBehaviorEnum||(t.PushMessageEventDataPushMessageBehaviorEnum={})),function(n){n.pushRegistration="push_registration"}(et=t.PushRegistrationEventEventTypeEnum||(t.PushRegistrationEventEventTypeEnum={})),function(n){n.sessionEnd="session_end"}(ot=t.SessionEndEventEventTypeEnum||(t.SessionEndEventEventTypeEnum={})),function(n){n.sessionStart="session_start"}(st=t.SessionStartEventEventTypeEnum||(t.SessionStartEventEventTypeEnum={})),function(n){n["native"]="native";n.javascript="javascript";n.pixel="pixel";n.desktop="desktop";n.partner="partner";n.serverToServer="server_to_server"}(ht=t.SourceInformationChannelEnum||(t.SourceInformationChannelEnum={})),function(n){n.userAttributeChange="user_attribute_change"}(ct=t.UserAttributeChangeEventEventTypeEnum||(t.UserAttributeChangeEventEventTypeEnum={})),function(n){n.userIdentityChange="user_identity_change"}(lt=t.UserIdentityChangeEventEventTypeEnum||(t.UserIdentityChangeEventEventTypeEnum={}))});dr(r);var vo=r.ApplicationInformationOsEnum,yo=r.ApplicationStateTransitionEventEventTypeEnum,vu=r.ApplicationStateTransitionEventDataApplicationTransitionTypeEnum,di=r.BatchEnvironmentEnum,po=r.BreadcrumbEventEventTypeEnum,wo=r.CommerceEventEventTypeEnum,c=r.CommerceEventDataCustomEventTypeEnum,bo=r.CrashReportEventEventTypeEnum,ko=r.CustomEventEventTypeEnum,g=r.CustomEventDataCustomEventTypeEnum,go=r.DeviceCurrentStateDeviceOrientationEnum,ns=r.DeviceCurrentStateStatusBarOrientationEnum,yu=r.DeviceInformationPlatformEnum,w=r.EventTypeEnum,ts=r.IdentityTypeEnum,is=r.NetworkPerformanceEventEventTypeEnum,rs=r.OptOutEventEnum,v=r.ProductActionActionEnum,us=r.ProfileEventEventTypeEnum,fs=r.ProfileEventDataProfileEventTypeEnum,es=r.PromotionActionActionEnum,os=r.PushMessageEventEventTypeEnum,ss=r.PushMessageEventDataPushMessageTypeEnum,hs=r.PushMessageEventDataApplicationStateEnum,cs=r.PushMessageEventDataPushMessageBehaviorEnum,ls=r.PushRegistrationEventEventTypeEnum,as=r.SessionEndEventEventTypeEnum,vs=r.SessionStartEventEventTypeEnum,ys=r.SourceInformationChannelEnum,ps=r.UserAttributeChangeEventEventTypeEnum,ws=r.UserIdentityChangeEventEventTypeEnum;bt=function(){function t(n,i){var u=this;ot(this,t);l(this,"uploadIntervalMillis",void 0);l(this,"pendingEvents",void 0);l(this,"pendingUploads",void 0);l(this,"mpInstance",void 0);l(this,"uploadUrl",void 0);l(this,"batchingEnabled",void 0);this.mpInstance=n;this.uploadIntervalMillis=i;this.batchingEnabled=i>=t.MINIMUM_INTERVAL_MILLIS;this.uploadIntervalMillis<t.MINIMUM_INTERVAL_MILLIS&&(this.uploadIntervalMillis=t.MINIMUM_INTERVAL_MILLIS);this.pendingEvents=[];this.pendingUploads=[];var r=this.mpInstance._Store,f=r.SDKConfig,e=r.devToken,o=this.mpInstance._Helpers.createServiceUrl(f.v3SecureServiceUrl,e);this.uploadUrl="".concat(o,"/events");setTimeout(function(){u.prepareAndUpload(!0,!1)},this.uploadIntervalMillis);this.addEventListeners()}return lt(t,[{key:"addEventListeners",value:function(){var n=this;window.onbeforeunload=function(){n.prepareAndUpload(!1,n.isBeaconAvailable())};window.onpagehide=function(){n.prepareAndUpload(!1,n.isBeaconAvailable())}}},{key:"isBeaconAvailable",value:function(){return navigator.sendBeacon?!0:!1}},{key:"queueEvent",value:function(t){t&&(t.IsFirstRun=this.mpInstance._Store.isFirstRun,this.pendingEvents.push(t),this.mpInstance.Logger.verbose("Queuing event: ".concat(JSON.stringify(t))),this.mpInstance.Logger.verbose("Queued event count: ".concat(this.pendingEvents.length)),(!this.batchingEnabled||n.TriggerUploadType[t.EventDataType])&&this.prepareAndUpload(!1,!1))}},{key:"prepareAndUpload",value:function(){function r(){return n.apply(this,arguments)}var n=et(p.mark(function i(n,r){var l=this,e,o,u,s,h,f,c;return p.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return e=this.mpInstance.Identity.getCurrentUser(),o=this.pendingEvents,this.pendingEvents=[],u=t.createNewUploads(o,e,this.mpInstance),u&&u.length&&(s=this.pendingUploads).push.apply(s,ti(u)),h=this.pendingUploads,this.pendingUploads=[],i.next=9,this.upload(this.mpInstance.Logger,h,r);case 9:f=i.sent;f&&f.length&&(c=this.pendingUploads).unshift.apply(c,ti(f));n&&setTimeout(function(){l.prepareAndUpload(!0,!1)},this.uploadIntervalMillis);case 12:case"end":return i.stop()}},i,this)}));return r}()},{key:"upload",value:function(){function r(){return n.apply(this,arguments)}var n=et(p.mark(function i(n,r,u){var o,f,s,h,e;return p.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(!r||r.length<1)){i.next=2;break}return i.abrupt("return",null);case 2:n.verbose("Uploading batches: ".concat(JSON.stringify(r)));n.verbose("Batch count: ".concat(r.length));f=0;case 5:if(!(f<r.length)){i.next=38;break}if(s={method:"POST",headers:{Accept:t.CONTENT_TYPE,"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify(r[f])},!(u&&this.isBeaconAvailable())){i.next=12;break}h=new Blob([s.body],{type:"text/plain;charset=UTF-8"});navigator.sendBeacon(this.uploadUrl,h);i.next=35;break;case 12:return o||(o=window.fetch?new ne(this.uploadUrl,n):new te(this.uploadUrl,n)),i.prev=13,i.next=16,o.upload(s,r,f);case 16:if(e=i.sent,!(e.status>=200&&e.status<300)){i.next=21;break}n.verbose("Upload success for request ID: ".concat(r[f].source_request_id));i.next=29;break;case 21:if(!(e.status>=500||e.status===429)){i.next=26;break}return n.error("HTTP error status ".concat(e.status," received")),i.abrupt("return",r.slice(f,r.length));case 26:if(!(e.status>=401)){i.next=29;break}return n.error("HTTP error status ".concat(e.status," while uploading - please verify your API key.")),i.abrupt("return",null);case 29:i.next=35;break;case 31:return i.prev=31,i.t0=i["catch"](13),n.error("Error sending event to mParticle servers. ".concat(i.t0)),i.abrupt("return",r.slice(f,r.length));case 35:f++;i.next=5;break;case 38:return i.abrupt("return",null);case 39:case"end":return i.stop()}},i,this,[[13,31]])}));return r}()}],[{key:"createNewUploads",value:function(n,t,i){var r,k,u,o,a,h,f,c,y,tt,p;if(!t||!n||!n.length)return null;var w=[],l=new Map,e=ur(n),b;try{for(e.s();!(b=e.n()).done;)r=b.value,r.MPID||(k=t.getMPID(),r.MPID=k),u=l.get(r.MPID),u||(u=[]),u.push(r),l.set(r.MPID,u)}catch(d){e.e(d)}finally{e.f()}for(o=0,a=Array.from(l.entries());o<a.length;o++){var g=a[o],it=g[0],rt=g[1],v=new Map,s=ur(rt),nt;try{for(s.s();!(nt=s.n()).done;)h=nt.value,f=v.get(h.SessionId),f||(f=[]),f.push(h),v.set(h.SessionId,f)}catch(d){s.e(d)}finally{s.f()}for(c=0,y=Array.from(v.entries());c<y.length;c++)tt=y[c],p=ir(it,tt[1],i),p&&w.push(p)}return w}}]),t}();l(bt,"CONTENT_TYPE","text/plain;charset=UTF-8");l(bt,"MINIMUM_INTERVAL_MILLIS",500);var ri=function ri(n,t){ot(this,ri);l(this,"url",void 0);l(this,"logger",void 0);this.url=n;this.logger=t},ne=function(n){function t(){return ot(this,t),i.apply(this,arguments)}ni(t,n);var i=rr(t);return lt(t,[{key:"upload",value:function(){function i(){return n.apply(this,arguments)}var n=et(p.mark(function t(n){var i;return p.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(this.url,n);case 2:return i=t.sent,t.abrupt("return",i);case 4:case"end":return t.stop()}},t,this)}));return i}()}]),t}(ri),te=function(n){function t(){return ot(this,t),i.apply(this,arguments)}ni(t,n);var i=rr(t);return lt(t,[{key:"upload",value:function(){function i(){return n.apply(this,arguments)}var n=et(p.mark(function t(n){var i;return p.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.makeRequest(this.url,this.logger,n.body);case 2:return i=t.sent,t.abrupt("return",i);case 4:case"end":return t.stop()}},t,this)}));return i}()},{key:"makeRequest",value:function(){function i(){return n.apply(this,arguments)}var n=et(p.mark(function t(n,i,r){var u;return p.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u=new XMLHttpRequest,t.abrupt("return",new Promise(function(t,i){u.onreadystatechange=function(){u.readyState===4&&(u.status>=200&&u.status<300?t(u):i(u))};u.open("post",n);u.send(r)}));case 2:case"end":return t.stop()}},t)}));return i}()}]),t}(ri),ui=t.HTTPCodes,st=t.Messages;var re=ft(function(n){(function(t,i,r){n.exports=r();n.exports["default"]=r()})("slugify",kr,function(){function t(t,r){if(typeof t!="string")throw new Error("slugify: string argument expected");r=typeof r=="string"?{replacement:r}:r||{};var e=i[r.locale]||{},f=r.replacement||"-",u=t.split("").reduce(function(t,i){return t+(e[i]||n[i]||i)},"").replace(r.remove||/[^\w\s$*_+~.()'"!\-:@]+/g,"").trim().replace(new RegExp("[\\s"+f+"]+","g"),f);return r.lower&&(u=u.toLowerCase()),r.strict&&(u=u.replace(new RegExp("[^a-zA-Z0-9"+f+"]","g"),"")),u}var n=JSON.parse('{"$":"dollar","%":"percent","&":"and","<":"less",">":"greater","|":"or","":"cent","":"pound","":"currency","":"yen","":"(c)","":"a","":"(r)","":"o","":"A","":"A","":"A","":"A","":"A","":"A","":"AE","":"C","":"E","":"E","":"E","":"E","":"I","":"I","":"I","":"I","":"D","":"N","":"O","":"O","":"O","":"O","":"O","":"O","":"U","":"U","":"U","":"U","":"Y","":"TH","":"ss","":"a","":"a","":"a","":"a","":"a","":"a","":"ae","":"c","":"e","":"e","":"e","":"e","":"i","":"i","":"i","":"i","":"d","":"n","":"o","":"o","":"o","":"o","":"o","":"o","":"u","":"u","":"u","":"u","":"y","":"th","":"y","":"A","":"a","":"A","":"a","":"A","":"a","":"C","":"c","":"C","":"c","":"D","":"d","":"DJ","":"dj","":"E","":"e","":"E","":"e","":"e","":"e","":"E","":"e","":"G","":"g","":"G","":"g","":"I","":"i","":"i","":"i","":"I","":"i","":"I","":"i","":"k","":"k","":"L","":"l","":"L","":"l","":"L","":"l","":"N","":"n","":"N","":"n","":"N","":"n","":"O","":"o","":"OE","":"oe","":"R","":"r","":"R","":"r","":"S","":"s","":"S","":"s","":"S","":"s","":"T","":"t","":"T","":"t","":"U","":"u","":"u","":"u","":"U","":"u","":"U","":"u","":"U","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"z","":"Z","":"z","":"Z","":"z","":"f","":"O","":"o","":"U","":"u","":"LJ","":"lj","":"NJ","":"nj","":"S","":"s","":"T","":"t","":"o","":"A","":"E","":"H","":"I","":"O","":"Y","":"W","":"i","":"A","":"B","":"G","":"D","":"E","":"Z","":"H","":"8","":"I","":"K","":"L","":"M","":"N","":"3","":"O","":"P","":"R","":"S","":"T","":"Y","":"F","":"X","":"PS","":"W","":"I","":"Y","":"a","":"e","":"h","":"i","":"y","":"a","":"b","":"g","":"d","":"e","":"z","":"h","":"8","":"i","":"k","":"l","":"m","":"n","":"3","":"o","":"p","":"r","":"s","":"s","":"t","":"y","":"f","":"x","":"ps","":"w","":"i","":"y","":"o","":"y","":"w","":"Yo","":"DJ","":"Ye","":"I","":"Yi","":"J","":"LJ","":"NJ","":"C","":"DZ","":"A","":"B","":"V","":"G","":"D","":"E","":"Zh","":"Z","":"I","":"J","":"K","":"L","":"M","":"N","":"O","":"P","":"R","":"S","":"T","":"U","":"F","":"H","":"C","":"Ch","":"Sh","":"Sh","":"U","":"Y","":"","":"E","":"Yu","":"Ya","":"a","":"b","":"v","":"g","":"d","":"e","":"zh","":"z","":"i","":"j","":"k","":"l","":"m","":"n","":"o","":"p","":"r","":"s","":"t","":"u","":"f","":"h","":"c","":"ch","":"sh","":"sh","":"u","":"y","":"","":"e","":"yu","":"ya","":"yo","":"dj","":"ye","":"i","":"yi","":"j","":"lj","":"nj","":"c","":"u","":"dz","":"G","":"g","":"GH","":"gh","":"KH","":"kh","":"NG","":"ng","":"UE","":"ue","":"U","":"u","":"H","":"h","":"AE","":"ae","":"OE","":"oe","":"baht","":"a","":"b","":"g","":"d","":"e","":"v","":"z","":"t","":"i","":"k","":"l","":"m","":"n","":"o","":"p","":"zh","":"r","":"s","":"t","":"u","":"f","":"k","":"gh","":"q","":"sh","":"ch","":"ts","":"dz","":"ts","":"ch","":"kh","":"j","":"h","":"W","":"w","":"W","":"w","":"W","":"w","":"SS","":"A","":"a","":"A","":"a","":"A","":"a","":"A","":"a","":"A","":"a","":"A","":"a","":"A","":"a","":"A","":"a","":"A","":"a","":"A","":"a","":"A","":"a","":"A","":"a","":"E","":"e","":"E","":"e","":"E","":"e","":"E","":"e","":"E","":"e","":"E","":"e","":"E","":"e","":"E","":"e","":"I","":"i","":"I","":"i","":"O","":"o","":"O","":"o","":"O","":"o","":"O","":"o","":"O","":"o","":"O","":"o","":"O","":"o","":"O","":"o","":"O","":"o","":"O","":"o","":"O","":"o","":"O","":"o","":"U","":"u","":"U","":"u","":"U","":"u","":"U","":"u","":"U","":"u","":"U","":"u","":"U","":"u","":"Y","":"y","":"Y","":"y","":"Y","":"y","":"Y","":"y","":"\'","":"\'","":"\\"","":"\\"","":"+","":"*","":"...","":"ecu","":"cruzeiro","":"french franc","":"lira","":"mill","":"naira","":"peseta","":"rupee","":"won","":"new shequel","":"dong","":"euro","":"kip","":"tugrik","":"drachma","":"penny","":"peso","":"guarani","":"austral","":"hryvnia","":"cedi","":"kazakhstani tenge","":"indian rupee","":"russian ruble","":"bitcoin","":"sm","":"tm","":"d","":"delta","":"sum","":"infinity","":"love","":"yuan","":"yen","":"rial"}'),i=JSON.parse('{"vi":{"":"D","":"d"}}');return t.extend=function(t){for(var i in t)n[i]=t[i]},t})}),kt=t.StorageNames,ue=/\+/g;var vt=t.Messages,er="mParticleAndroid",fi="mParticle";or=t.Messages;ht=t.Messages;yt=t.Messages;var k=ut.Base64,ct=t.Messages,dt=t.Base64CookieKeys,pt=t.SDKv2NonMPIDCookieKeys,it=t.StorageNames;rt=t.Messages;var o=t.StorageNames,ei=ut.Base64,pe={das:1},we={ui:1};return gt=n.MessageType,cr=n.ApplicationTransitionType,f=t.Messages,e=t.HTTPCodes,nt=t.Messages,ar=t.HTTPCodes,pr=function(){function n(){ot(this,n)}return lt(n,[{key:"getMPInstance",value:function(){return{_Helpers:{sanitizeAttributes:window.mParticle.getInstance()._Helpers.sanitizeAttributes,generateUniqueId:function(){return"mockId"},extend:window.mParticle.getInstance()._Helpers.extend},_Store:{sessionId:"mockSessionId",SDKConfig:{}},Identity:{getCurrentUser:function(){return null}},getAppVersion:function(){return null},getAppName:function(){return null}}}},{key:"returnBatch",value:function(n){var t=this.getMPInstance(),i=new lr(t).createEventObject(n);return ir("0",[i],t)}}]),n}(),Array.prototype.forEach||(Array.prototype.forEach=ut.forEach),Array.prototype.map||(Array.prototype.map=ut.map),Array.prototype.filter||(Array.prototype.filter=ut.filter),Array.isArray||(Array.prototype.isArray=ut.isArray),oi=new ro,window.mParticle=oi,window.mParticle._BatchValidator=new pr,oi}() ;;



window.mParticle.config.requestConfig = false;;
mParticle.init('us1-99f689156b88a84fbe3383020acfea25', window.mParticle.config);;